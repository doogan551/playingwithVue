<configuration>
    <system.web.extensions>
        <scripting>
            <webServices>
                <jsonSerialization maxJsonLength="500000" />
            </webServices>
        </scripting>
    </system.web.extensions>
    <location path="." inheritInChildApplications="false">
        <system.webServer>
        <!-- // need this on IIS8 to prevent IIS websockets implementation interfering with Node
             // http://tomasz.janczuk.org/2012/11/how-to-use-websockets-with-nodejs-apps.html
        -->
        <!--webSocket enabled="false" /-->
        <handlers>
            <add name="iisnode" path="app.js" verb="*" modules="iisnode" />
        </handlers>
        <!--iisnode
              node_env="%node_env%"
              nodeProcessCountPerApplication="1"
              maxConcurrentRequestsPerProcess="1024"
              maxNamedPipeConnectionRetry="100"
              namedPipeConnectionRetryDelay="250"
              maxNamedPipeConnectionPoolSize="512"
              maxNamedPipePooledConnectionAge="30000"
              asyncCompletionThreadCount="0"
              initialRequestBufferSize="4096"
              maxRequestBufferSize="65536"
              watchedFiles="*.js;iisnode.yml"
              uncFileChangesPollingInterval="5000"
              gracefulShutdownTimeout="60000"
              loggingEnabled="true"
              logDirectory="iisnode"
              debuggingEnabled="true"
              debugHeaderEnabled="true"
              debuggerPortRange="5058-6058"
              debuggerPathSegment="debug"
              maxLogFileSizeInKB="128"
              maxTotalLogFileSizeInKB="1024"
              maxLogFiles="20"
              devErrorsEnabled="true"
              flushResponse="false"
              enableXFF="false"
              promoteServerVars=""
             /-->
        <rewrite>
            <rules>
                <rule name="StaticContent" patternSyntax="Wildcard" stopProcessing="true">
                    <match url="*.*" />
                    <conditions>
                        <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
                        <add input="{URL}" negate="true" pattern="\.axd$" />
                    </conditions>
                    <action type="Rewrite" url="public/{R:0}" logRewrittenUrl="true" />
                </rule>
                <rule name="DynamicContent2">
                    <match url="/reportNotes/(.*)$" />
                    <action type="Rewrite" url="/reportNotes/server.js" />
                </rule>
                <rule name="DynamicContent">
                    <conditions>
                        <add input="{REQUEST_URI}" pattern="/reportnet/(.*)$" negate="true" />
                    </conditions>
                    <action type="Rewrite" url="app.js" />
                </rule>
            </rules>
        </rewrite>
        <staticContent>
            <remove fileExtension=".json" />
            <mimeMap fileExtension=".json" mimeType="application/json" />
            <remove fileExtension=".woff" />
            <mimeMap fileExtension=".woff" mimeType="font" />
            <remove fileExtension=".woff2" />
            <mimeMap fileExtension=".woff2" mimeType="font" />
        </staticContent>
    </system.webServer>
    </location>
    <system.web>
        <httpRuntime maxRequestLength="1048576" executionTimeout="3600" />
        <compilation debug="true" />
    </system.web>
</configuration>
