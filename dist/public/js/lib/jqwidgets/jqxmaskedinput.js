!function(a){a.jqx.jqxWidget("jqxMaskedInput","",{}),a.extend(a.jqx._jqxMaskedInput.prototype,{defineInstance:function(){this.value=null,this.mask="99999",this.width=null,this.height=25,this.textAlign="left",this.readOnly=!1,this.cookies=!1,this.promptChar="_",this.inputMode="advanced",this.rtl=!1,this.disabled=!1,this.events=["valuechanged","textchanged","mousedown","mouseup","keydown","keyup","keypress","change"],this.aria={"aria-valuenow":{name:"value",type:"string"},"aria-disabled":{name:"disabled",type:"boolean"}}},createInstance:function(a){this.render()},render:function(){this.host.attr({role:"textbox"}),this.host.attr("data-role","input");var b=this.host.attr("value");void 0!=b&&""!=b&&(this.value=b),a.jqx.aria(this),a.jqx.aria(this,"aria-multiline",!1),a.jqx.aria(this,"aria-readonly",this.readOnly),this.host.addClass(this.toThemeProperty("jqx-input")),this.host.addClass(this.toThemeProperty("jqx-rc-all")),this.host.addClass(this.toThemeProperty("jqx-widget")),this.host.addClass(this.toThemeProperty("jqx-widget-content")),maskEditor=this,"div"==this.element.nodeName.toLowerCase()?(this.element.innerHTML="",this.maskbox=a("<input autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' type='textarea'/>").appendTo(this.host)):(this.maskbox=this.host,this.maskbox.attr("autocomplete","off"),this.maskbox.attr("autocorrect","off"),this.maskbox.attr("autocapitalize","off"),this.maskbox.attr("spellcheck",!1)),this.maskbox.addClass(this.toThemeProperty("jqx-reset")),this.maskbox.addClass(this.toThemeProperty("jqx-input-content")),this.maskbox.addClass(this.toThemeProperty("jqx-widget-content"));var c=this.host.attr("name");c&&this.maskbox.attr("name",c),this.rtl&&this.maskbox.addClass(this.toThemeProperty("jqx-rtl"));var d=this;this.propertyChangeMap.disabled=function(a,b,c,e){e?a.maskbox.addClass(d.toThemeProperty("jqx-input-disabled")):a.maskbox.removeClass(d.toThemeProperty("jqx-input-disabled"))},this.disabled&&(this.maskbox.addClass(this.toThemeProperty("jqx-input-disabled")),this.maskbox.attr("disabled",!0),this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled"))),this.selectedText="",this.self=this,this.oldValue=this._value(),this.items=new Array,this._initializeLiterals(),this._render(),null!=this.value&&this.inputValue(this.value.toString());var d=this;if(this.host.parents("form").length>0&&this.host.parents("form").on("reset",function(){setTimeout(function(){d.clearValue()},10)}),this.addHandlers(),this.cookies){var e=a.jqx.cookie.cookie("maskedInput."+this.element.id);e&&this.val(e)}},addHandlers:function(){var b=this;a.jqx.mobile.isTouchDevice()&&(this.inputMode="simple");var c="",d=function(a,b){var c=String.fromCharCode(b),d=parseInt(c),e=!0;if(!isNaN(d)){e=!0;var f=this.maskbox.val().toString().length;f>=this._getEditStringLength()&&0==this._selection().length&&(e=!1)}return a.ctrlKey||a.shiftKey||b>=65&&b<=90&&(e=!1),e};this.addHandler(this.maskbox,"blur",function(d){return"simple"==b.inputMode?(b._exitSimpleInputMode(d,b,!1,c),!1):(b.rtl&&b.maskbox.css("direction","ltr"),b.host.removeClass(b.toThemeProperty("jqx-fill-state-focus")),void(b.maskbox.val()!=c&&(b._raiseEvent(7,d),b.cookies&&a.jqx.cookie.cookie("maskedInput."+b.element.id,b.maskbox.val()))))}),this.addHandler(this.maskbox,"focus",function(d){return c=b.maskbox.val(),"simple"==b.inputMode?(b.maskbox[0].value=b._getEditValue(),a.data(b.maskbox,"simpleInputMode",!0),!1):(b.rtl&&b.maskbox.css("direction","rtl"),void b.host.addClass(b.toThemeProperty("jqx-fill-state-focus")))}),this.addHandler(this.host,"keydown",function(a){var c=b.readOnly,e=a.charCode?a.charCode:a.keyCode?a.keyCode:0;if(c||b.disabled)return!1;if("simple"!=b.inputMode){var f=b._handleKeyDown(a,e);return f||(a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()),f}return d.call(b,a,e)}),this.addHandler(this.host,"keyup",function(a){var c=b.readOnly,e=a.charCode?a.charCode:a.keyCode?a.keyCode:0;return!(!c&&!b.disabled)||("simple"==b.inputMode?d.call(b,a,e):(a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),!1))}),this.addHandler(this.host,"keypress",function(a){var c=b.readOnly,e=a.charCode?a.charCode:a.keyCode?a.keyCode:0;if(c||b.disabled)return!0;if("simple"==b.inputMode)return d.call(b,a,e);var f=b._handleKeyPress(a,e);return f||(a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()),f})},focus:function(){try{this.maskbox.focus()}catch(a){}},_exitSimpleInputMode:function(b,c,d,e){if(void 0==c&&(c=b.data),null!=c){if(void 0==d){if(null!=b.target&&null!=c.element&&(void 0!=b.target.id&&b.target.id.toString().length>0&&c.host.find("#"+b.target.id).length>0||b.target==c.element))return;var f=c.host.offset(),g=f.left,h=f.top,i=c.host.width(),j=c.host.height(),k=a(b.target).offset();if(k.left>=g&&k.left<=g+i&&k.top>=h&&k.top<=h+j)return}if(!c.disabled&&!c.readOnly){var l=a.data(c.maskbox,"simpleInputMode");if(null!=l){for(var m=c.maskbox.val(),n=m.toString(),o=0,p=0;p<this.items.length;p++)if(this.items[p].canEdit){if(!this._match(n.substring(o,o+1),this.items[p].regex)&&""!==n.substring(o,o+1))return c.maskbox[0].value=e,a.data(c.maskbox,"simpleInputMode",null),!1;o++}return c.inputValue(m,!0),a.data(c.maskbox,"simpleInputMode",null),!1}}}},_getString:function(){for(var a="",b=0;b<this.items.length;b++){var c=this.items[b].character;a+=this.items[b].character==this.promptChar&&this.promptChar!=this.items[b].defaultCharacter?this.items[b].defaultCharacter:c}return a},_initializeLiterals:function(){if(void 0==this.mask||null==this.mask)return void(this.items=new Array);this.mask=this.mask.toString();for(var a=this.mask.length,b=0;b<a;b++){var c=this.mask.substring(b,b+1),d="",e=!1;if("["==c){for(var f=b;f<a;f++){var g=this.mask.substring(f,f+1);if("]"==g)break}d="("+this.mask.substring(b,f+1)+")",b=f,e=!0}"#"==c?(d="(\\d|[+]|[-])",e=!0):"9"==c||"0"==c?(d="\\d",e=!0):"$"==c?e=!1:"/"==c||":"==c?e=!1:"A"==c||"a"==c?(d="\\w",e=!0):"c"==c||"C"==c?(d=".",e=!0):"L"!=c&&"l"!=c||(d="\\p{L}",e=!0);var h=this,i=function(a,b,c){i.character=a,i.regex=b,i.canEdit=c,i.defaultCharacter=h.promptChar};e?i(this.promptChar,d,e):i(c,d,e),this.items.push(i)}},setRegex:function(a,b,c,d){null!=a&&void 0!=a&&null!=b&&void 0!=b&&a<this.items.length&&(this.items[a].regex=b,null!=c&&void 0!=c&&(this.items[a].canEdit=c),null!=d&&void 0!=d&&(this.items[a].defaultCharacter=d))},_match:function(a,b){var c=new RegExp(b,"i");return c.test(a)},_raiseEvent:function(a,b){var c=this.events[a],d={};d.owner=this;var e=(b.charCode?b.charCode:b.keyCode?b.keyCode:0,!0),f=(this.readOnly,new jQuery.Event(c));return f.owner=this,d.value=this.inputValue(),d.text=this.maskedValue(),f.args=d,(a<2||a>6)&&(e=this.host.trigger(f)),e},_handleKeyPress:function(a,b){var c=this._isSpecialKey(b,a);return c},_insertKey:function(b){var c=this._selection(),d=this;if(c.start>=0&&c.start<this.items.length){var e=String.fromCharCode(b),f=!1;a.each(this.items,function(a,b){if(!(a<c.start)){var g=d.items[a];if(g.canEdit){if(d._match(e,g.regex)){if(!f&&c.length>0){for(var h=c.start;h<c.end;h++)d.items[h].canEdit&&(d.items[h].character=d.promptChar);var i=d._getString();d.maskedValue(i),f=!0}g.character=e;var i=d._getString();return d.maskedValue(i),c.start<d.items.length&&d._setSelectionStart(a+1),!1}return!1}}})}},_deleteSelectedText:function(){var a=this._selection(),b=!1;if(a.start>0||a.length>0){for(i=a.start;i<a.end;i++)i<this.items.length&&this.items[i].canEdit&&this.items[i].character!=this.promptChar&&(this.items[i].character=this.promptChar,b=!0);var c=this._getString();return this.maskedValue(c),b}},_saveSelectedText:function(){var b=this._selection(),c="";if(b.start>0||b.length>0)for(i=b.start;i<b.end;i++)this.items[i].canEdit&&(c+=this.items[i].character);if(window.clipboardData)window.clipboardData.setData("Text",c);else{var d=a('<textarea style="position: absolute; left: -1000px; top: -1000px;"/>');d.val(c),a("body").append(d),d.select(),setTimeout(function(){document.designMode="off",d.select(),d.remove()},100)}return c},_pasteSelectedText:function(){var b=this._selection(),c=0,d=b.start,e="",f=this,g=function(a){if(!(a!=f.selectedText&&a.length>0&&(f.selectedText=a,null==f.selectedText||void 0==f.selectedText))){if(b.start>=0||b.length>0)for(i=b.start;i<f.items.length;i++)f.items[i].canEdit&&c<f.selectedText.length&&(f.items[i].character=f.selectedText[c],c++,d=1+i);var e=f._getString();f.maskedValue(e),d<f.items.length?f._setSelectionStart(d):f._setSelectionStart(f.items.length)}};if(window.clipboardData)e=window.clipboardData.getData("Text"),g(e);else{var h=a('<textarea style="position: absolute; left: -1000px; top: -1000px;"/>');a("body").append(h),h.select();setTimeout(function(){var a=h.val();g(a),h.remove()},100)}},_handleKeyDown:function(b,c){var d=this._selection();if(c>=96&&c<=105&&(c-=48),b.ctrlKey&&97==c||b.ctrlKey&&65==c)return!0;if(b.ctrlKey&&120==c||b.ctrlKey&&88==c)return this.selectedText=this._saveSelectedText(b),this._deleteSelectedText(b),!a.jqx.browser.msie;if(b.ctrlKey&&99==c||b.ctrlKey&&67==c)return this.selectedText=this._saveSelectedText(b),!a.jqx.browser.msie;if(b.ctrlKey&&122==c||b.ctrlKey&&90==c)return!1;if(b.ctrlKey&&118==c||b.ctrlKey&&86==c||b.shiftKey&&45==c)return this._pasteSelectedText(),!a.jqx.browser.msie;if(d.start>=0&&d.start<this.items.length){String.fromCharCode(c),this.items[d.start]}if(8==c){if(0==d.length)for(g=this.items.length-1;g>=0;g--)if(this.items[g].canEdit&&g<d.end&&this.items[g].character!=this.promptChar){this._setSelection(g,g+1);break}d=this._selection();var e=this._deleteSelectedText();return(d.start>0||d.length>0)&&d.start<=this.items.length&&(e?this._setSelectionStart(d.start):this._setSelectionStart(d.start-1)),!1}if(190==c)for(var f=d.start,g=f;g<this.items.length;g++)if("."==this.items[g].character){this._setSelectionStart(g+1);break}if(191==c)for(var f=d.start,g=f;g<this.items.length;g++)if("/"==this.items[g].character){this._setSelectionStart(g+1);break}if(189==c)for(var f=d.start,g=f;g<this.items.length;g++)if("-"==this.items[g].character){this._setSelectionStart(g+1);break}if(46==c){if(0==d.length)for(var g=0;g<this.items.length;g++)if(this.items[g].canEdit&&g>=d.start&&this.items[g].character!=this.promptChar){this._setSelection(g,g+1);break}var h=d;d=this._selection();this._deleteSelectedText();return(d.start>=0||d.length>=0)&&d.start<this.items.length&&(d.length<=1?h.end!=d.end?this._setSelectionStart(d.end):this._setSelectionStart(d.end+1):this._setSelectionStart(d.start)),!1}this._insertKey(c);var i=this._isSpecialKey(c,b);return i},_isSpecialKey:function(a,b){return 189==a||9==a||13==a||35==a||36==a||37==a||39==a||46==a||!!(16===a&&b.shiftKey||b.ctrlKey)},_selection:function(){if("selectionStart"in this.maskbox[0]){var a=this.maskbox[0],b=a.selectionEnd-a.selectionStart;return{start:a.selectionStart,end:a.selectionEnd,length:b,text:a.value}}var c=document.selection.createRange();if(null==c)return{start:0,end:a.value.length,length:0};var d=this.maskbox[0].createTextRange(),e=d.duplicate();d.moveToBookmark(c.getBookmark()),e.setEndPoint("EndToStart",d);var b=c.text.length;return{start:e.text.length,end:e.text.length+c.text.length,length:b,text:c.text}},_setSelection:function(a,b){if("selectionStart"in this.maskbox[0])this.maskbox[0].focus(),this.maskbox[0].setSelectionRange(a,b);else{var c=this.maskbox[0].createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select()}},_setSelectionStart:function(a){this._setSelection(a,a)},refresh:function(a){a||this._render()},resize:function(a,b){this.width=a,this.height=b,this.refresh()},_render:function(){var b=parseInt(this.host.css("border-left-width")),c=parseInt(this.host.css("border-left-width")),d=parseInt(this.host.css("border-left-width")),e=parseInt(this.host.css("border-left-width")),f=parseInt(this.host.css("height"))-d-e,g=parseInt(this.host.css("width"))-b-c;null!=this.width&&this.width.toString().indexOf("px")!=-1?g=this.width:void 0==this.width||isNaN(this.width)||(g=this.width),null!=this.height&&this.height.toString().indexOf("px")!=-1?f=this.height:void 0==this.height||isNaN(this.height)||(f=this.height),g=parseInt(g),f=parseInt(f),this.maskbox[0]!=this.element&&this.maskbox.css({"border-left-width":0,"border-right-width":0,"border-bottom-width":0,"border-top-width":0}),this.maskbox.css("text-align",this.textAlign);var h=this.maskbox.css("font-size");isNaN(f)||this.maskbox.css("height",parseInt(h)+4+"px"),isNaN(g)||this.maskbox.css("width",g-2);var i=parseInt(f)-2*parseInt(d)-2*parseInt(e)-parseInt(h);if(isNaN(i)&&(i=0),isNaN(f)||this.host.height(f),isNaN(g)||this.host.width(g),this.maskbox[0]!=this.element){var j=i/2;a.jqx.browser.msie&&a.jqx.browser.version<8&&(j=i/4),this.maskbox.css("padding-right","0px"),this.maskbox.css("padding-left","0px"),this.maskbox.css("padding-top",j),this.maskbox.css("padding-bottom",i/2)}this.maskbox[0].value=this._getString(),this.width&&(this.width.toString().indexOf("%")>=0&&(this.element.style.width=this.width),this.height.toString().indexOf("%")>=0&&(this.element.style.height=this.height))},destroy:function(){this.host.remove()},maskedValue:function(a){return void 0===a?this._value():(this.value=a,this._refreshValue(),this.oldValue!==a&&(this._raiseEvent(1,a),this.oldValue=a,this._raiseEvent(0,a)),this)},_value:function(){var a=this.maskbox.val();return a},propertyChangedHandler:function(b,c,d,e){if(void 0!=this.isInitialized&&0!=this.isInitialized){if("rtl"==c&&(b.rtl?b.maskbox.addClass(b.toThemeProperty("jqx-rtl")):b.maskbox.removeClass(b.toThemeProperty("jqx-rtl"))),"value"===c&&(void 0!=e&&null!=e||(e=""),""===e?this.clear():(e=e.toString(),this.inputValue(e))),"theme"===c&&a.jqx.utilities.setTheme(d,e,this.host),"disabled"==c&&(e?(b.maskbox.addClass(b.toThemeProperty("jqx-input-disabled")),b.host.addClass(b.toThemeProperty("jqx-fill-state-disabled")),b.maskbox.attr("disabled",!0)):(b.host.removeClass(this.toThemeProperty("jqx-fill-state-disabled")),b.host.removeClass(this.toThemeProperty("jqx-input-disabled")),b.maskbox.attr("disabled",!1)),a.jqx.aria(b,"aria-disabled",e)),"readOnly"==c&&(this.readOnly=e),"promptChar"==c){for(i=0;i<b.items.length;i++)b.items[i].character==b.promptChar&&(b.items[i].character=e,b.items[i].defaultCharacter=e);b.promptChar=e}"textAlign"==c&&(b.maskbox.css("text-align",e),b.textAlign=e),"mask"==c&&(b.mask=e,b.items=new Array,b._initializeLiterals(),b.value=b._getString(),b._refreshValue()),"width"==c?(b.width=e,b._render()):"height"==c&&(b.height=e,b._render())}},_value:function(){var a=this.value;return a},_getEditStringLength:function(){var a="";for(i=0;i<this.items.length;i++)this.items[i].canEdit&&(a+=this.items[i].character);return a.length},_getEditValue:function(){var a="";for(i=0;i<this.items.length;i++)this.items[i].canEdit&&this.items[i].character!=this.promptChar&&(a+=this.items[i].character);return a},parseValue:function(a){if(void 0==a||null==a)return null;var b=a.toString(),c="",d=0;for(m=0;m<b.length;m++){var e=b.substring(m,m+1);for(i=d;i<this.items.length;i++)if(this.items[i].canEdit&&this._match(e,this.items[i].regex)){c+=e,d=i;break}}return c},clear:function(){this.clearValue()},clearValue:function(){this.inputValue("",!0)},val:function(a){return void 0!=a&&"object"!=typeof a&&this.maskedValue(a),this.maskbox[0].value},inputValue:function(a,b){if(void 0==a||null==a){for(var c="",d=0;d<this.items.length;d++)this.items[d].canEdit&&(c+=this.items[d].character);return c}var e=0;a=a.toString();for(var d=0;d<this.items.length;d++)this.items[d].canEdit&&(this._match(a.substring(e,e+1),this.items[d].regex)?(this.items[d].character=a.substring(e,e+1),e++):b&&(this.items[d].character=this.promptChar,e++));var f=this._getString();return this.maskedValue(f),this.inputValue()},_refreshValue:function(){for(var b=this.maskedValue(),c=0,d=0;d<this.items.length;d++)b.length>c&&(this.items[d].canEdit&&this.items[d].character!=b[c]&&this._match(b[c],this.items[d].regex)&&1==b[c].length&&(this.items[d].character=b[c]),c++);this.value=this._getString(),b=this.value,this.maskbox[0].value=b,a.jqx.aria(this,"aria-valuenow",b)}})}(jQuery);