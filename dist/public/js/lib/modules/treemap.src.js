!function(a){var b=a.seriesTypes,c=a.merge,d=a.extend,e=a.extendClass,f=a.getOptions(),g=f.plotOptions,h=function(){},i=a.each,j=HighchartsAdapter.grep,k=a.pick,l=a.Series,m=a.Color;g.treemap=c(g.scatter,{showInLegend:!1,marker:!1,borderColor:"#E0E0E0",borderWidth:1,dataLabels:{enabled:!0,defer:!1,verticalAlign:"middle",formatter:function(){return this.point.name||this.point.id},inside:!0},tooltip:{headerFormat:"",pointFormat:"<b>{point.name}</b>: {point.node.val}</b><br/>"},layoutAlgorithm:"sliceAndDice",layoutStartingDirection:"vertical",alternateStartingDirection:!1,levelIsConstant:!0,states:{hover:{borderColor:"#A0A0A0",brightness:b.heatmap?0:.1,shadow:!1}},drillUpButton:{position:{align:"left",x:10,y:-50}}});var n={pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color",dashstyle:"borderDashStyle"},pointArrayMap:["value"],axisTypes:b.heatmap?["xAxis","yAxis","colorAxis"]:["xAxis","yAxis"],optionalAxis:"colorAxis",getSymbol:h,parallelArrays:["x","y","value","colorValue"],colorKey:"colorValue",translateColors:b.heatmap&&b.heatmap.prototype.translateColors};b.treemap=e(b.scatter,c(n,{type:"treemap",trackerGroups:["group","dataLabelsGroup"],pointClass:e(a.Point,{setState:function(b,c){a.Point.prototype.setState.call(this,b,c),"hover"===b?this.dataLabel&&this.dataLabel.attr({zIndex:1002}):this.dataLabel&&this.dataLabel.attr({zIndex:this.pointAttr[""].zIndex+1})},setVisible:b.pie.prototype.pointClass.prototype.setVisible}),handleLayout:function(){var a,b=this.tree;this.points.length&&(this.rootNode=k(this.rootNode,""),b=this.tree=this.getTree(),this.levelMap=this.getLevels(),a=this.getSeriesArea(b.val),this.calculateChildrenAreas(b,a),this.setPointValues())},getTree:function(){var a,b,c=this,d=[],e=[],f=function(a){i(d[a],function(a){d[""].push(a)})};this.nodeMap=[],i(this.points,function(a,b){var c="";e.push(a.id),void 0!==a.parent&&(c=a.parent),void 0===d[c]&&(d[c]=[]),d[c].push(b)});for(b in d)d.hasOwnProperty(b)&&""!==b&&HighchartsAdapter.inArray(b,e)===-1&&(f(b),delete d[b]);return a=c.buildNode("",-1,0,d,null),this.eachParents(this.nodeMap[this.rootNode],function(a){a.visible=!0}),this.eachChildren(this.nodeMap[this.rootNode],function(a){a.visible=!0}),this.setTreeValues(a),a},buildNode:function(a,b,c,d,e){var f,g,h=this,j=[],k=h.points[b];return i(d[a]||[],function(b){g=h.buildNode(h.points[b].id,b,c+1,d,a),j.push(g)}),f={id:a,i:b,children:j,level:c,parent:e,visible:!1},h.nodeMap[f.id]=f,k&&(k.node=f),f},setTreeValues:function(a){var b,c=this,e=0,f=[],g=c.points[a.i];return i(a.children,function(a){a=c.setTreeValues(a),c.insertElementSorted(f,a,function(a,b){return a.val>b.val}),a.ignore?c.eachChildren(a,function(a){d(a,{ignore:!0,isLeaf:!1,visible:!1})}):e+=a.val}),b=k(g&&g.value,e),d(a,{children:f,childrenTotal:e,ignore:!(k(g&&g.visible,!0)&&b>0),isLeaf:a.visible&&!e,name:k(g&&g.name,""),val:b}),a},eachChildren:function(a,b){var c=this,d=a.children;b(a),d.length&&i(d,function(a){c.eachChildren(a,b)})},eachParents:function(a,b){var c=this.nodeMap[a.parent];b(a),c&&this.eachParents(c,b)},calculateChildrenAreas:function(a,b){var d,e,f=this,g=f.options,h=g.levelIsConstant?a.level:a.level-this.nodeMap[this.rootNode].level,l=this.levelMap[h+1],m=k(f[l&&l.layoutAlgorithm]&&l.layoutAlgorithm,g.layoutAlgorithm),n=g.alternateStartingDirection,o=[];d=j(a.children,function(a){return!a.ignore}),l&&l.layoutStartingDirection&&(b.direction="vertical"===l.layoutStartingDirection?0:1),o=f[m](b,d),i(d,function(a,d){e=f.points[a.i],e.level=h+1,a.values=c(o[d],{val:a.childrenTotal,direction:n?1-b.direction:b.direction}),a.children.length&&f.calculateChildrenAreas(a,a.values)})},setPointValues:function(){var a=this,b=a.xAxis,c=a.yAxis;a.nodeMap[""].values={x:0,y:0,width:100,height:100},i(a.points,function(d){var e,f,g,h,i=d.node,j=i.values;j?(j.x=j.x/a.axisRatio,j.width=j.width/a.axisRatio,e=Math.round(b.translate(j.x,0,0,0,1)),f=Math.round(b.translate(j.x+j.width,0,0,0,1)),g=Math.round(c.translate(j.y,0,0,0,1)),h=Math.round(c.translate(j.y+j.height,0,0,0,1)),d.shapeType="rect",d.shapeArgs={x:Math.min(e,f),y:Math.min(g,h),width:Math.abs(f-e),height:Math.abs(h-g)},d.plotX=d.shapeArgs.x+d.shapeArgs.width/2,d.plotY=d.shapeArgs.y+d.shapeArgs.height/2):(delete d.plotX,delete d.plotY)})},getSeriesArea:function(a){var b=0,c=0,d=100,e=this.axisRatio=this.xAxis.len/this.yAxis.len,f=100*e,g="vertical"===this.options.layoutStartingDirection?0:1,h={x:b,y:c,width:f,height:d,direction:g,val:a};return this.nodeMap[""].values=h,h},getLevels:function(){var a=[],b=this.options.levels;return b&&i(b,function(b){void 0!==b.level&&(a[b.level]=b)}),a},setColorRecursive:function(a,b){var c,d,e=this;a&&(c=e.points[a.i],d=e.levelMap[a.level],b=k(c&&c.options.color,d&&d.color,b),c&&(c.color=b),a.children.length&&i(a.children,function(a){e.setColorRecursive(a,b)}))},alg_func_group:function(a,b,c,d){this.height=a,this.width=b,this.plot=d,this.direction=c,this.startDirection=c,this.total=0,this.nW=0,this.lW=0,this.nH=0,this.lH=0,this.elArr=[],this.lP={total:0,lH:0,nH:0,lW:0,nW:0,nR:0,lR:0,aspectRatio:function(a,b){return Math.max(a/b,b/a)}},this.addElement=function(a){this.lP.total=this.elArr[this.elArr.length-1],this.total=this.total+a,0===this.direction?(this.lW=this.nW,this.lP.lH=this.lP.total/this.lW,this.lP.lR=this.lP.aspectRatio(this.lW,this.lP.lH),this.nW=this.total/this.height,this.lP.nH=this.lP.total/this.nW,this.lP.nR=this.lP.aspectRatio(this.nW,this.lP.nH)):(this.lH=this.nH,this.lP.lW=this.lP.total/this.lH,this.lP.lR=this.lP.aspectRatio(this.lP.lW,this.lH),this.nH=this.total/this.width,this.lP.nW=this.lP.total/this.nH,this.lP.nR=this.lP.aspectRatio(this.lP.nW,this.nH)),this.elArr.push(a)},this.reset=function(){this.nW=0,this.lW=0,this.elArr=[],this.total=0}},alg_func_calcPoints:function(a,b,c,d){var e,f,g,h,j,k=c.lW,l=c.lH,m=c.plot,n=0,o=c.elArr.length-1;b?(k=c.nW,l=c.nH):j=c.elArr[c.elArr.length-1],i(c.elArr,function(a){(b||n<o)&&(0===c.direction?(e=m.x,f=m.y,g=k,h=a/g):(e=m.x,f=m.y,h=l,g=a/h),d.push({x:e,y:f,width:g,height:h}),0===c.direction?m.y=m.y+h:m.x=m.x+g),n+=1}),c.reset(),0===c.direction?c.width=c.width-k:c.height=c.height-l,m.y=m.parent.y+(m.parent.height-c.height),m.x=m.parent.x+(m.parent.width-c.width),a&&(c.direction=1-c.direction),b||c.addElement(j)},alg_func_lowAspectRatio:function(a,b,c){var d,e=[],f=this,g={x:b.x,y:b.y,parent:b},h=b.direction,j=0,k=c.length-1,l=new this.alg_func_group(b.height,b.width,h,g);return i(c,function(c){d=b.width*b.height*(c.val/b.val),l.addElement(d),l.lP.nR>l.lP.lR&&f.alg_func_calcPoints(a,!1,l,e,g),j===k&&f.alg_func_calcPoints(a,!0,l,e,g),j+=1}),e},alg_func_fill:function(a,b,c){var d,e,f,g,h,j=[],k=b.direction,l=b.x,m=b.y,n=b.width,o=b.height;return i(c,function(c){d=b.width*b.height*(c.val/b.val),e=l,f=m,0===k?(h=o,g=d/h,n-=g,l+=g):(g=n,h=d/g,o-=h,m+=h),j.push({x:e,y:f,width:g,height:h}),a&&(k=1-k)}),j},strip:function(a,b){return this.alg_func_lowAspectRatio(!1,a,b)},squarified:function(a,b){return this.alg_func_lowAspectRatio(!0,a,b)},sliceAndDice:function(a,b){return this.alg_func_fill(!0,a,b)},stripes:function(a,b){return this.alg_func_fill(!1,a,b)},translate:function(){l.prototype.translate.call(this),this.handleLayout(),this.colorAxis?this.translateColors():this.options.colorByPoint||this.setColorRecursive(this.tree,void 0)},drawDataLabels:function(){var a,b,d=this,e=d.dataLabelsGroup,f=d.points;i(f,function(e){b=d.levelMap[e.level],a={style:{}},e.node.isLeaf||(a.enabled=!1),b&&b.dataLabels&&(a=c(a,b.dataLabels),d._hasPointLabels=!0),e.shapeArgs&&(a.style.width=e.shapeArgs.width),e.dlOptions=c(a,e.options.dataLabels)}),this.dataLabelsGroup=this.group,l.prototype.drawDataLabels.call(this),this.dataLabelsGroup=e},alignDataLabel:b.column.prototype.alignDataLabel,drawPoints:function(){var d,e,f,g=this,h=g.points,j=g.options;i(h,function(b){f=g.levelMap[b.level],d={stroke:j.borderColor,"stroke-width":j.borderWidth,dashstyle:j.borderDashStyle,r:0,fill:k(b.color,g.color)},f&&(d.stroke=f.borderColor||d.stroke,d["stroke-width"]=f.borderWidth||d["stroke-width"],d.dashstyle=f.borderDashStyle||d.dashstyle),d.stroke=b.borderColor||d.stroke,d["stroke-width"]=b.borderWidth||d["stroke-width"],d.dashstyle=b.borderDashStyle||d.dashstyle,d.zIndex=1e3-2*b.level,b.pointAttr=c(b.pointAttr),e=b.pointAttr.hover,e.zIndex=1001,e.fill=m(d.fill).brighten(j.states.hover.brightness).get(),b.node.isLeaf||(k(j.interactByLeaf,!j.allowDrillToNode)?(d.fill="none",delete e.fill):(d.fill=m(d.fill).setOpacity(.15).get(),e.fill=m(e.fill).setOpacity(.75).get())),b.node.level<=g.nodeMap[g.rootNode].level&&(d.fill="none",d.zIndex=0,delete e.fill),b.pointAttr[""]=a.extend(b.pointAttr[""],d),b.dataLabel&&b.dataLabel.attr({zIndex:b.pointAttr[""].zIndex+1})}),b.column.prototype.drawPoints.call(this),i(h,function(a){a.graphic&&a.graphic.attr(a.pointAttr[""])}),j.allowDrillToNode&&g.drillTo()},insertElementSorted:function(a,b,c){var d=0,e=!1;0!==a.length&&i(a,function(f){c(b,f)&&!e&&(a.splice(d,0,b),e=!0),d+=1}),e||a.push(b)},drillTo:function(){var b=this,c=b.points;i(c,function(c){var d,e;a.removeEvent(c,"click.drillTo"),c.graphic&&c.graphic.css({cursor:"default"}),d=b.options.interactByLeaf?b.drillToByLeaf(c):b.drillToByGroup(c),d&&(e=b.nodeMap[b.rootNode].name||b.rootNode,c.graphic&&c.graphic.css({cursor:"pointer"}),a.addEvent(c,"click.drillTo",function(){c.setState(""),b.drillToNode(d),b.showDrillUpButton(e)}))})},drillToByGroup:function(a){var b=this,c=!1;return a.node.level-b.nodeMap[b.rootNode].level!==1||a.node.isLeaf||(c=a.id),c},drillToByLeaf:function(a){var b,c=this,d=!1;if(a.node.parent!==c.rootNode&&a.node.isLeaf)for(b=a.node;!d;)b=c.nodeMap[b.parent],b.parent===c.rootNode&&(d=b.id);return d},drillUp:function(){var a,b,c=null;this.rootNode&&(a=this.nodeMap[this.rootNode],c=null!==a.parent?this.nodeMap[a.parent]:this.nodeMap[""]),null!==c&&(this.drillToNode(c.id),""===c.id?this.drillUpButton=this.drillUpButton.destroy():(b=this.nodeMap[c.parent],this.showDrillUpButton(b.name||b.id)))},drillToNode:function(a){var b=this.nodeMap[a],c=b.values;this.rootNode=a,this.xAxis.setExtremes(c.x,c.x+c.width,!1),this.yAxis.setExtremes(c.y,c.y+c.height,!1),this.isDirty=!0,this.chart.redraw()},showDrillUpButton:function(a){var b,c,d=this,e=a||"< Back",f=d.options.drillUpButton;f.text&&(e=f.text),this.drillUpButton?this.drillUpButton.attr({text:e}).align():(b=f.theme,c=b&&b.states,this.drillUpButton=this.chart.renderer.button(e,null,null,function(){d.drillUp()},b,c&&c.hover,c&&c.select).attr({align:f.position.align,zIndex:9}).add().align(f.position,!1,f.relativeTo||"plotBox"))},buildKDTree:h,drawLegendSymbol:a.LegendSymbolMixin.drawRectangle,getExtremes:function(){l.prototype.getExtremes.call(this,this.colorValueData),this.valueMin=this.dataMin,this.valueMax=this.dataMax,l.prototype.getExtremes.call(this)},getExtremesFromAll:!0,bindAxes:function(){var b={endOnTick:!1,gridLineWidth:0,lineWidth:0,min:0,dataMin:0,minPadding:0,max:100,dataMax:100,maxPadding:0,startOnTick:!1,title:null,tickPositions:[]};l.prototype.bindAxes.call(this),a.extend(this.yAxis.options,b),a.extend(this.xAxis.options,b)}}))}(Highcharts);