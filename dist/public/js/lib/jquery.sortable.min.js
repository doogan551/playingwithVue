!function(a,b,c){function d(a,b){var c=Math.max(0,a[0]-b[0],b[0]-a[1]),d=Math.max(0,a[2]-b[1],b[1]-a[3]);return c+d}function e(b,c,d,e){for(var f=b.length,e=e?"offset":"position",d=d||0;f--;){var g=b[f].el?b[f].el:a(b[f]),h=g[e]();h.left+=parseInt(g.css("margin-left"),10),h.top+=parseInt(g.css("margin-top"),10),c[f]=[h.left-d,h.left+g.outerWidth()+d,h.top-d,h.top+g.outerHeight()+d]}}function f(a,b){var c=b.offset();return{left:a.left-c.left,top:a.top-c.top}}function g(a,b,c){for(var e,b=[b.left,b.top],c=c&&[c.left,c.top],f=a.length,g=[];f--;)e=a[f],g[f]=[f,d(e,b),c&&d(e,c)];return g=g.sort(function(a,b){return b[1]-a[1]||b[2]-a[2]||b[0]-a[0]})}function h(b){this.options=a.extend({},l,b),this.containers=[],this.scrollProxy=a.proxy(this.scroll,this),this.dragProxy=a.proxy(this.drag,this),this.dropProxy=a.proxy(this.drop,this),this.options.parentContainer||(this.placeholder=a(this.options.placeholder),b.isValidTarget||(this.options.isValidTarget=c))}function i(b,c){this.el=b,this.options=a.extend({},k,c),this.group=h.get(this.options),this.rootGroup=this.options.rootGroup=this.options.rootGroup||this.group,this.parentContainer=this.options.parentContainer,this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector,this.el.on(j.start,this.handle,a.proxy(this.dragInit,this)),this.options.drop&&this.group.containers.push(this)}var j,k={drag:!0,drop:!0,exclude:"",nested:!0,vertical:!0},l={afterMove:function(){},containerPath:"",containerSelector:"ol, ul",distance:0,handle:"",itemPath:"",itemSelector:"li",isValidTarget:function(){return!0},onCancel:function(){},onDrag:function(a,b){a.css(b)},onDragStart:function(b){b.css({height:b.height(),width:b.width()}),b.addClass("dragged"),a("body").addClass("dragging")},onDrop:function(b){b.removeClass("dragged").removeAttr("style"),a("body").removeClass("dragging")},onMousedown:function(a,b){b.preventDefault()},placeholder:'<li class="placeholder"/>',pullPlaceholder:!0,serialize:function(b,c,d){return b=a.extend({},b.data()),d?c:(c[0]&&(b.children=c,delete b.subContainer),delete b.sortable,b)},tolerance:0},m={},n=0,o={left:0,top:0,bottom:0,right:0};j={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"},h.get=function(a){return m[a.group]||(a.group||(a.group=n++),m[a.group]=new h(a)),m[a.group]},h.prototype={dragInit:function(b,c){this.$document=a(c.el[0].ownerDocument),c.enabled()?(this.toggleListeners("on"),this.item=a(b.target).closest(this.options.itemSelector),this.itemContainer=c,this.setPointer(b),this.options.onMousedown(this.item,b,l.onMousedown)):this.toggleListeners("on",["drop"]),this.dragInitDone=!0},drag:function(a){if(!this.dragging){if(!this.distanceMet(a))return;this.options.onDragStart(this.item,this.itemContainer,l.onDragStart),this.item.before(this.placeholder),this.dragging=!0}this.setPointer(a),this.options.onDrag(this.item,f(this.pointer,this.item.offsetParent()),l.onDrag);var b=a.pageX,a=a.pageY,c=this.sameResultBox,d=this.options.tolerance;(!c||c.top-d>a||c.bottom+d<a||c.left-d>b||c.right+d<b)&&(this.searchValidTarget()||this.placeholder.detach())},drop:function(){this.toggleListeners("off"),this.dragInitDone=!1,this.dragging&&(this.placeholder.closest("html")[0]?this.placeholder.before(this.item).detach():this.options.onCancel(this.item,this.itemContainer,l.onCancel),this.options.onDrop(this.item,this.getContainer(this.item),l.onDrop),this.clearDimensions(),this.clearOffsetParent(),this.lastAppendedItem=this.sameResultBox=c,this.dragging=!1)},searchValidTarget:function(a,b){a||(a=this.relativePointer||this.pointer,b=this.lastRelativePointer||this.lastPointer);for(var d=g(this.getContainerDimensions(),a,b),e=d.length;e--;){var h=d[e][0];if((!d[e][1]||this.options.pullPlaceholder)&&(h=this.containers[h],!h.disabled)){if(!this.$getOffsetParent())var i=h.getItemOffsetParent(),a=f(a,i),b=f(b,i);if(h.searchValidTarget(a,b))return!0}}this.sameResultBox&&(this.sameResultBox=c)},movePlaceholder:function(a,b,c,d){var e=this.lastAppendedItem;!d&&e&&e[0]===b[0]||(b[c](this.placeholder),this.lastAppendedItem=b,this.sameResultBox=d,this.options.afterMove(this.placeholder,a))},getContainerDimensions:function(){return this.containerDimensions||e(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent()),this.containerDimensions},getContainer:function(a){return a.closest(this.options.containerSelector).data("sortable")},$getOffsetParent:function(){if(this.offsetParent===c){var a=this.containers.length-1,b=this.containers[a].getItemOffsetParent();if(!this.options.parentContainer)for(;a--;)if(b[0]!=this.containers[a].getItemOffsetParent()[0]){b=!1;break}this.offsetParent=b}return this.offsetParent},setPointer:function(a){if(a={left:a.pageX,top:a.pageY},this.$getOffsetParent()){var b=f(a,this.$getOffsetParent());this.lastRelativePointer=this.relativePointer,this.relativePointer=b}this.lastPointer=this.pointer,this.pointer=a},distanceMet:function(a){return Math.max(Math.abs(this.pointer.left-a.pageX),Math.abs(this.pointer.top-a.pageY))>=this.options.distance},scroll:function(){this.clearDimensions(),this.clearOffsetParent()},toggleListeners:function(b,c){var d=this,c=c||["drag","drop","scroll"];a.each(c,function(a,c){d.$document[b](j[c],d[c+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=c},clearDimensions:function(){this.containerDimensions=c;for(var a=this.containers.length;a--;)this.containers[a].clearDimensions()}},i.prototype={dragInit:function(b){var c=this.rootGroup;!c.dragInitDone&&1===b.which&&this.options.drag&&!a(b.target).is(this.options.exclude)&&c.dragInit(b,this)},searchValidTarget:function(a,b){var c=g(this.getItemDimensions(),a,b),d=c.length,e=this.rootGroup,f=!e.options.isValidTarget||e.options.isValidTarget(e.item,this);if(!d&&f)return e.movePlaceholder(this,this.el,"append"),!0;for(;d--;)if(e=c[d][0],!c[d][1]&&this.hasChildGroup(e)){if(this.getContainerGroup(e).searchValidTarget(a,b))return!0}else if(f)return this.movePlaceholder(e,a),!0},movePlaceholder:function(b,c){var d=a(this.items[b]),e=this.itemDimensions[b],f="after",g=d.outerWidth(),h=d.outerHeight(),i=d.offset(),i={left:i.left,right:i.left+g,top:i.top,bottom:i.top+h};this.options.vertical?c.top<=(e[2]+e[3])/2?(f="before",i.bottom-=h/2):i.top+=h/2:c.left<=(e[0]+e[1])/2?(f="before",i.right-=g/2):i.left+=g/2,this.hasChildGroup(b)&&(i=o),this.rootGroup.movePlaceholder(this,d,f,i)},getItemDimensions:function(){return this.itemDimensions||(this.items=this.$getChildren(this.el,"item").filter(":not(.placeholder, .dragged)").get(),e(this.items,this.itemDimensions=[],this.options.tolerance)),this.itemDimensions},getItemOffsetParent:function(){var a=this.el;return"relative"===a.css("position")||"absolute"===a.css("position")||"fixed"===a.css("position")?a:a.offsetParent()},hasChildGroup:function(a){return this.options.nested&&this.getContainerGroup(a)},getContainerGroup:function(b){var d=a.data(this.items[b],"subContainer");if(d===c){var e=this.$getChildren(this.items[b],"container"),d=!1;e[0]&&(d=a.extend({},this.options,{parentContainer:this,group:n++}),d=e.sortable(d).data("sortable").group),a.data(this.items[b],"subContainer",d)}return d},enabled:function(){return!this.disabled&&(!this.parentContainer||this.parentContainer.enabled())},$getChildren:function(b,c){var d=this.rootGroup.options,e=d[c+"Path"],d=d[c+"Selector"],b=a(b);return e&&(b=b.find(e)),b.children(d)},_serialize:function(b,c){var d=this,e=this.$getChildren(b,c?"item":"container").not(this.options.exclude).map(function(){return d._serialize(a(this),!c)}).get();return this.rootGroup.options.serialize(b,e,c)},clearDimensions:function(){if(this.itemDimensions=c,this.items&&this.items[0])for(var b=this.items.length;b--;){var d=a.data(this.items[b],"subContainer");d&&d.clearDimensions()}}};var p={enable:function(){this.disabled=!1},disable:function(){this.disabled=!0},serialize:function(){return this._serialize(this.el,!0)}};a.extend(i.prototype,p),a.fn.sortable=function(b){var d=Array.prototype.slice.call(arguments,1);return this.map(function(){var e=a(this),f=e.data("sortable");return f&&p[b]?p[b].apply(f,d)||this:(!f&&(b===c||"object"==typeof b)&&e.data("sortable",new i(e,b)),this)})}}(jQuery,window);