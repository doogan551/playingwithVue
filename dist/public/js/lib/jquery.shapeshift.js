(function(){!function(a,b,c){var d,e,f;return f="shapeshift",e={selector:"*",enableDrag:!0,enableCrossDrop:!0,enableResize:!0,enableTrash:!1,align:"center",colWidth:null,columns:null,minColumns:1,autoHeight:!0,maxHeight:null,minHeight:100,gutterX:10,gutterY:10,paddingX:10,paddingY:10,animated:!0,animateOnInit:!1,animationSpeed:225,animationThreshold:100,dragClone:!1,deleteClone:!0,dragRate:100,dragWhitelist:"*",crossDropWhitelist:"*",cutoffStart:null,cutoffEnd:null,handle:!1,cloneClass:"ss-cloned-child",activeClass:"ss-active-child",draggedClass:"ss-dragged-child",placeholderClass:"ss-placeholder-child",originalContainerClass:"ss-original-container",currentContainerClass:"ss-current-container",previousContainerClass:"ss-previous-container"},d=function(){function c(b,c){this.element=b,this.options=a.extend({},e,c),this.globals={},this.$container=a(b),this.errorCheck()&&this.init()}return c.prototype.errorCheck=function(){var a,b,c,d;return d=this.options,c=!1,b="Shapeshift ERROR:",null===d.colWidth&&(a=this.$container.children(d.selector),0===a.length&&(c=!0,console.error(""+b+" option colWidth must be specified if Shapeshift is initialized with no active children."))),!c},c.prototype.init=function(){return this.createEvents(),this.setGlobals(),this.setIdentifier(),this.setActiveChildren(),this.enableFeatures(),this.gridInit(),this.render(),this.afterInit()},c.prototype.createEvents=function(){var a,b,c=this;return b=this.options,a=this.$container,a.off("ss-arrange").on("ss-arrange",function(a,b){return null==b&&(b=!1),c.render(!1,b)}),a.off("ss-rearrange").on("ss-rearrange",function(){return c.render(!0)}),a.off("ss-setTargetPosition").on("ss-setTargetPosition",function(){return c.setTargetPosition()}),a.off("ss-destroy").on("ss-destroy",function(){return c.destroy()}),a.off("ss-shuffle").on("ss-shuffle",function(){return c.shuffle()})},c.prototype.setGlobals=function(){return this.globals.animated=this.options.animateOnInit,this.globals.dragging=!1},c.prototype.afterInit=function(){return this.globals.animated=this.options.animated},c.prototype.setIdentifier=function(){return this.identifier="shapeshifted_container_"+Math.random().toString(36).substring(7),this.$container.addClass(this.identifier)},c.prototype.enableFeatures=function(){if(this.options.enableResize&&this.enableResize(),this.options.enableDrag||this.options.enableCrossDrop)return this.enableDragNDrop()},c.prototype.setActiveChildren=function(){var b,c,d,e,f,g,h,i,j,k,l,m;for(h=this.options,b=this.$container.children(h.selector),c=h.activeClass,i=b.length,f=j=0;0<=i?j<i:j>i;f=0<=i?++j:--j)a(b[f]).addClass(c);for(this.setParsedChildren(),e=h.columns,m=[],f=k=0,l=this.parsedChildren.length;0<=l?k<l:k>l;f=0<=l?++k:--k)d=this.parsedChildren[f].colspan,g=h.minColumns,d>e&&d>g?(h.minColumns=d,m.push(console.error("Shapeshift ERROR: There are child elements that have a larger colspan than the minimum columns set through options.\noptions.minColumns has been set to "+d))):m.push(void 0);return m},c.prototype.setParsedChildren=function(){var b,c,d,e,f,g,h;for(c=this.$container.find("."+this.options.activeClass).filter(":visible"),g=c.length,f=[],e=h=0;0<=g?h<g:h>g;e=0<=g?++h:--h)b=a(c[e]),d={i:e,el:b,colspan:parseInt(b.attr("data-ss-colspan"))||1,height:b.outerHeight()},f.push(d);return this.parsedChildren=f},c.prototype.gridInit=function(){var a,b,c,d,e;return d=this.options.gutterX,this.options.colWidth>=1?this.globals.col_width=this.options.colWidth+d:(c=this.parsedChildren[0],b=c.el.outerWidth(),a=c.colspan,e=(b-(a-1)*d)/a,this.globals.col_width=e+d)},c.prototype.render=function(a,b){return null==a&&(a=!1),a&&this.setActiveChildren(),this.setGridColumns(),this.arrange(!1,b)},c.prototype.setGridColumns=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o;if(f=this.globals,l=this.options,c=f.col_width,h=l.gutterX,m=l.paddingX,j=this.$container.innerWidth()-2*m,k=l.minColumns,e=l.columns||Math.floor((j+h)/c),k&&k>e&&(e=k),f.columns=e,b=this.parsedChildren.length,e>b){for(a=0,i=n=0,o=this.parsedChildren.length;0<=o?n<o:n>o;i=0<=o?++n:--n)d=this.parsedChildren[i].colspan,d+a<=e&&(a+=d);e=a}switch(f.child_offset=m,l.align){case"center":return g=e*c-h,f.child_offset+=(j-g)/2;case"right":return g=e*c-h,f.child_offset+=j-g}},c.prototype.arrange=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;for(a&&this.setParsedChildren(),k=this.globals,p=this.options,d=this.$container,h=this.getPositions(),q=this.parsedChildren,s=q.length,e=k.animated&&s<=p.animationThreshold,f=p.animationSpeed,j=p.draggedClass,l=t=0;0<=s?t<s:t>s;l=0<=s?++t:--t)c=q[l].el,g=h[l],m=c.hasClass(j),m&&(r=p.placeholderClass,c=c.siblings("."+r)),e&&!m?c.stop(!0,!1).animate(g,f,function(){}):c.css(g);if(b&&(e?setTimeout(function(){return d.trigger("ss-drop-complete")},f):d.trigger("ss-drop-complete")),d.trigger("ss-arranged"),p.autoHeight)return i=k.container_height,n=p.maxHeight,o=p.minHeight,o&&i<o?i=o:n&&i>n&&(i=n),d.height(i)},c.prototype.getPositions=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=this;for(null==a&&(a=!0),f=this.globals,j=this.options,h=j.gutterY,k=j.paddingY,e=j.draggedClass,l=this.parsedChildren,q=l.length,b=[],i=r=0,s=f.columns;0<=s?r<s:r>s;i=0<=s?++r:--r)b.push(k);return o=function(a){var c,d,e,g,i,j,k;if(c=a.col,d=a.colspan,g=a.col*f.col_width+f.child_offset,i=b[c],m[a.i]={left:g,top:i},b[c]+=a.height+h,d>=1){for(k=[],e=j=1;1<=d?j<d:j>d;e=1<=d?++j:--j)k.push(b[c+e]=b[c]);return k}},c=function(a){var c,d,e,f,g,h,i,j,k,l,m,n;for(k=b.length-a.colspan+1,j=b.slice(0).splice(0,k),c=void 0,i=m=0;0<=k?m<k:m>k;i=0<=k?++m:--m){for(d=t.lowestCol(j,i),e=a.colspan,f=b[d],g=!0,l=n=1;1<=e?n<e:n>e;l=1<=e?++n:--n)if(h=b[d+l],f<h){g=!1;break}if(g){c=d;break}}return c},p=[],n=function(){var a,b,d,e,f,g,h,i,j,k;for(f=[],e=g=0,i=p.length;0<=i?g<i:g>i;e=0<=i?++g:--g)d=p[e],d.col=c(d),d.col>=0&&(o(d),f.push(e));for(k=[],b=h=j=f.length-1;h>=0;b=h+=-1)a=f[b],k.push(p.splice(a,1));return k},m=[],(d=function(){var d,f,g;for(g=[],i=f=0;0<=q?f<q:f>q;i=0<=q?++f:--f)d=l[i],a||!d.el.hasClass(e)?(d.colspan>1?d.col=c(d):d.col=t.lowestCol(b),void 0===d.col?p.push(d):o(d),g.push(n())):g.push(void 0);return g})(),j.autoHeight&&(g=b[this.highestCol(b)]-h,f.container_height=g+k),m},c.prototype.enableDragNDrop=function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=this;if(o=this.options,d=this.$container,g=o.activeClass,n=o.draggedClass,q=o.placeholderClass,p=o.originalContainerClass,i=o.currentContainerClass,r=o.previousContainerClass,j=o.deleteClone,l=o.dragRate,k=o.dragClone,h=o.cloneClass,f=e=c=t=s=null,m=!1,o.enableDrag&&d.children("."+g).filter(o.dragWhitelist).draggable({addClasses:!1,containment:"document",handle:o.handle,zIndex:9999,start:function(b,d){var g;return u.globals.dragging=!0,f=a(b.target),k&&(c=f.clone(!1,!1).insertBefore(f).addClass(h)),f.addClass(n),g=f.prop("tagName"),e=a("<"+g+" class='"+q+"' style='height: "+f.height()+"px; width: "+f.width()+"px'></"+g+">"),f.parent().addClass(p).addClass(i),t=f.outerHeight()/2,s=f.outerWidth()/2},drag:function(c,d){return m||k&&j&&a("."+i)[0]===a("."+p)[0]||(e.remove().appendTo("."+i),a("."+i).trigger("ss-setTargetPosition"),m=!0,b.setTimeout(function(){return m=!1},l)),d.position.left=c.pageX-f.parent().offset().left-s,d.position.top=c.pageY-f.parent().offset().top-t},stop:function(){var b,d,g;return u.globals.dragging=!1,d=a("."+p),b=a("."+i),g=a("."+r),f.removeClass(n),a("."+q).remove(),k&&(j&&a("."+i)[0]===a("."+p)[0]?(c.remove(),a("."+i).trigger("ss-rearrange")):(c.removeClass(h),d.shapeshift(d.data("plugin_shapeshift").options),b.shapeshift(b.data("plugin_shapeshift").options))),d[0]===b[0]?b.trigger("ss-rearranged",f):(d.trigger("ss-removed",f),b.trigger("ss-added",f)),d.trigger("ss-arrange").removeClass(p),b.trigger("ss-arrange",!0).removeClass(i),g.trigger("ss-arrange").removeClass(r),f=e=null}}),o.enableCrossDrop)return d.droppable({accept:o.crossDropWhitelist,tolerance:"intersect",over:function(b){return a("."+r).removeClass(r),a("."+i).removeClass(i).addClass(r),a(b.target).addClass(i)},drop:function(b,c){var d,e,g;if(u.options.enableTrash)return e=a("."+p),d=a("."+i),g=a("."+r),f=a(c.helper),d.trigger("ss-trashed",f),f.remove(),e.trigger("ss-rearrange").removeClass(p),d.trigger("ss-rearrange").removeClass(i),g.trigger("ss-arrange").removeClass(r)}})},c.prototype.setTargetPosition=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(k=this.options,k.enableTrash)return m=this.options.placeholderClass,a("."+m).remove();if(j=k.draggedClass,b=a("."+j),c=b.parent(),l=this.parsedChildren,f=this.getPositions(!1),t=f.length,p=b.offset().left-c.offset().left+this.globals.col_width/2,q=b.offset().top-c.offset().top+b.height()/2,r=9999999,s=0,t>1){for(h=k.cutoffStart+1||0,g=k.cutoffEnd||t,n=w=h;h<=g?w<g:w>g;n=h<=g?++w:--w)e=f[n],e&&(v=p-e.left,u=q-e.top,v>0&&u>0&&(i=Math.sqrt(u*u+v*v),i<r&&(r=i,s=n,n===t-1&&v>l[n].height/2&&s++)));s===l.length?(d=l[s-1].el,b.insertAfter(d)):(d=l[s].el,b.insertBefore(d))}else 1===t?(e=f[0],e.left<p?this.$container.append(b):this.$container.prepend(b)):this.$container.append(b);return this.arrange(!0),c[0]!==b.parent()[0]?(o=k.previousContainerClass,1==a("."+o).data("plugin_shapeshift").options.enableCrossDrop?a("."+o).trigger("ss-rearrange"):a("."+o)):void 0},c.prototype.enableResize=function(){var c,d,e,f=this;return c=this.options.animationSpeed,e=!1,d="resize."+this.identifier,a(b).on(d,function(){if(!e)return e=!0,setTimeout(function(){return f.render()},c/3),setTimeout(function(){return f.render()},c/3),setTimeout(function(){return e=!1,f.render()},c/3)})},c.prototype.shuffle=function(){var a;if(a=function(a,b){var c;return c=function(a){var b,c,d;for(c=void 0,d=void 0,b=a.length;b;)c=parseInt(Math.random()*b),d=a[--b],a[b]=a[c],a[c]=d;return a},a.each(function(){var d;return d=a.find("."+b).filter(":visible"),d.length?a.html(c(d)):this})},!this.globals.dragging)return a(this.$container,this.options.activeClass),this.enableFeatures(),this.$container.trigger("ss-rearrange")},c.prototype.lowestCol=function(a,b){var c,d,e,f;for(null==b&&(b=0),e=a.length,c=[],d=f=0;0<=e?f<e:f>e;d=0<=e?++f:--f)c.push([a[d],d]);return c.sort(function(a,b){var c;return c=a[0]-b[0],0===c&&(c=a[1]-b[1]),c}),c[b][1]},c.prototype.highestCol=function(c){return a.inArray(Math.max.apply(b,c),c)},c.prototype.destroy=function(){var a,b,c;return b=this.$container,b.off("ss-arrange"),b.off("ss-rearrange"),b.off("ss-setTargetPosition"),b.off("ss-destroy"),c=this.options.activeClass,a=b.find("."+c),this.options.enableDrag&&a.draggable("destroy"),this.options.enableCrossDrop&&b.droppable("destroy"),a.removeClass(c),b.removeClass(this.identifier)},c}(),a.fn[f]=function(c){return this.each(function(){var e,g,h,i;return g=null!=(h=a(this).attr("class"))&&null!=(i=h.match(/shapeshifted_container_\w+/))?i[0]:void 0,g&&(e="resize."+g,a(b).off(e),a(this).removeClass(g)),a.data(this,"plugin_"+f,new d(this,c))})}}(jQuery,window,document)}).call(this);