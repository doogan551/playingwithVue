(function(){var a={requires:[]};window.require&&a.requires.push(window.require),"undefined"!=typeof b&&null!==b&&a.requires.push(b),function(){"use strict";var b={},c={},d=function(a,b){return{}.hasOwnProperty.call(a,b)},e=function(a,b){var c,d,e=[];c=/^\.\.?(\/|$)/.test(b)?[a,b].join("/").split("/"):b.split("/");for(var f=0,g=c.length;g>f;f++)d=c[f],".."===d?e.pop():"."!==d&&""!==d&&e.push(d);return e.join("/")},f=function(a){return a.split("/").slice(0,-1).join("/")},g=function(b){var c=function(c){var d=f(b),g=e(d,c);return a.require(g,b)};return c.register=a.require.register,c.shim=a.require.shim,c},h=function(a,b){var d={id:a,exports:{}};return c[a]=d,b(d.exports,g(a),d),d.exports},i=function(a,f){var g=e(a,".");if(null==f&&(f="/"),d(c,g))return c[g].exports;if(d(b,g))return h(g,b[g]);var i=e(g,"./index");if(d(c,i))return c[i].exports;if(d(b,i))return h(i,b[i]);throw new Error('Cannot find module "'+a+'" from "'+f+'"')},j=function(a,c){if("object"==typeof a)for(var e in a)d(a,e)&&(b[e]=a[e]);else b[a]=c},k=Object.prototype.toString,l=function(a){return"[object Array]"===k.call(a)},m=function(b){if("undefined"!=typeof window){l(b)||(b=[b]);for(var c=function(b){var c;try{if(a.require(b.path))return}catch(d){}try{for(var e=0,f=a.requires.length;f>e&&!(c=a.requires[e](b.path));e++);}catch(d){}if(!c&&b.symbol){var g=b.symbol.split(".");c=window;for(var h=0,i=g.length;i>h&&(c=c[g[h]]);h++);}if(!c){if(b.optional)return;throw new Error("Missing dependency: "+b.path)}a.require.register(b.path,function(a,b,d){return d.exports=c}),b.alias&&a.require.register(b.alias,function(a,b,d){return d.exports=c})},d=0,e=b.length;e>d;d++)c(b[d])}};a.require=i,a.require.register=j,a.require.shim=m}.call(this);var b=a.require;b.register("collection-observable",function(a,b){var c,d,e,f,g,h,i=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};f=b("./kb"),h=b("underscore"),g=b("knockout"),e=0,c=-1,d=1,f.compare=function(a,b){return h.isString(a)?a.localeCompare(""+b):h.isString(b)?b.localeCompare(""+a):a===b?e:b>a?c:d},f.CollectionObservable=function(){function a(a,b){return f.ignore(function(c){return function(){var d,e,i;return!h.isUndefined(b)||a instanceof f.Collection?h.isArray(a)&&(a=new f.Collection(a)):(i=[new f.Collection,a],a=i[0],b=i[1]),b||(b={}),e=f.utils.wrappedObservable(c,g.observableArray([])),e.__kb_is_co=!0,c.in_edit=0,c.__kb||(c.__kb={}),c.__kb._onCollectionChange=h.bind(c._onCollectionChange,c),b=f.utils.collapseOptions(b),b.auto_compact&&(c.auto_compact=!0),c._comparator=g.observable(b.sort_attribute?c._attributeComparator(b.sort_attribute):b.comparator),c._filters=g.observableArray(b.filters?h.isArray(b.filters)?b.filters:b.filters?[b.filters]:void 0:[]),d=c.create_options={store:f.Store.useOptionsOrCreate(b,a,e)},c.path=b.path,d.factory=f.utils.wrappedFactory(e,c._shareOrCreateFactory(b)),d.path=f.utils.pathJoin(b.path,"models"),d.creator=d.factory.creatorForPath(null,d.path),d.creator&&(c.models_only=d.creator.models_only),f.publishMethods(e,c,["destroy","shareOptions","filters","comparator","sortAttribute","viewModelByModel","hasViewModels"]),c._collection=g.observable(a),e.collection=c.collection=g.dependentObservable({read:function(){return c._collection()},write:function(a){return f.ignore(function(){var b;if((b=c._collection())!==a)return b&&b.unbind("all",c.__kb._onCollectionChange),a&&a.bind("all",c.__kb._onCollectionChange),c._collection(a)})}}),a&&a.bind("all",c.__kb._onCollectionChange),c._mapper=g.dependentObservable(function(){var a,b,d,i,j,k,l,m;if(a=c._comparator(),i=c._filters())for(l=0,m=i.length;m>l;l++)d=i[l],g.utils.unwrapObservable(d);return b=c._collection(),c.in_edit?void 0:(e=f.utils.wrappedObservable(c),b&&(j=b.models),j&&0!==b.models.length?(j=h.filter(j,function(a){return!i.length||c._selectModel(a)}),k=a?h.map(j,function(a){return c._createViewModel(a)}).sort(a):c.models_only?i.length?j:j.slice():h.map(j,function(a){return c._createViewModel(a)})):k=[],c.in_edit++,e(k),c.in_edit--)}),e.subscribe(h.bind(c._onObservableArrayChange,c)),!f.statistics||f.statistics.register("CollectionObservable",c),e}}(this))}return a.extend=f.extend,a.prototype.destroy=function(){var a,b,c;return c=f.utils.wrappedObservable(this),b=this._collection(),b&&(b.unbind("all",this.__kb._onCollectionChange),a=c(),a.splice(0,a.length)),this.collection.dispose(),this._collection=c.collection=this.collection=null,this._mapper.dispose(),this._mapper=null,f.release(this._filters),this._filters=null,this._comparator(null),this._comparator=null,this.create_options=null,c.collection=null,f.utils.wrappedDestroy(this),!f.statistics||f.statistics.unregister("CollectionObservable",this)},a.prototype.shareOptions=function(){var a;return a=f.utils.wrappedObservable(this),{store:f.utils.wrappedStore(a),factory:f.utils.wrappedFactory(a)}},a.prototype.filters=function(a){return this._filters(a?h.isArray(a)?a:[a]:[])},a.prototype.comparator=function(a){return this._comparator(a)},a.prototype.sortAttribute=function(a){return this._comparator(a?this._attributeComparator(a):null)},a.prototype.viewModelByModel=function(a){var b;return this.models_only?null:(b=a.hasOwnProperty(a.idAttribute)?a.idAttribute:"cid",h.find(f.peek(f.utils.wrappedObservable(this)),function(c){var d;return!(null==c||null==(d=c.__kb)||!d.object)&&c.__kb.object[b]===a[b]}))},a.prototype.hasViewModels=function(){return!this.models_only},a.prototype.compact=function(){return f.ignore(function(a){return function(){var b;return b=f.utils.wrappedObservable(a),f.utils.wrappedStoreIsOwned(b)?(f.utils.wrappedStore(b).clear(),a._collection.notifySubscribers(a._collection())):void 0}}(this))},a.prototype._shareOrCreateFactory=function(a){var b,c,d,e;if(b=f.utils.pathJoin(a.path,"models"),d=a.factories,(e=a.factory)&&(c=e.creatorForPath(null,b))&&(!d||d.models===c)){if(!d)return e;if(e.hasPathMappings(d,a.path))return e}return e=new f.Factory(a.factory),d&&e.addPathMappings(d,a.path),e.creatorForPath(null,b)||(a.hasOwnProperty("models_only")?a.models_only?e.addPathMapping(b,{models_only:!0}):e.addPathMapping(b,f.ViewModel):a.view_model?e.addPathMapping(b,a.view_model):a.create?e.addPathMapping(b,{create:a.create}):e.addPathMapping(b,f.ViewModel)),e},a.prototype._onCollectionChange=function(a,b){return f.ignore(function(c){return function(){var d,e,g,h;if(!c.in_edit)switch(a){case"reset":c.auto_compact?c.compact():c._collection.notifySubscribers(c._collection());break;case"sort":case"resort":c._collection.notifySubscribers(c._collection());break;case"new":case"add":if(!c._selectModel(b))return;if(g=f.utils.wrappedObservable(c),d=c._collection(),-1===d.indexOf(b))return;if(h=c.viewModelByModel(b))return;c.in_edit++,h=c._createViewModel(b),(e=c._comparator())?(g().push(h),g.sort(e)):g.splice(d.indexOf(b),0,h),c.in_edit--;break;case"remove":case"destroy":c._onModelRemove(b);break;case"change":c._selectModel(b)?(h=c.models_only?b:c.viewModelByModel(b),h?(e=c._comparator())&&(g=f.utils.wrappedObservable(c),c.in_edit++,g.sort(e),c.in_edit--):c._onCollectionChange("add",b)):c._onModelRemove(b)}}}(this))},a.prototype._onModelRemove=function(a){var b,c;return(c=this.models_only?a:this.viewModelByModel(a))?(b=f.utils.wrappedObservable(this),this.in_edit++,b.remove(c),this.in_edit--):void 0},a.prototype._onObservableArrayChange=function(a){return f.ignore(function(b){return function(){var c,d,e,g,i,j,k,l,m;if(!b.in_edit&&(b.models_only&&(!a.length||f.utils.hasModelSignature(a[0]))||!b.models_only&&(!a.length||h.isObject(a[0])&&!f.utils.hasModelSignature(a[0]))||f._throwUnexpected(b,"incorrect type passed"),i=f.utils.wrappedObservable(b),c=f.peek(b._collection),d=f.peek(b._filters).length,c)){if(k=a,b.models_only)g=h.filter(a,function(a){return!d||b._selectModel(a)});else for(!d||(k=[]),g=[],l=0,m=a.length;m>l;l++){if(j=a[l],e=f.utils.wrappedObject(j),d){if(!b._selectModel(e))continue;k.push(j)}b.create_options.store.findOrReplace(e,b.create_options.creator,j),g.push(e)}b.in_edit++,a.length===k.length||i(k),h.isEqual(c.models,g)||c.reset(g),b.in_edit--}}}(this))},a.prototype._attributeComparator=function(a){var b;return b=function(b,c){var d;return d=g.utils.unwrapObservable(a),f.compare(b.get(d),c.get(d))},this.models_only?b:function(a,c){return b(f.utils.wrappedModel(a),f.utils.wrappedModel(c))}},a.prototype._createViewModel=function(a){return this.models_only?a:this.create_options.store.findOrCreate(a,this.create_options)},a.prototype._selectModel=function(a){var b,c,d,e,g;for(c=f.peek(this._filters),d=0,e=c.length;e>d;d++)if(b=c[d],b=f.peek(b),h.isFunction(b)){if(!b(a))return!1}else if(h.isArray(b)){if(g=a.id,i.call(b,g)<0)return!1}else if(a.id!==b)return!1;return!0},a}(),f.collectionObservable=function(a,b){return new f.CollectionObservable(a,b)}}),b.register("event-watcher",function(a,b){var c,d,e,f=function(a,b){return function(){return a.apply(b,arguments)}},g=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};c=b("./kb"),e=b("underscore"),d=b("knockout"),c.EventWatcher=function(){function a(a,b,c){this._onModelUnloaded=f(this._onModelUnloaded,this),this._onModelLoaded=f(this._onModelLoaded,this),this.__kb||(this.__kb={}),this.__kb.callbacks={},this.__kb._onModelLoaded=e.bind(this._onModelLoaded,this),this.__kb._onModelUnloaded=e.bind(this._onModelUnloaded,this),c&&this.registerCallbacks(b,c),a?this.emitter(a):this.ee=null}return a.useOptionsOrCreate=function(a,b,d,e){return a.event_watcher?(a.event_watcher.emitter()!==b&&a.event_watcher.model_ref!==b&&c._throwUnexpected(this,"emitter not matching"),c.utils.wrappedEventWatcher(d,a.event_watcher).registerCallbacks(d,e)):(c.utils.wrappedEventWatcherIsOwned(d,!0),c.utils.wrappedEventWatcher(d,new c.EventWatcher(b)).registerCallbacks(d,e))},a.prototype.destroy=function(){return this.emitter(null),this.__kb.callbacks=null,c.utils.wrappedDestroy(this)},a.prototype.emitter=function(a){var b,d,e,f,g,h,i,j;if(0===arguments.length||this.ee===a)return this.ee;this.model_ref&&(this.model_ref.unbind("loaded",this.__kb._onModelLoaded),this.model_ref.unbind("unloaded",this.__kb._onModelUnloaded),this.model_ref.release(),this.model_ref=null),c.Backbone&&c.Backbone.ModelRef&&a instanceof c.Backbone.ModelRef?(this.model_ref=a,this.model_ref.retain(),this.model_ref.bind("loaded",this.__kb._onModelLoaded),this.model_ref.bind("unloaded",this.__kb._onModelUnloaded),a=this.model_ref.model()):delete this.model_ref,g=this.ee,this.ee=a,j=this.__kb.callbacks;for(d in j)for(b=j[d],g&&g.unbind(d,b.fn),a&&this.ee.bind(d,b.fn),f=b.list,h=0,i=f.length;i>h;h++)e=f[h],e.emitter&&e.emitter(this.ee);return a},a.prototype.registerCallbacks=function(a,b){var f,h,i,j,k,l,m,n;for(a||c._throwMissing(this,"obj"),b||c._throwMissing(this,"info"),j=b.event_selector?b.event_selector:"change",i=j.split(" "),m=0,n=i.length;n>m;m++)h=i[m],h&&(f=this.__kb.callbacks[h],f||(l=[],f={list:l,fn:function(){return function(a){var b,e,f;for(e=0,f=l.length;f>e;e++)if(b=l[e],b.update&&!b.rel_fn){if(a&&b.key&&a.hasChanged&&!a.hasChanged(d.utils.unwrapObservable(b.key)))continue;!c.statistics||c.statistics.addModelEvent({name:h,model:a,key:b.key,path:b.path}),b.update()}return null}}(this)},this.__kb.callbacks[h]=f,this.ee&&this.ee.bind(h,f.fn)),k=e.defaults({obj:a},b),f.list.push(k));this.ee&&(g.call(i,"change")>=0&&(k.unbind_fn=c.orm.bind(this.ee,k.key,k.update,k.path)),k.emitter(this.ee)&&k.emitter)},a.prototype.releaseCallbacks=function(a){var b,d,e,f,g,h;if(this.__kb.callbacks&&this.ee){g=this.__kb.callbacks;for(d in g){b=g[d],h=b.list;for(e in h)if(f=h[e],f.obj===a)return b.list.splice(e,1),f.unbind_fn&&(f.unbind_fn(),f.unbind_fn=null),void(!c.wasReleased(a)&&f.emitter&&f.emitter(null))}}},a.prototype._onModelLoaded=function(a){var b,d,e,f,g,h,i;this.ee=a,h=this.__kb.callbacks;for(d in h)for(b=h[d],a.bind(d,b.fn),i=b.list,f=0,g=i.length;g>f;f++)e=i[f],e.unbind_fn=c.orm.bind(a,e.key,e.update,e.path),e.emitter&&e.emitter(a)},a.prototype._onModelUnloaded=function(a){var b,c,d,e,f,g,h;this.ee=null,h=this.__kb.callbacks;for(c in h)for(b=h[c],a.unbind(c,b.fn),e=b.list,f=0,g=e.length;g>f;f++)d=e[f],d.unbind_fn&&(d.unbind_fn(),d.unbind_fn=null),d.emitter&&d.emitter(null)},a}(),c.emitterObservable=function(a,b){return new c.EventWatcher(a,b)}}),b.register("factory",function(a,b){var c,d;c=b("./kb"),d=b("underscore"),c.Factory=function(){function a(a){this.parent_factory=a,this.paths={}}return a.useOptionsOrCreate=function(a,b,d){var e;return a.factory&&(!a.factories||a.factories&&a.factory.hasPathMappings(a.factories,d))?c.utils.wrappedFactory(b,a.factory):(e=c.utils.wrappedFactory(b,new c.Factory(a.factory)),a.factories&&e.addPathMappings(a.factories,d),e)},a.prototype.hasPath=function(a){return this.paths.hasOwnProperty(a)||this.parent_factory&&this.parent_factory.hasPath(a)},a.prototype.addPathMapping=function(a,b){return this.paths[a]=b},a.prototype.addPathMappings=function(a,b){var d,e;for(e in a)d=a[e],this.paths[c.utils.pathJoin(b,e)]=d},a.prototype.hasPathMappings=function(a,b){var d,e,f,g;d=!0;for(g in a)e=a[g],d&=(f=this.creatorForPath(null,c.utils.pathJoin(b,g)))&&e===f;return d},a.prototype.creatorForPath=function(a,b){var c;return(c=this.paths[b])?c.view_model?c.view_model:c:this.parent_factory&&(c=this.parent_factory.creatorForPath(a,b))?c:null},a}()}),b.register("index",function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;for(this.Parse&&(this.Backbone=this.Parse,this._=this.Parse._),"undefined"!=typeof window&&null!==window&&b.shim&&b.shim([{symbol:"_",path:"lodash",alias:"underscore",optional:!0},{symbol:"_",path:"underscore"},{symbol:"Backbone",path:"backbone"},{symbol:"ko",path:"knockout"}]),c.exports=g=b("./kb"),d=this.Parse?g.Parse=this.Parse:g.Backbone=b("backbone"),g.Collection=d.Collection,g.Model=d.Object||d.Model,g.Events=d.Events,g._=b("underscore"),g.ko=b("knockout"),n=["./utils","./event-watcher","./store","./factory","./observable","./view-model","./collection-observable","./orm","./inject"],h=0,k=n.length;k>h;h++)e=n[h],b(e);for(o=["./default-observable","./formatted-observable","./localized-observable","./statistics","./triggered-observable","./validation"],i=0,l=o.length;l>i;i++){e=o[i];try{b(e)}catch(q){f=q}}for(g.modules={},p=["underscore","backbone","knockout"],j=0,m=p.length;m>j;j++)e=p[j],g.modules[e]=b(e)}),b.register("inject",function(a,b){var c,d,e,f,g;c=b("./kb"),f=b("underscore"),d=b("knockout"),c.RECUSIVE_AUTO_INJECT=!0,d.bindingHandlers.inject={init:function(a,b,e,f){return c.Inject.inject(d.utils.unwrapObservable(b()),f,a,b,e)}},c.Inject=function(){function a(){}return a.inject=function(a,b,e,g,h,i){var j,k,l;return j=function(a){var d,j,k;if(f.isFunction(a))b=new a(b,e,g,h),c.releaseOnNodeRemove(b,e);else{a.view_model&&(b=new a.view_model(b,e,g,h),c.releaseOnNodeRemove(b,e));for(d in a)k=a[d],"view_model"!==d&&("create"===d?k(b,e,g,h):f.isObject(k)&&!f.isFunction(k)?(j=i||k&&k.create?{}:b,b[d]=c.Inject.inject(k,j,e,g,h,!0)):b[d]=k)}return b},i?j(a):(k=(l=d.dependentObservable(function(){return j(a)}))(),l.dispose(),k)},a.injectViewModels=function(a){var b,d,e,g,h,i,j,k,l,m;for(k=[],i=function(a){var b,c,d,e,g;for(a.__kb_injected||a.attributes&&(b=f.find(a.attributes,function(a){return"kb-inject"===a.name}))&&(a.__kb_injected=!0,k.push({el:a,view_model:{},binding:b.value})),g=a.childNodes,d=0,e=g.length;e>d;d++)c=g[d],i(c)},a||"undefined"==typeof document||null===document||(a=document),i(a),l=0,m=k.length;m>l;l++)d=k[l],(h=d.binding)&&(h.search(/[:]/)<0||(h="{"+h+"}"),g=new Function("","return ( "+h+" )")(),g||(g={}),!g.options||(j=g.options,delete g.options),j||(j={}),d.view_model=c.Inject.inject(g,d.view_model,d.el,null,null,!0),b=d.view_model.afterBinding||j.afterBinding,e=d.view_model.beforeBinding||j.beforeBinding),e&&e(d.view_model,d.el,j),c.applyBindings(d.view_model,d.el,j),b&&b(d.view_model,d.el,j);return k},a}(),g=d.applyBindings,d.applyBindings=function(a,b){var d;return d=c.RECUSIVE_AUTO_INJECT?c.injectViewModels(b):[],d.length?void 0:g.apply(this,arguments)},c.injectViewModels=c.Inject.injectViewModels,"undefined"!=typeof document&&null!==document&&(this.$?this.$(function(){return c.injectViewModels()}):(e=function(){return"complete"!==document.readyState?setTimeout(e,0):c.injectViewModels()})())}),b.register("kb",function(a,b,c){var d,e,f,g;g=b("underscore"),f=b("knockout"),d=function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a};var h=function(){},i=function(a,b,c){var e;return e=b&&b.hasOwnProperty("constructor")?b.constructor:function(){a.apply(this,arguments)},d(e,a),h.prototype=a.prototype,e.prototype=new h,b&&d(e.prototype,b),c&&d(e,c),e.prototype.constructor=e,e.__super__=a.prototype,e},j=function(a,b){var c=i(this,a,b);return c.extend=this.extend,c};c.exports=e=function(){function a(){}var b;return a.VERSION="0.18.6",a.TYPE_UNKNOWN=0,a.TYPE_SIMPLE=1,a.TYPE_ARRAY=2,a.TYPE_MODEL=3,a.TYPE_COLLECTION=4,a.wasReleased=function(a){return!a||a.__kb_released},a.isReleaseable=function(b,c){var d,e;if(null==c&&(c=0),!b||b!==Object(b)||b.__kb_released)return!1;if(f.isObservable(b)||b instanceof a.ViewModel)return!0;if("function"==typeof b||b instanceof a.Model||b instanceof a.Collection)return!1;if("function"==typeof b.dispose||"function"==typeof b.destroy||"function"==typeof b.release)return!0;if(1>c)for(d in b)if(e=b[d],"__kb"!==d&&a.isReleaseable(e,c+1))return!0;return!1},a.release=function(b){var c,d,e;if(a.isReleaseable(b))if(g.isArray(b))for(d in b)e=b[d],a.isReleaseable(e)&&(b[d]=null,a.release(e));else if(b.__kb_released=!0,f.isObservable(b)&&g.isArray(c=a.peek(b))){if(b.__kb_is_co||b.__kb_is_o&&b.valueType()===a.TYPE_COLLECTION)b.destroy?b.destroy():b.dispose&&b.dispose();else if(c.length)for(d in c)e=c[d],a.isReleaseable(e)&&(c[d]=null,a.release(e))}else"function"==typeof b.release?b.release():"function"==typeof b.destroy?b.destroy():"function"==typeof b.dispose?b.dispose():f.isObservable(b)||this.releaseKeys(b)},a.releaseKeys=function(b){var c,d;for(c in b)d=b[c],"__kb"!==c&&a.isReleaseable(d)&&(b[c]=null,a.release(d))},a.releaseOnNodeRemove=function(b,c){return b||a._throwUnexpected(this,"missing view model"),c||a._throwUnexpected(this,"missing node"),f.utils.domNodeDisposal.addDisposeCallback(c,function(){return a.release(b)})},a.renderTemplate=function(b,c,d){var e,g;return null==d&&(d={}),"undefined"==typeof document||null===document?"undefined"!=typeof console&&null!==console?console.log("renderTemplate: document is undefined"):void 0:(e=document.createElement("div"),g=f.renderTemplate(b,c,d,e,"replaceChildren"),1===e.children.length&&(e=e.children[0]),a.releaseOnNodeRemove(c,e),g.dispose(),c.afterRender&&!d.afterRender&&c.afterRender(e),e)},a.applyBindings=function(b,c){return f.applyBindings(b,c),a.releaseOnNodeRemove(b,c)},a.getValue=function(b,c,d){return b?g.isFunction(b[c])&&a.orm.useFunction(b,c)?b[c]():d?b.get.apply(b,g.map([c].concat(d),function(b){return a.peek(b)})):b.get(c):void 0},a.setValue=function(b,c,d){var e;if(b)return g.isFunction(b[c])&&a.orm.useFunction(b,c)?b[c](d):((e={})[c]=d,b.set(e))},a.ignore=(null!=(b=f.dependencyDetection)?b.ignore:void 0)||function(a,b,c){var d;return d=null,f.dependentObservable(function(){return d=a.apply(b,c||[])}).dispose(),d},a.extend=j,a._throwMissing=function(a,b){throw""+(g.isString(a)?a:a.constructor.name)+": "+b+" is missing"},a._throwUnexpected=function(a,b){throw""+(g.isString(a)?a:a.constructor.name)+": "+b+" is unexpected"},a.publishMethods=function(b,c,d){var e,f,g;for(f=0,g=d.length;g>f;f++)e=d[f],b[e]=a._.bind(c[e],c)},a.peek=function(b){return f.isObservable(b)?b.peek?b.peek():a.ignore(function(){return b()}):b},a}()}),b.register("observable",function(a,b){var c,d,e;c=b("./kb"),e=b("underscore"),d=b("knockout"),c.Observable=function(){function a(a,b,f){return this._vm=null!=f?f:{},c.ignore(function(f){return function(){var g,h,i;return b||c._throwMissing(f,"options"),g=f.create_options=e.isString(b)||d.isObservable(b)?{key:b}:c.utils.collapseOptions(b),f.key=g.key,delete g.key,f.key||c._throwMissing(f,"key"),!g.args||(f.args=g.args,delete g.args),!g.read||(f.read=g.read,delete g.read),!g.write||(f.write=g.write,delete g.write),h=g.event_watcher,delete g.event_watcher,f._vo=d.observable(null),f._model=d.observable(),i=c.utils.wrappedObservable(f,d.dependentObservable({read:function(){var a,b,g,h,i,j;for(i=f._model(),j=b=[f.key].concat(f.args||[]),g=0,h=j.length;h>g;g++)a=j[g],d.utils.unwrapObservable(a);return f.read?f.update(f.read.apply(f._vm,b)):e.isUndefined(i)||c.ignore(function(){return f.update(c.getValue(i,c.peek(f.key),f.args))}),d.utils.unwrapObservable(f._vo())},write:function(a){return c.ignore(function(){var b,d;return b=c.utils.unwrapModels(a),d=c.peek(f._model),f.write?(f.write.call(f._vm,b),a=c.getValue(d,c.peek(f.key),f.args)):d&&c.setValue(d,c.peek(f.key),b),f.update(a)})},owner:f._vm})),i.__kb_is_o=!0,g.store=c.utils.wrappedStore(i,g.store),g.path=c.utils.pathJoin(g.path,f.key),g.factories&&("function"==typeof g.factories||g.factories.create)?(g.factory=c.utils.wrappedFactory(i,new c.Factory(g.factory)),g.factory.addPathMapping(g.path,g.factories)):g.factory=c.Factory.useOptionsOrCreate(g,i,g.path),delete g.factories,c.publishMethods(i,f,["value","valueType","destroy"]),i.model=f.model=d.dependentObservable({read:function(){return d.utils.unwrapObservable(f._model)},write:function(a){return c.ignore(function(){var b;if(!f.__kb_released&&c.peek(f._model)!==a)return b=c.getValue(a,c.peek(f.key),f.args),f._model(a),a?e.isUndefined(b)?void 0:f.update(b):f.update(null)})}}),c.EventWatcher.useOptionsOrCreate({event_watcher:h},a,f,{emitter:f.model,update:e.bind(f.update,f),key:f.key,path:g.path}),f.__kb_value||f.update(),c.LocalizedObservable&&g.localizer&&(i=new g.localizer(i),delete g.localizer),c.DefaultObservable&&g.hasOwnProperty("default")&&(i=c.defaultObservable(i,g["default"]),delete g["default"]),i}}(this))}return a.prototype.destroy=function(){var a;return a=c.utils.wrappedObservable(this),this.__kb_released=!0,c.release(this.__kb_value),this.__kb_value=null,this.model.dispose(),this.model=a.model=null,c.utils.wrappedDestroy(this)},a.prototype.value=function(){return this.__kb_value},a.prototype.valueType=function(){var a;return a=c.getValue(c.peek(this._model),c.peek(this.key)),this.value_type||this._updateValueObservable(a),this.value_type},a.prototype.update=function(a){var b,d;if(!this.__kb_released){if(arguments.length||(a=c.getValue(c.peek(this._model),c.peek(this.key))),void 0!==a||(a=null),b=c.utils.valueType(a),(!this.__kb_value||this.__kb_value.__kb_released||this.__kb_value.__kb_null&&a)&&(this.__kb_value=void 0,this.value_type=void 0),d=this.__kb_value,e.isUndefined(this.value_type)||this.value_type!==b&&b!==c.TYPE_UNKNOWN)return this.value_type===c.TYPE_COLLECTION&&b===c.TYPE_ARRAY?d(a):this._updateValueObservable(a);if(this.value_type===c.TYPE_MODEL){if("function"==typeof d.model){if(d.model()!==a)return d.model(a)}else if(c.utils.wrappedObject(d)!==a)return this._updateValueObservable(a)}else if(this.value_type===c.TYPE_COLLECTION){if(d.collection()!==a)return d.collection(a)}else if(d()!==a)return d(a)}},a.prototype._updateValueObservable=function(a){var b,f,g,h;return b=this.create_options,b.creator=c.utils.inferCreator(a,b.factory,b.path,c.peek(this._model),this.key),this.value_type=c.TYPE_UNKNOWN,f=b.creator,g=this.__kb_value,this.__kb_value=void 0,g&&c.release(g),f?b.store?h=b.store.findOrCreate(a,b):f.models_only?(h=a,this.value_type=c.TYPE_SIMPLE):h=f.create?f.create(a,b):new f(a,b):e.isArray(a)?(this.value_type=c.TYPE_ARRAY,h=d.observableArray(a)):(this.value_type=c.TYPE_SIMPLE,h=d.observable(a)),this.value_type===c.TYPE_UNKNOWN&&(d.isObservable(h)?this.value_type=h.__kb_is_co?c.TYPE_COLLECTION:c.TYPE_SIMPLE:(this.value_type=c.TYPE_MODEL,"function"!=typeof h.model&&c.utils.wrappedObject(h,a))),this.__kb_value=h,this._vo(h)},a}(),c.observable=function(a,b,d){return new c.Observable(a,b,d)}}),b.register("orm",function(a,b){var c,d,e,f,g,h;g=b("./kb"),h=b("underscore"),c=function(){function a(){this.adapters=[]}return a.prototype.initialize=function(){return this.adapters=h.select(this.adapters,function(a){return a.isAvailable()}),this.initialized=!0},a.prototype.addAdapter=function(a){return this.adapters.push(a),this.initialized=!1},a.prototype.keys=function(){return this._call("keys",arguments)},a.prototype.bind=function(){return this._call("bind",arguments)},a.prototype.useFunction=function(){return this._call("useFunction",arguments)},a.prototype._call=function(a,b){var c,d,e,f,g;if(this.adapters.length)for(this.initialized||this.initialize(),g=this.adapters,e=0,f=g.length;f>e;e++)if(c=g[e],c[a]&&(d=c[a].apply(c,b)))return d},a}(),g.orm=new c,e=function(){function a(){}return a.prototype.isAvailable=function(){var a,c;try{(null!=(a=g.Backbone)?a.RelationalModel:void 0)||("function"==typeof b?b("backbone-relational"):void 0)}catch(d){}return!!(null!=(c=g.Backbone)?c.RelationalModel:void 0)},a.prototype.relationType=function(a,b){var c;return a instanceof g.Backbone.RelationalModel&&(c=h.find(a.getRelations(),function(a){return a.key===b}))?c.collectionType||h.isArray(c.keyContents)?g.TYPE_COLLECTION:g.TYPE_MODEL:null},a.prototype.bind=function(a,b,c,d){var e,f,h,i,j,k;if(!(i=this.relationType(a,b)))return null;if(h=function(a){return!g.statistics||g.statistics.addModelEvent({name:"update (relational)",model:a,key:b,path:d}),c()},f=Backbone.Relation.prototype.sanitizeOptions?["update","add","remove"]:["change","add","remove"],i===g.TYPE_COLLECTION)for(j=0,k=f.length;k>j;j++)e=f[j],a.bind(""+e+":"+b,h);else a.bind(""+f[0]+":"+b,h);return function(){var c,d;if(i===g.TYPE_COLLECTION)for(c=0,d=f.length;d>c;c++)e=f[c],a.unbind(""+e+":"+b,h);else a.unbind(""+f[0]+":"+b,h)}},a}(),g.orm.addAdapter(new e),d=function(){function a(){}return a.prototype.isAvailable=function(){var a,c;try{(null!=(a=g.Backbone)?a.AssociatedModel:void 0)||("function"==typeof b?b("backbone-associations"):void 0)}catch(d){}return!!(null!=(c=g.Backbone)?c.AssociatedModel:void 0)},a.prototype.keys=function(a){return a instanceof g.Backbone.AssociatedModel?h.map(a.relations,function(a){return a.key}):null},a.prototype.relationType=function(a,b){var c;return a instanceof g.Backbone.AssociatedModel&&(c=h.find(a.relations,function(a){return a.key===b}))?"Many"===c.type?g.TYPE_COLLECTION:g.TYPE_MODEL:null},a}(),g.orm.addAdapter(new d),f=function(){function a(){}return a.prototype.isAvailable=function(){try{("undefined"!=typeof window&&null!==window?window.Supermodel:void 0)||("function"==typeof b?b("supermodel"):void 0)}catch(a){}return!!("undefined"!=typeof window&&null!==window?window.Supermodel:void 0)},a.prototype.keys=function(a){return a instanceof Supermodel.Model?h.keys(a.constructor.associations()):null},a.prototype.relationType=function(a,b){var c;return a instanceof Supermodel.Model&&(c=a.constructor.associations()[b])?c.add?g.TYPE_COLLECTION:g.TYPE_MODEL:null},a.prototype.bind=function(a,b,c,d){var e,f;return(f=this.relationType(a,b))?(e=function(a,e){var f,h;return!g.statistics||g.statistics.addModelEvent({name:"update (supermodel)",model:a,key:b,path:d}),h=a.constructor.associations()[b],f=a[h.store],a[h.store]=e,c(e),a[h.store]=f},f===g.TYPE_MODEL?(a.bind("associate:"+b,e),function(){return a.unbind("associate:"+b,e)}):void 0):null},a.prototype.useFunction=function(a,b){return!!this.relationType(a,b)},a}(),g.orm.addAdapter(new f)}),b.register("store",function(a,b,c){var d,e,f;d=b("./kb"),f=b("underscore"),e=b("knockout"),c.exports=d.Store=function(){function a(){this.observable_records=[],this.replaced_observables=[]}return a.useOptionsOrCreate=function(a,b,c){return a.store?(a.store.register(b,c,a),d.utils.wrappedStore(c,a.store)):(d.utils.wrappedStoreIsOwned(c,!0),d.utils.wrappedStore(c,new d.Store))},a.prototype.destroy=function(){return this.clear()},a.prototype.clear=function(){var a,b,c,e;for(e=this.observable_records.splice(0,this.observable_records.length),b=0,c=e.length;c>b;b++)a=e[b],d.release(a.observable);d.release(this.replaced_observables)},a.prototype.compact=function(){var a,b,c,d,e;c=[],d=this.observable_records;for(a in d)b=d[a],(null!=(e=b.observable)?e.__kb_released:void 0)&&c.push(b);c.length&&(this.observable_records=f.difference(this.observable_records,c))},a.prototype.register=function(a,b,c){var f;if(b&&!e.isObservable(b)&&!b.__kb_is_co)return d.utils.wrappedObject(b,a),a||(b.__kb_null=!0),f=c.creator?c.creator:c.path&&c.factory?c.factory.creatorForPath(a,c.path):null,f||(f=b.constructor),this.observable_records.push({obj:a,observable:b,creator:f}),b},a.prototype.findIndex=function(a,b){var c,e,g,h;if(g=[],!a||a instanceof d.Model){h=this.observable_records;for(c in h)if(e=h[c],e.observable)if(e.observable.__kb_released)g.push(e);else if((a||e.observable.__kb_null)&&(!a||!e.observable.__kb_null&&e.obj===a)&&(e.creator===b||e.creator.create&&e.creator.create===b.create))return g.length?(this.observable_records=f.difference(this.observable_records,g),f.indexOf(this.observable_records,e)):c}return g.length&&(this.observable_records=f.difference(this.observable_records,g)),-1},a.prototype.find=function(a,b){var c;return(c=this.findIndex(a,b))<0?null:this.observable_records[c].observable},a.prototype.isRegistered=function(a){var b,c,d,e;for(e=this.observable_records,c=0,d=e.length;d>c;c++)if(b=e[c],b.observable===a)return!0;return!1},a.prototype.findOrCreate=function(a,b){var c,f;return b.store=this,b.creator||(b.creator=d.utils.inferCreator(a,b.factory,b.path)),!b.creator&&a instanceof d.Model&&(b.creator=d.ViewModel),(c=b.creator)?c.models_only?a:(c&&(f=this.find(a,c)),f?f:(f=d.ignore(function(){return function(){return f=c.create?c.create(a,b):new c(a,b),f||e.observable(null)}}(this)),e.isObservable(f)||this.isRegistered(f)||this.register(a,f,b),f)):d.utils.createFromDefaultCreator(a,b)},a.prototype.findOrReplace=function(a,b,c){var e,f;return a||d._throwUnexpected(this,"obj missing"),(e=this.findIndex(a,b))<0?this.register(a,c,{creator:b}):(f=this.observable_records[e],d.utils.wrappedObject(f.observable)===a||d._throwUnexpected(this,"different object"),f.observable!==c&&(f.observable.constructor===c.constructor||d._throwUnexpected(this,"replacing different type"),this.replaced_observables.push(f.observable),f.observable=c),c)},a}()}),b.register("utils",function(a,b){var c,d,e,f,g,h,i,j;c=b("./kb"),e=b("underscore"),d=b("knockout"),j=c._wrappedKey=function(a,b,d){return 2===arguments.length?a&&a.__kb&&a.__kb.hasOwnProperty(b)?a.__kb[b]:void 0:(a||c._throwUnexpected(this,"no obj for wrapping "+b),a.__kb||(a.__kb={}),a.__kb[b]=d,d)},f=function(a,b){return Array.prototype.splice.call(a,1,0,b),a},h=function(a,b,c){return a[b]||(a[b]=[]),e.isArray(c)||(c=[c]),a[b]=a[b].length?e.union(a[b],c):c,a},i=function(a,b,c){return a[b]||(a[b]={}),e.extend(a[b],c)},g=function(a){var b,c,d,e;for(c={},d=0,e=a.length;e>d;d++)b=a[d],c[b]={key:b};return c},c.utils=function(){function a(){}return a.wrappedObservable=function(){return j.apply(this,f(arguments,"observable"))},a.wrappedObject=function(){return j.apply(this,f(arguments,"object"))},a.wrappedModel=function(a,b){return 1===arguments.length?(b=j(a,"object"),e.isUndefined(b)?a:b):j(a,"object",b)},a.wrappedStore=function(){return j.apply(this,f(arguments,"store"))},a.wrappedStoreIsOwned=function(){return j.apply(this,f(arguments,"store_is_owned"))},a.wrappedFactory=function(){return j.apply(this,f(arguments,"factory"))},a.wrappedEventWatcher=function(){return j.apply(this,f(arguments,"event_watcher"))},a.wrappedEventWatcherIsOwned=function(){return j.apply(this,f(arguments,"event_watcher_is_owned"))},a.wrappedDestroy=function(a){var b;if(a.__kb)return a.__kb.event_watcher&&a.__kb.event_watcher.releaseCallbacks(a),b=a.__kb,a.__kb=null,b.observable&&(b.observable.destroy=b.observable.release=null,this.wrappedDestroy(b.observable),b.observable=null),b.factory=null,b.event_watcher_is_owned&&b.event_watcher.destroy(),b.event_watcher=null,b.store_is_owned&&b.store.destroy(),
b.store=null},a.valueType=function(a){return a?a.__kb_is_o?a.valueType():a.__kb_is_co||a instanceof c.Collection?c.TYPE_COLLECTION:a instanceof c.ViewModel||a instanceof c.Model?c.TYPE_MODEL:e.isArray(a)?c.TYPE_ARRAY:c.TYPE_SIMPLE:c.TYPE_UNKNOWN},a.pathJoin=function(a,b){return(a?"."!==a[a.length-1]?""+a+".":a:"")+b},a.optionsPathJoin=function(a,b){return e.defaults({path:this.pathJoin(a.path,b)},a)},a.inferCreator=function(a,b,d){var e;return b&&(e=b.creatorForPath(a,d)),e?e:a?a instanceof c.Model?c.ViewModel:a instanceof c.Collection?c.CollectionObservable:null:null},a.createFromDefaultCreator=function(a,b){return a instanceof c.Model?c.viewModel(a,b):a instanceof c.Collection?c.collectionObservable(a,b):e.isArray(a)?d.observableArray(a):d.observable(a)},a.hasModelSignature=function(a){return a&&a.attributes&&!a.models&&"function"==typeof a.get&&"function"==typeof a.trigger},a.hasCollectionSignature=function(a){return a&&a.models&&"function"==typeof a.get&&"function"==typeof a.trigger},a.collapseOptions=function(a){var b,c,d,f;for(c={},a={options:a};a.options;){f=a.options;for(b in f)switch(d=f[b],b){case"internals":case"requires":case"excludes":case"statics":h(c,b,d);break;case"keys":e.isObject(d)&&!e.isArray(d)||e.isObject(c[b])&&!e.isArray(c[b])?(e.isObject(d)||(d=[d]),e.isArray(d)&&(d=g(d)),e.isArray(c[b])&&(c[b]=g(c[b])),i(c,b,d)):h(c,b,d);break;case"factories":e.isFunction(d)?c[b]=d:i(c,b,d);break;case"static_defaults":i(c,b,d);break;case"options":break;default:c[b]=d}a=a.options}return c},a.unwrapModels=function(a){var b,d,f;if(!a)return a;if(a.__kb)return"object"in a.__kb?a.__kb.object:a;if(e.isArray(a))return e.map(a,function(a){return c.utils.unwrapModels(a)});if(e.isObject(a)&&a.constructor==={}.constructor){d={};for(b in a)f=a[b],d[b]=c.utils.unwrapModels(f);return d}return a},a}()}),b.register("view-model",function(a,b){var c,d,e;c=b("./kb"),e=b("underscore"),d=b("knockout"),c.ViewModel=function(){function a(a,b,f){return c.ignore(function(g){return function(){var h,i,j,k,l,m,n,o,p,q;if(!a||a instanceof c.Model||"function"==typeof a.get&&"function"==typeof a.bind||c._throwUnexpected(g,"not a model"),b||(b={}),f||(f={}),b=e.isArray(b)?{keys:b}:c.utils.collapseOptions(b),g.__kb||(g.__kb={}),g.__kb.vm_keys={},g.__kb.model_keys={},g.__kb.view_model=e.isUndefined(f)?g:f,!b.internals||(g.__kb.internals=b.internals),!b.excludes||(g.__kb.excludes=b.excludes),!b.statics||(g.__kb.statics=b.statics),!b.static_defaults||(g.__kb.static_defaults=b.static_defaults),c.Store.useOptionsOrCreate(b,a,g),g.__kb.path=b.path,c.Factory.useOptionsOrCreate(b,g,b.path),p=c._wrappedKey(g,"_mdl",d.observable()),g.model=d.dependentObservable({read:function(){return p(),c.utils.wrappedObject(g)},write:function(a){return c.ignore(function(){var b,d,f,h;if(c.utils.wrappedObject(g)!==a){if(g.__kb_null)return void(!a||c._throwUnexpected(g,"model set on shared null"));if(c.utils.wrappedObject(g,a),b=c.utils.wrappedEventWatcher(g),!b)return void p(a);b.emitter(a),!g.__kb.keys&&a&&a.attributes&&(d=e.keys(a.attributes),a&&(h=c.orm.keys(a))&&(d=e.union(d,h)),f=e.difference(d,e.keys(g.__kb.model_keys)),f&&g.createObservables(a,f)),p(a)}})}}),j=c.utils.wrappedEventWatcher(g,new c.EventWatcher(a,g,{emitter:g.model})),k=b.requires,g.__kb.internals&&(k=e.union(k||[],g.__kb.internals)),a&&(n=c.orm.keys(a))&&(k=e.union(k||[],n)),b.keys)if(e.isObject(b.keys)&&!e.isArray(b.keys)){l={},q=b.keys;for(o in q)m=q[o],l[e.isString(m)?m:m.key?m.key:o]=!0;g.__kb.keys=e.keys(l)}else g.__kb.keys=b.keys,k=k?e.union(k,g.__kb.keys):e.clone(g.__kb.keys);else i=j.emitter(),i&&i.attributes&&(h=e.keys(i.attributes),k=k?e.union(k,h):h);return k&&g.__kb.excludes&&(k=e.difference(k,g.__kb.excludes)),k&&g.__kb.statics&&(k=e.difference(k,g.__kb.statics)),e.isObject(b.keys)&&!e.isArray(b.keys)&&g.mapObservables(a,b.keys),e.isObject(b.requires)&&!e.isArray(b.requires)&&g.mapObservables(a,b.requires),!b.mappings||g.mapObservables(a,b.mappings),!k||g.createObservables(a,k),!g.__kb.statics||g.createObservables(a,g.__kb.statics,!0),!c.statistics||c.statistics.register("ViewModel",g),g}}(this))}return a.extend=c.extend,a.prototype.destroy=function(){var a;if(this.__kb.view_model!==this)for(a in this.__kb.vm_keys)this.__kb.view_model[a]=null;return this.__kb.view_model=null,c.releaseKeys(this),c.utils.wrappedDestroy(this),!c.statistics||c.statistics.unregister("ViewModel",this)},a.prototype.shareOptions=function(){return{store:c.utils.wrappedStore(this),factory:c.utils.wrappedFactory(this)}},a.prototype.createObservables=function(a,b,d){var f,g,h,i,j,k;for(d?h=this.__kb.static_defaults||{}:f={store:c.utils.wrappedStore(this),factory:c.utils.wrappedFactory(this),path:this.__kb.path,event_watcher:c.utils.wrappedEventWatcher(this)},j=0,k=b.length;k>j;j++)g=b[j],i=this.__kb.internals&&e.contains(this.__kb.internals,g)?"_"+g:g,this[i]||(this.__kb.vm_keys[i]=this.__kb.model_keys[g]=!0,d?a.has(i)?this[i]=this.__kb.view_model[i]=a.get(i):i in h&&(this[i]=this.__kb.view_model[i]=h[i]):(f.key=g,this[i]=this.__kb.view_model[i]=c.observable(a,f,this)))},a.prototype.mapObservables=function(a,b){var d,f,g;d={store:c.utils.wrappedStore(this),factory:c.utils.wrappedFactory(this),path:this.__kb.path,event_watcher:c.utils.wrappedEventWatcher(this)};for(g in b)f=b[g],this[g]||(f=e.isString(f)?{key:f}:e.clone(f),f.key||(f.key=g),this.__kb.vm_keys[g]=this.__kb.model_keys[f.key]=!0,this[g]=this.__kb.view_model[g]=c.observable(a,e.defaults(f,d),this))},a}(),c.viewModel=function(a,b,d){return new c.ViewModel(a,b,d)}}),b.register("default-observable",function(a,b,c){var d,e,f,g;try{e=b("knockback")}catch(h){d=h,e=b("./kb")}g=b("underscore"),f=b("knockout"),b("./extensions"),c.exports=e.DefaultObservable=function(){function a(a,b){var c;return this.dv=b,c=e.utils.wrappedObservable(this,f.dependentObservable({read:function(b){return function(){var c;return(c=f.utils.unwrapObservable(a()))?c:f.utils.unwrapObservable(b.dv)}}(this),write:function(b){return a(b)}})),e.publishMethods(c,this,["destroy","setToDefault"]),c}return a.prototype.destroy=function(){return e.utils.wrappedDestroy(this)},a.prototype.setToDefault=function(){return e.utils.wrappedObservable(this)(this.dv)},a}(),e.defaultObservable=function(a,b){return new e.DefaultObservable(a,b)}}),b.register("extensions",function(a,b){var c,d,e,f;try{d=b("knockback")}catch(g){c=g,d=b("./kb")}f=b("underscore"),e=b("knockout"),d.Observable.prototype.setToDefault=function(){var a;null!=(a=this.__kb_value)&&"function"==typeof a.setToDefault&&a.setToDefault()},d.ViewModel.prototype.setToDefault=function(){var a,b;for(a in this.__kb.vm_keys)null!=(b=this[a])&&"function"==typeof b.setToDefault&&b.setToDefault()},d.utils.setToDefault=function(a){var b,c;if(a){if(e.isObservable(a))"function"==typeof a.setToDefault&&a.setToDefault();else if(f.isObject(a))for(b in a)c=a[b],!c||!e.isObservable(c)&&"function"==typeof c||"_"===b[0]&&!b.search("__kb")||this.setToDefault(c);return a}}}),b.register("formatted-observable",function(a,b,c){var d,e,f,g,h;try{f=b("knockback")}catch(i){e=i,f=b("./kb")}h=b("underscore"),g=b("knockout"),d=Array.prototype.slice,f.toFormattedString=function(a){var b,c,e,f,i,j;i=a.slice(),c=d.call(arguments,1);for(e in c)for(b=c[e],j=g.utils.unwrapObservable(b),(h.isUndefined(j)||h.isNull(j))&&(j=""),f=a.indexOf("{"+e+"}");f>=0;)i=i.replace("{"+e+"}",j),f=a.indexOf("{"+e+"}",f+1);return i},f.parseFormattedString=function(a,b){var c,d,e,f,g,i,j,k,l,m,n,o,p;for(m=b.slice(),e=0,i=0,k={};m.search("\\{"+e+"\\}")>=0;){for(j=b.indexOf("{"+e+"}");j>=0;)m=m.replace("{"+e+"}","(.*)"),k[j]=e,i++,j=b.indexOf("{"+e+"}",j+1);e++}if(c=e,l=new RegExp(m),g=l.exec(a),g&&g.shift(),!g||g.length!==i){for(n=[];c-- >0;)n.push("");return n}p=h.sortBy(h.keys(k),function(a){return parseInt(a,10)}),d={};for(f in p)j=p[f],e=k[j],d.hasOwnProperty(e)||(d[e]=f);for(o=[],e=0;c>e;)o.push(g[d[e]]),e++;return o},c.exports=f.FormattedObservable=function(){function a(a,b){var c,e;return h.isArray(b)?(a=a,e=b):e=d.call(arguments,1),c=f.utils.wrappedObservable(this,g.dependentObservable({read:function(){var c,d,h;for(b=[g.utils.unwrapObservable(a)],d=0,h=e.length;h>d;d++)c=e[d],b.push(g.utils.unwrapObservable(c));return f.toFormattedString.apply(null,b)},write:function(b){var c,d,h;for(d=f.parseFormattedString(b,g.utils.unwrapObservable(a)),h=Math.min(e.length,d.length),c=0;h>c;)e[c](d[c]),c++}}))}return a.prototype.destroy=function(){return f.utils.wrappedDestroy(this)},a}(),f.formattedObservable=function(a){return new f.FormattedObservable(a,d.call(arguments,1))}}),b.register("localized-observable",function(a,b,c){var d,e,f,g;try{e=b("knockback")}catch(h){d=h,e=b("./kb")}g=b("underscore"),f=b("knockout"),e.locale_manager||(e.locale_manager=void 0),c.exports=e.LocalizedObservable=function(){function a(a,b,c){var d;return this.value=a,this.vm=c,b||(b={}),this.vm||(this.vm={}),this.read||e._throwMissing(this,"read"),e.locale_manager||e._throwMissing(this,"kb.locale_manager"),this.__kb||(this.__kb={}),this.__kb._onLocaleChange=g.bind(this._onLocaleChange,this),this.__kb._onChange=b.onChange,this.value&&(a=f.utils.unwrapObservable(this.value)),this.vo=f.observable(a?this.read(a,null):null),d=e.utils.wrappedObservable(this,f.dependentObservable({read:function(a){return function(){return a.value&&f.utils.unwrapObservable(a.value),a.vo(),a.read(f.utils.unwrapObservable(a.value))}}(this),write:function(a){return function(b){return a.write||e._throwUnexpected(a,"writing to read-only"),a.write(b,f.utils.unwrapObservable(a.value)),a.vo(b),a.__kb._onChange?a.__kb._onChange(b):void 0}}(this),owner:this.vm})),e.publishMethods(d,this,["destroy","observedValue","resetToCurrent"]),e.locale_manager.bind("change",this.__kb._onLocaleChange),b.hasOwnProperty("default")&&(d=e.DefaultObservable&&f.defaultObservable(d,b["default"])),d}return a.extend=e.extend,a.prototype.destroy=function(){return e.locale_manager.unbind("change",this.__kb._onLocaleChange),this.vm=null,e.utils.wrappedDestroy(this)},a.prototype.resetToCurrent=function(){var a,b;return b=e.utils.wrappedObservable(this),a=this.value?this.read(f.utils.unwrapObservable(this.value)):null,b()!==a?b(a):void 0},a.prototype.observedValue=function(a){return 0===arguments.length?this.value:(this.value=a,void this._onLocaleChange())},a.prototype._onLocaleChange=function(){var a;return a=this.read(f.utils.unwrapObservable(this.value)),this.vo(a),this.__kb._onChange?this.__kb._onChange(a):void 0},a}(),e.localizedObservable=function(a,b,c){return new e.LocalizedObservable(a,b,c)}}),b.register("triggered-observable",function(a,b,c){var d,e,f,g;try{e=b("knockback")}catch(h){d=h,e=b("./kb")}g=b("underscore"),f=b("knockout"),c.exports=e.TriggeredObservable=function(){function a(a,b){var c;return this.event_selector=b,a||e._throwMissing(this,"emitter"),this.event_selector||e._throwMissing(this,"event_selector"),this.vo=f.observable(),c=e.utils.wrappedObservable(this,f.dependentObservable(function(a){return function(){return a.vo()}}(this))),e.publishMethods(c,this,["destroy"]),e.utils.wrappedEventWatcher(this,new e.EventWatcher(a,this,{emitter:g.bind(this.emitter,this),update:g.bind(this.update,this),event_selector:this.event_selector})),c}return a.prototype.destroy=function(){return e.utils.wrappedDestroy(this)},a.prototype.emitter=function(a){return 0===arguments.length||this.ee===a?this.ee:(this.ee=a)?this.update():void 0},a.prototype.update=function(){return this.ee?this.vo()!==this.ee?this.vo(this.ee):this.vo.valueHasMutated():void 0},a}(),e.triggeredObservable=function(a,b){return new e.TriggeredObservable(a,b)}}),b.register("validation",function(a,b,c){var d,e,f,g,h;try{f=b("knockback")}catch(i){e=i,f=b("./kb")}h=b("underscore"),g=b("knockout"),b("./validators"),d=function(a){return a=g.utils.unwrapObservable(a),"function"==typeof a?a.apply(null,Array.prototype.slice.call(arguments,1)):a},c.exports=f.Validation=function(){function a(){}return a}(),f.valueValidator=function(a,b,c){return null==c&&(c={}),c&&!("function"==typeof c)||(c={}),g.dependentObservable(function(){var e,f,i,j,k,l,m,n;m={$error_count:0},f=g.utils.unwrapObservable(a),!("disable"in c)||(i=d(c.disable)),!("enable"in c)||(i=!d(c.enable)),l=c.priorities||[],h.isArray(l)||(l=[l]),e=l.length+1;for(j in b)n=b[j],m[j]=!i&&d(n,f),m[j]&&(m.$error_count++,(k=h.indexOf(l,j)>=0)||(k=l.length),m.$active_error&&e>k?(m.$active_error=j,e=k):m.$active_error||(m.$active_error=j,e=k));return m.$enabled=!i,m.$disable=!!i,m.$valid=0===m.$error_count,m})},f.inputValidator=function(a,b,c){var d,e,g,i,j,k,l,m,n,o;if(null==c&&(c={}),c&&!("function"==typeof c)||(c={}),n=f.valid,d=$(b),(i=d.attr("name"))&&!h.isString(i)&&(i=null),!(e=d.attr("data-bind")))return null;if(j=new Function("sc","with(sc[0]) { return { "+e+" } }")([a]),!j||!j.value)return null;if(!j.validation_options||(h.defaults(j.validation_options,c),c=j.validation_options),e={},!n[l=d.attr("type")]||(e[l]=n[l]),!d.attr("required")||(e.required=n.required),j.validations){o=j.validations;for(g in o)m=o[g],e[g]=m}return k=f.valueValidator(j.value,e,c),!i&&!c.no_attach||(a["$"+i]=k),k},f.formValidator=function(a,b){var c,d,e,i,j,k,l,m,n,o,p,q,r;for(l={},o=[],c=$(b),(e=c.attr("name"))&&!h.isString(e)&&(e=null),(d=c.attr("data-bind"))&&(k=new Function("sc","with(sc[0]) { return { "+d+" } }")([a]),m=k.validation_options),m||(m={}),m.no_attach=!!e,r=c.find("input"),p=0,q=r.length;q>p;p++)i=r[p],(j=$(i).attr("name"))&&(n=f.inputValidator(a,i,m),!n||o.push(l[j]=n));return l.$error_count=g.dependentObservable(function(){var a,b,c;for(a=0,b=0,c=o.length;c>b;b++)n=o[b],a+=n().$error_count;return a}),l.$valid=g.dependentObservable(function(){return 0===l.$error_count()}),l.$enabled=g.dependentObservable(function(){var a,b,c;for(a=!0,b=0,c=o.length;c>b;b++)n=o[b],a&=n().$enabled;return a}),l.$disabled=g.dependentObservable(function(){return!l.$enabled()}),e&&(a["$"+e]=l),l}}),b.register("validators",function(a,b){var c,d,e,f,g,h,i;try{g=b("knockback")}catch(j){f=j,g=b("./kb")}i=b("underscore"),h=b("knockout"),e=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,c=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/,d=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,g.valid={required:function(a){return!a},url:function(a){return!e.test(a)},email:function(a){return!c.test(a)},number:function(a){return!d.test(a)}},g.hasChangedFn=function(a){var b,c;return c=null,b=null,function(){var d;return c!==(d=h.utils.unwrapObservable(a))?(c=d,b=c?c.toJSON():null,!1):!(!c||!b)&&!i.isEqual(c.toJSON(),b)}},g.minLengthFn=function(a){return function(b){return!b||b.length<a}},g.uniqueValueFn=function(a,b,c){return function(d){var e,f,g;return g=h.utils.unwrapObservable(a),f=h.utils.unwrapObservable(b),e=h.utils.unwrapObservable(c),!!(g&&f&&e)&&!!i.find(e.models,function(){return function(a){return a!==g&&a.get(f)===d}}(this))}},g.untilTrueFn=function(a,b,c){var d;return d=!1,c&&h.isObservable(c)&&c.subscribe(function(){return d=!1}),function(c){var e,f;return(e=h.utils.unwrapObservable(b))?(d|=!!(f=e(h.utils.unwrapObservable(c))),d?f:h.utils.unwrapObservable(a)):h.utils.unwrapObservable(a)}},g.untilFalseFn=function(a,b,c){var d;return d=!1,c&&h.isObservable(c)&&c.subscribe(function(){return d=!1}),function(c){var e,f;return(e=h.utils.unwrapObservable(b))?(d|=!(f=e(h.utils.unwrapObservable(c))),d?f:h.utils.unwrapObservable(a)):h.utils.unwrapObservable(a)}}}),"function"==typeof define&&define.amd?define(["require","underscore","backbone","knockout"],function(){return b("index")}):"object"==typeof exports?module.exports=b("index"):this.kb=b("index")}).call(this);