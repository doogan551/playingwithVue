define(["knockout","text!./view.html"],function(a,b){function c(){function a(a,b,c){return(a-b)/(c-b)}var b=(this.values,this.data.Value),c=this.data["Minimum Value"],d=this.data["Maximum Value"],e=this.data["Disable Limit Fault"],f=this.data["Value Deadband"],g=this.data["Enable Warning Alarms"],h=this.data["Low Warning Limit"],i=this.data["High Warning Limit"],j=this.data["Warning Adjust Band"],k=this.data["Alarms Off"],l=this.data["Low Alarm Limit"],m=this.data["High Alarm Limit"],n=this.data["Alarm Deadband"],o={};return"undefined"==typeof c||"undefined"==typeof d?null:(c=c.Value(),d=d.Value(),e&&!e.Value()&&f&&f.Value()&&(c-=f.Value(),d+=f.Value(),o.valueDeadband=a(f.Value(),c,d)),o.valuePointer=a(b.Value(),c,d),k&&!k.Value()&&(o.highAlarm=a(m.Value(),c,d),o.lowAlarm=a(l.Value(),c,d),n.Value()&&(o.alarmDeadband=a(n.Value(),c,d))),g&&g.Value()&&(o.highWarning=a(i.Value(),c,d),o.lowWarning=a(h.Value(),c,d),j.Value()&&(o.warningDeadband=a(j.Value(),c,d))),o)}function d(b){var c=this;this.root=b.rootContext,this.data=this.root.point.data,this.canvasState=a.observable(!1),this._resizeTimer=null,this.resizeHandler=function(a){clearTimeout(c._resizeTimer),c._resizeTimer=setTimeout(function(){c.sizeCanvas(c,a)},100)},this.isInEditMode=this.root.isInEditMode,this.sizeListener=this.root.currentTab.subscribe(function(a){clearTimeout(c._resizeTimer),c._resizeTimer=setTimeout(function(){c.sizeCanvas()},100)})}return a.bindingHandlers.context={init:function(a,b,c,d){d.$element=$(a),d.__context__=a.getContext("2d"),d.sizeCanvas(),window.addEventListener("resize",d.resizeHandler,!1)},update:function(a,b,c,d){var e=d.createScene;e.call(d,d.__context__)}},d.prototype.sizeCanvas=function(){var a,b=this,c=b.__context__,d=c.canvas,e=$(d),f=e.parent();b.root.currentTab()==b.$element.closest(".content").attr("id")&&(clearTimeout(b.resizeTimer),b.resizeTimer=setTimeout(function(){a=f.width(),e.attr({width:a,height:10}),b.createScene(c),e.show()},100))},d.prototype.createScene=function(a){var b=a.canvas,d=c.call(this),e=d&&Math.round(d.valuePointer*b.width),f=d.highAlarm&&Math.round(d.highAlarm*b.width),g=d.lowAlarm&&Math.round(d.lowAlarm*b.width),h=d.highWarning&&Math.round(d.highWarning*b.width),i=d.lowWarning&&Math.round(d.lowWarning*b.width),j=0,k=b.width;d.valueDeadband&&(j+=d.valueDeadband,k-=d.valueDeadband,a.beginPath(),a.fillStyle="#ECE90C",a.fillRect(0,0,j,b.height),a.beginPath(),a.fillStyle="#ECE90C",a.fillRect(k,0,b.width-k,b.height)),a.beginPath(),a.fillStyle="#5cb85c",a.fillRect(j,0,k,b.height),"number"==typeof f&&(a.beginPath(),a.fillStyle="#d9534f",a.fillRect(f,0,k-f,b.height)),"number"==typeof g&&(a.beginPath(),a.fillStyle="#d9534f",a.fillRect(j,0,g,b.height)),"number"==typeof h&&(a.beginPath(),a.fillStyle="#f0ad4e","number"==typeof f?a.fillRect(h,0,f-h,b.height):a.fillRect(h,0,k-h,b.height)),"number"==typeof i&&(a.beginPath(),a.fillStyle="#f0ad4e","number"==typeof g?a.fillRect(g,0,i-g,b.height):a.fillRect(j,0,i,b.height)),a.beginPath(),a.fillStyle="rgba(0,0,0,1)",a.shadowColor="rgba(0,0,0,.2)",a.shadowBlur=1,a.shadowOffsetY=1,a.fillRect(0,-b.height,b.width,b.height),a.fillStyle="rgba(0,0,0,1)",a.shadowColor="rgba(0,0,0,.2)",a.shadowBlur=1,a.shadowOffsetY=1,a.beginPath(),a.moveTo(e,5),a.lineTo(e+5,0),a.lineTo(e-5,0),a.closePath(),a.fill(),a.globalCompositeOperation="destination-out",a.fillStyle="rgba(0,0,0,1)",a.shadowColor="#000",a.shadowBlur=0,a.shadowOffsetY=15,a.beginPath(),a.moveTo(e,5),a.lineTo(e+5,0),a.lineTo(e-5,0),a.closePath(),a.fill(),a.globalCompositeOperation="source-over"},d.prototype.dispose=function(){var a=this;window.removeEventListener("resize",a.resizeHandler),this.sizeListener.dispose()},{viewModel:d,template:b}});