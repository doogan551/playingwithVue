define(["knockout","text!./view.html"],function(a,b){function c(b){var c,d=this;this.root=b.rootContext,this.columnClasses=b.hasOwnProperty("columnClasses")?b.columnClasses:"col-sm-12 col-md-6",this.showLabel=!b.hasOwnProperty("showLabel")||b.showLabel,this.doValidate=!b.hasOwnProperty("doValidate")||b.doValidate,this.allowRemove=!b.hasOwnProperty("allowRemove")||b.allowRemove,this.getPointTypeName=function(a){return"number"==typeof a?this.utility.config.Utility.pointTypes.getPointTypeNameFromEnum(a):a},e=this.root.apiEndpoint,this.utility=this.root.utility,this.point=b.hasOwnProperty("point")?b.point:this.root.point,this.oldPoint=b.hasOwnProperty("oldPoint")?b.oldPoint:null,this.parentType=b.hasOwnProperty("point")?this.point["Point Type"].Value():this.point.data["Point Type"].Value(),this.refType=b.refType,this.appIndex=b.hasOwnProperty("appIndex")?b.appIndex:0,this.refPoint=null,this.isInEditMode=this.root.isInEditMode,this.getPointRef=function(){var a;return a=b.hasOwnProperty("point")?d.utility.getPointRefProperty(d.refType,this.point):0===d.appIndex?d.utility.getPointRefProperty(d.refType):d.utility.getPointRefPropertyByAppIndex(d.refType,d.appIndex),d.arrayIndex=a.arrayIndex,d.data=a.data,a.data},this.reference=this.getPointRef(),this.refPointType=this.getPointTypeName(parseInt(this.reference.PointType(),10)),this.url=a.observable(void 0),this.target=a.observable(void 0),this.refPointType&&(c=this.utility.config.Utility.pointTypes.getUIEndpoint(this.refPointType,this.data.Value()),this.url(c.review.url),this.target(c.review.target))}function d(a){return $.ajax({url:e+"points/"+a,contentType:"application/json",dataType:"json",type:"get"})}var e,f=a.bindingHandlers.enable,g=/\bbtn\b/;return a.bindingHandlers.enable={update:function(b,c){var d=f.update.apply(this,arguments),e=a.unwrap(c());return g.test(b.className)&&(e?b.className.replace(/\bdisabled\b/gi,""):b.className+=" disabled"),d}},c.prototype.openWindow=function(){var a=this,b={width:1250,height:750,left:("undefined"==typeof window.screenLeft?screen.left:window.screenLeft)+20,top:("undefined"==typeof window.screenTop?screen.top:window.screenTop)+20};b.width+b.left+40>screen.availWidth&&(b.left-=40),b.height+b.top+40>screen.availHeight&&(b.top-=40),console.log(b.width+b.left,b.height+b.top),console.log(screen.availWidth,screen.availHeight),a.utility.workspace.openWindowPositioned(a.url(),a.data.PointName(),a.refPointType,a.target,a.data.Value(),{width:b.width,height:b.height,left:b.left,top:b.top})},c.prototype.editPointRef=function(a,b){var c,e=this,f=e.getPointRef(),g=$(b.target),h=function(){var a,b,c=f.PropertyName(),d="/pointlookup/"+encodeURI(e.parentType)+"/"+encodeURI(f.PropertyName()),g=["Control Point","Occupied Point","Remote Unit Point","Damper Control Point","Digital Heat 1 Control Point","Digital Heat 2 Control Point","Digital Heat 3 Control Point","Fan Control Point","Heat 1 Control Point","Lights Control Point"];return g.indexOf(c)>-1&&(b=e.utility.getPointRefProperty("Remote Unit Point"),a=e.utility.getPointRefProperty("Device Point"),a&&0!==a.data.Value()&&(d+="/"+a.data.Value(),"Remote Unit Point"!==c&&b&&0!==b.data.Value()&&(d+="/"+b.data.Value()))),d},i=[h(),"?mode=select"].join(""),j=function(a,b,h){a&&d(a).done(function(d){c=e.utility.config.Utility.pointTypes.getUIEndpoint(h,a),e.refPoint=d,f.PointName(b),f.Value(a),e.refPointType=h,e.url(c.review.url),e.target(c.review.target),e.doValidate&&$(document).triggerHandler({type:"viewmodelChange",targetElement:g.closest(".table"),property:e.arrayIndex,refPoint:e.refPoint})})},k=e.utility.workspace,l=k.openWindowPositioned(i,"Point Selector","pointSelector","","pointSelector"+e.parentType,{width:1250,height:750,callback:function(){l.pointLookup.init(j)}})},c.prototype.removePointRef=function(){var b=this,c=b.getPointRef(),d=$(event.target);c.PointName(""),c.Value(0),b.url=a.observable(void 0),b.target=a.observable(void 0),b.doValidate&&$(document).triggerHandler({type:"viewmodelChange",targetElement:d.closest(".table"),property:b.arrayIndex,refPoint:b.refPoint})},c.prototype.dispose=function(){},{viewModel:c,template:b}});