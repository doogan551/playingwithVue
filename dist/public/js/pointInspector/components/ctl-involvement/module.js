define(["knockout","text!./view.html"],function(a,b){function c(b){this.id=b.id,h=b.rootContext.apiEndpoint,this.searchTerm=a.observable(""),this.gettingData=a.observable(!0),this.networkError=a.observable(!1),this.pointRefs=[],this.dependencies=[],this.filteredPointRefs=a.observableArray([]),this.filteredDependencies=a.observableArray([]),this.sortProperty="Name",this.sortDirection=i,this.isTabLoaded=b.isTabLoaded.subscribe(function(a){this.render()},this),this.search=a.computed(function(){var b=this.searchTerm().toLowerCase(),c=function(c){return a.utils.arrayFilter(c,function(a){return a.Name.toLowerCase().indexOf(b)!==-1||(a.Property.toLowerCase().indexOf(b)!==-1||(a["Point Type"].toLowerCase().indexOf(b)!==-1||a["Device Name"].toLowerCase().indexOf(b)!==-1))})};this.filteredPointRefs(e.call(c(this.pointRefs),this.sortProperty,this.sortDirection)),this.filteredDependencies(e.call(c(this.dependencies),this.sortProperty,this.sortDirection)),g&&(b.length?g.show():g.hide())},this).extend({rateLimit:200})}function d(a){return $.ajax({url:h+"points/searchdependencies2/"+a,contentType:"application/json",dataType:"json",type:"get"})}function e(a,b){var c=~b+1;return this.sort(function(d,e){return d[a]==e[a]?0:d[a]<e[a]?c:b})}var f,g,h="",i=1;return c.prototype.render=function(){var a,b=this,c=function(){f=$("div.search input"),g=$(".clearSearchIcon"),a=f.css("width"),$("div.search i.fa-search").click(function(a){f.css("width",175),f.focus()}),f.blur(function(b){""===f.val()&&f.css("width",a)}),f.focus(function(a){f.css("width",175)})};this.gettingData(!0),d(this.id).done(function(a){var c=a.Involvement["Point Refs"],d=a.Involvement.Dependencies,e=function(a){a["Device Name"]=a.Device?a.Device.Name:"",a["Point Type"]=a["Point Type"]?a["Point Type"]:"",a.Property=a.extendedProperty?a.extendedProperty:a.Property?a.Property:"",a.Name=a.Name?a.Name:""};c.forEach(e),d.forEach(e),b.pointRefs=c,b.dependencies=d,b.networkError(!1),b.searchTerm.valueHasMutated()}).fail(function(a,c){console.log("Ajax requst failed.",c,a),b.networkError(!0)}).always(function(){b.gettingData(!1)}),c()},c.prototype.openPointReview=function(a,b){var c,d,e,f,g,h=window.opener.workspaceManager,i=$(b.currentTarget),j=i.data("col");j?(g=j,a=a.Device,e=1250,f=750):"Schedule Entry"!==a["Point Type"]&&"Schedule"!==a["Point Type"]?(g=a["Point Type"],e=1250,f=750):(g="Schedule",e=1250,f=750),c=h.config.Utility.pointTypes.getUIEndpoint(g,a._id),d=h.openWindowPositioned(c.review.url,a.Name,g,"",a._id,{width:e,height:f})},c.prototype.sortTable=function(a,b,c){var d=$(c.currentTarget);this.sortProperty==a?this.sortDirection=~this.sortDirection+1:(this.sortProperty=a,this.sortDirection=i),e.call(this.filteredDependencies,a,this.sortDirection),e.call(this.filteredPointRefs,a,this.sortDirection),$("table.involvement thead i.fa").removeClass("fa-chevron-down fa-chevron-up"),d.find(".fa").addClass(this.sortDirection==i?"fa-chevron-up":"fa-chevron-down")},c.prototype.clearSearch=function(){this.searchTerm(""),f.focus()},c.prototype.dispose=function(){this.isTabLoaded.dispose()},{viewModel:c,template:b}});