define(["knockout","text!./view.html","jquery-ui"],function(a,b){function c(b){function c(){for(var b,c,e=a.viewmodel.toModel(d.data),f=e["Point Refs"],g=d.data,h=0;h<f.length;h++)f[h].AppIndex=h+1,c=f[h].Value,b=d.getSlideById(c),b&&b.order(h);a.viewmodel.updateFromModel(g,e)}var d=this,f=$(".items");this.root=b,this.point=b.point,this.data=b.point.data,this.utility=b.utility,this.apiEndpoint=e=b.apiEndpoint,this.isInEditMode=b.isInEditMode,f.sortable({start:function(a,b){},stop:function(a,b){},update:function(b,e){var f=e.item,g=d.data["Point Refs"],h=a.dataFor(f[0]),i=a.utils.arrayIndexOf(f.parent().children(),f[0]);i>=0&&(g.remove(h),g.splice(i,0,h)),c()},helper:function(a,b){return b.children().each(function(){$(this).width($(this).width())}),b},axis:"y",handle:".grabHandle",containment:".table-responsive"}),this.tabTriggers={involvement:a.observable(!1),notifications:a.observable(!1),permissions:a.observable(!1)},b.tabTriggers=this.tabTriggers,b.initDOM()}function d(a){return $.ajax({url:e+"points/"+a,contentType:"application/json",dataType:"json",type:"get"})}var e;return a.bindingHandlers.dataSrc={update:function(a,b){var c=b()(),d=$(a),e=d.parent();e.find(".thumbIcon");$.ajax({url:"/img/thumbs/"+c+".txt",dataType:"text",type:"get"}).done(function(a){var b=a.split("||"),c=b[0],f=b[1];d.attr("src",f),"undefined"!=c&&e.css("background-color",c)}).fail(function(){d.addClass("noPreview")})}},c.prototype.removeSlide=function(a,b){var c=b.data["Point Refs"](),d=(b.data.Slides(),c[a]),e=c[a].Value(),f=b.getSlideById(e);b.data.Slides.remove(f),b.data["Point Refs"].remove(d)},c.prototype.openDisplay=function(b,c){var d=a.contextFor(c.target).$root.utility.workspace,e=b.Value(),f=d.config.Utility.pointTypes.getUIEndpoint("Display",e);d.openWindowPositioned(f.review.url,b.PointName(),"Display","",e,{width:1e3,height:800})},c.prototype.showPreview=function(a,b){var c=$(b.currentTarget).find(".displayPreview"),d=c.find("img");d.is(".noPreview")||c.show()},c.prototype.hidePreview=function(a,b){var c=$(".displayPreview");c.hide()},c.prototype.getSlideById=function(a){for(var b=this,c=b.data.Slides(),d=0;d<c.length;d++)if(c[d].display()==a)return c[d];return null},c.prototype.addPointRef=function(b,c){var e=["/pointlookup/","Slide Show","/Slide Display","?mode=select"].join(""),f=function(c,e,f){c&&d(c).done(function(c){var d=b.data["Point Refs"](),e=b.data.Slides(),f=d.length;b.data["Point Refs"].push({AppIndex:a.observable(f+1),DevInst:a.observable(0),PointInst:a.observable(c._id),PointName:a.observable(c.Name),PointType:a.observable(151),PropertyEnum:a.observable(278),PropertyName:a.observable("Slide Display"),Value:a.observable(c._id),isDisplayable:a.observable(!0),isReadOnly:a.observable(!1)}),e.push({order:a.observable(f+1),display:a.observable(c._id),duration:a.observable(10)}),b.data["Point Refs"].valueHasMutated(),b.data.Slides.valueHasMutated()})},g=b.utility.workspace,h=g.openWindowPositioned(e,"Point Selector","pointSelector","","pointSelector"+b.data._id(),{width:980,height:550,callback:function(){h.pointLookup.init(f)}})},c.prototype.dispose=function(){},{viewModel:c,template:b}});