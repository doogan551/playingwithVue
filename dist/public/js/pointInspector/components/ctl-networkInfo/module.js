define(["knockout","bootstrap-3.3.4","text!./view.html"],function(a,b,c){function d(b){function c(){var b=function(b){this.Value=a.observable(0),this.upi=a.observable(b.val()),this.Address=a.observable(""),this.PointType=a.observable(""),this.set=function(){var a=this;m.getPointRef(b.val(),function(c,d){d.Name?(a.Value(d.Name),a.Address(m.config.Utility.pointTypes.getUIEndpoint(d["Point Type"].Value,d._id).review.url),a.PointType(d["Point Type"].Value)):a.Value(b.val().toString())})}};this.sortOrder=a.observable(),this.sortProperty=a.observable(),this.entries=a.observableArray([]),this["Point Type"]=function(){this.val=a.observable(-1),this.Value=function(){var a=this.val();for(var b in m.config.Enums["Point Types"]){var c=m.config.Enums["Point Types"][b];if(c["enum"]===a){a=b;break}}return a}},this["Point Instance"]=function(){this.val=a.observable(0),this.Value=function(){this.val();return this.pointRef.set(),this.pointRef.Value()},this.pointRef=new b(this),this.style=a.computed(function(){return""!==this.pointRef.PointType()?"instanceLink":""},this)},this["Network Number"]=function(){this.val=a.observable(-1),this.Value=function(){var a=this.val();return a}},this["Vendor ID"]=function(){this.val=a.observable(-1),this.Value=function(){var a=this.val();return a}},this["Max APDU Length"]=function(){this.val=a.observable(-1),this.Value=function(){var a=this.val();return a}},this["Change Count"]=function(){this.val=a.observable(-1),this.Value=function(){var a=this.val();return a}},this["Read Property Only"]=function(){this.val=a.observable(-1),this.Value=function(){var a=this.val();return a?"Yes":"No"}},this["No Priority Array"]=function(){this.val=a.observable(-1),this.Value=function(){var a=this.val();return a?"Yes":"No"}},this["MAC Address"]=function(){this.val=a.observable(-1),this.Value=function(){var a=this.val();return a}},this["Device Instance"]=function(){this.val=a.observable(0),this.Value=function(){this.val();return this.pointRef.set(),this.pointRef.Value()},this.pointRef=new b(this),this.style=a.computed(function(){return""!==this.pointRef.PointType()?"instanceLink":""},this)},this["Poll Period"]=function(){this.val=a.observable(-1),this.Value=function(){var a=this.val();return a}},this["Port Number"]=function(){this.val=a.observable(-1),this.Value=function(){var a=this.val();switch(a){case 0:case 1:case 2:case 3:a="Serial Port "+(a+1);break;case 4:a="Ethernet Port";break;case 5:a="Downlink Ethernet";break;default:a="Invalid"}return a}},this.buildArray=function(a){for(var b=[],c=0;c<a.length;c++){var d={};for(var e in a[c])d[e]=new this[e],d[e].val(a[c][e]);b.push(d)}this.entries(b)}}function d(){c.call(this)}function h(){c.call(this)}function i(){c.call(this)}var j,k,l,m=this,n=function(){$modal=$(".modal.networkInfo"),j=$(".modalScene.modalWait"),k=$(".modalScene.modalError"),l=$(".modalScene.modalValue"),$modal.on("shown.bs.modal",m.sizeModal),m.currentTab=$(".devicesTable"),$(".devicesTable").hide(),$(".pointsTable").hide(),$(".routerTable").hide(),m.isInitialized(!0)};m.root=b.rootContext,m.apiEndpoint=m.root.apiEndpoint,m.point=m.root.point,m.utility=m.root.utility,m.config=m.utility.config,m.data=m.point.data,m.gettingData=!1,m.readOnOpen=!0,m.showModal=a.observable(!1),m.errorText=a.observable(""),m.isInitialized=a.observable(!1),m.deviceProperties=a.observableArray(["Point Type","Point Instance","Network Number","Vendor ID","Max APDU Length","Change Count","Read Property Only","No Priority Array","MAC Address"]),m.pointProperties=a.observableArray(["Point Type","Point Instance","Device Instance","Poll Period"]),m.routerProperties=a.observableArray(["Network Number","Port Number","Change Count","MAC Address"]),m.getData=function(){m.currentTab.hide(),j.show(),m.isInitialized()&&m.point.issueCommand("Network Info",{upi:m.data._id()},function(a){j.hide(),k.hide(),l.hide(),a.error()?(k.show(),m.errorText(a.error())):(m.NetworkDevices.buildArray(a.value()["Network Devices"]||[]),m.NetworkPoints.buildArray(a.value()["Network Points"]||[]),m.RouterTable.buildArray(a.value()["Router Table"]||[]),m.currentTab.show(),l.show())})},m.getPointRef=function(a,b){$.ajax({url:"/api/points/getpointref/instance/"+a+"/"+m.data._id(),contentType:"application/json",dataType:"json",type:"get"}).done(function(a){a.err?b(a.err):b(null,a)})},m.openPointRef=function(a){var b=this[a].pointRef.Address();if(""!==b){var c=window.opener.workspaceManager;c.openWindowPositioned(b,this[a].pointRef.Value(),this[a].pointRef.PointType(),"",this[a].pointRef.upi(),{width:1250,height:750})}},m.compare=function(a,b){var c=this.sortProperty();return a[c].Value()<b[c].Value()?-1*this.sortOrder():a[c].Value()>b[c].Value()?1*this.sortOrder():0},g(c,d),g(c,h),g(c,i),m.NetworkDevices=new d,m.NetworkPoints=new h,m.RouterTable=new i,m.sortDevices=function(a,b){var c=this,d=$(b.target),g=d.text();g||(d=$(b.target.parentElement),g=d.text()),c.NetworkDevices.sortProperty(g),$(".deviceheaders th").find("i").removeClass("fa-chevron-up"),$(".deviceheaders th").find("i").removeClass("fa-chevron-down"),c.NetworkDevices.sortOrder()!==e?(c.NetworkDevices.sortOrder(e),d.find("i").addClass("fa-chevron-up")):(c.NetworkDevices.sortOrder(f),d.find("i").addClass("fa-chevron-down")),c.NetworkDevices.entries(c.NetworkDevices.entries().sort(c.compare.bind(c.NetworkDevices)))},m.sortPoints=function(a,b){var c=this,d=$(b.target),g=d.text();g||(d=$(b.target.parentElement),g=d.text()),c.NetworkPoints.sortProperty(g),$(".pointheaders th").find("i").removeClass("fa-chevron-up"),$(".pointheaders th").find("i").removeClass("fa-chevron-down"),c.NetworkPoints.sortOrder()!==e?(c.NetworkPoints.sortOrder(e),d.find("i").addClass("fa-chevron-up")):(c.NetworkPoints.sortOrder(f),d.find("i").addClass("fa-chevron-down")),c.NetworkPoints.entries(c.NetworkPoints.entries().sort(c.compare.bind(c.NetworkPoints)))},m.sortRouter=function(a,b){var c=this,d=$(b.target),g=d.text();g||(d=$(b.target.parentElement),g=d.text()),c.RouterTable.sortProperty(g),$(".routerheaders th").find("i").removeClass("fa-chevron-up"),$(".routerheaders th").find("i").removeClass("fa-chevron-down"),c.RouterTable.sortOrder()!==e?(c.RouterTable.sortOrder(e),d.find("i").addClass("fa-chevron-up")):(c.RouterTable.sortOrder(f),d.find("i").addClass("fa-chevron-down")),c.RouterTable.entries(c.RouterTable.entries().sort(c.compare.bind(c.RouterTable)))},n()}var e=-1,f=1,g=function(a,b){b.prototype=Object.create(a.prototype),b.prototype.constructor=b};return d.prototype.switchTab=function(a,b){var c=this,d=$(b.target).text(),e=$(".devicesTable"),f=$(".pointsTable"),g=$(".routerTable");switch(c.currentTab.hide(),$(b.target).siblings().removeClass("btnClicked"),d){case"Network Devices":c.currentTab=e;break;case"Network Points":c.currentTab=f;break;case"Router Table":c.currentTab=g}c.currentTab.show(),$(b.target).addClass("btnClicked")},d.prototype.toggleNetworkInfo=function(){this.showModal(!0),this.getData()},d.prototype.printInfo=function(){var a=$(".modal.networkInfo");a.find(".modalValue");$devicesTable=a.find(".devicesTable"),$pointsTable=a.find(".pointsTable"),$routerTable=a.find(".routerTable");var b=window.open(),c="<label>"+this.point.data.Name()+"</label>";c+="<p>"+$devicesTable.html()+"</p>",c+="<p>"+$pointsTable.html()+"</p>",c+="<p>"+$routerTable.html()+"</p>",$(b.document.body).html(c),b.print(),b.close()},d.prototype.dispose=function(){this.trendDataSorted.dispose()},{viewModel:d,template:c}});