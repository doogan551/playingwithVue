"use strict";function applyBindings(a){void 0===window.opener?window.setTimeout(applyBindings,2):(reportsVM=new reportsViewModel,reportsVM.init(a),ko.applyBindings(reportsVM))}window.workspaceManager=(window.opener||window.top).workspaceManager;var reportsVM,reportDateRanges=function(a){var b,c={Today:[moment(),moment().add(1,"day")],Yesterday:[moment().subtract(1,"days"),moment()],"Last 7 Days":[moment().subtract(6,"days"),moment().add(1,"day")],"Last Week":[moment().subtract(1,"weeks").startOf("week"),moment().subtract(1,"weeks").endOf("week").add(1,"day")],"Last 4 Weeks":[moment().subtract(4,"weeks"),moment().add(1,"day")],"This Month":[moment().startOf("month"),moment().endOf("month").add(1,"day")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month").add(1,"day")],"This Year":[moment().startOf("year"),moment().add(1,"day")],"Last Year":[moment().subtract(1,"year").startOf("year"),moment().subtract(1,"year").endOf("year").add(1,"day")]};return b=a&&c.hasOwnProperty(a)?c[a]:c},initKnockout=function(){var a,b,c,d,e=function(a,b,c){var d=a.keyCode,e=a.shiftKey;return 16!==d&&17!==d&&(8===d||13===d||35===d||36===d||37===d||38===d||39===d||40===d||46===d||186===d&&e&&b.indexOf(":")===-1||(d>=48&&d<=57||d>=96&&d<=105)&&!e&&b.length-c<=4)},f=function(a,b){var c,d,e,f=b.length,g=!1;if(f>2){if(b.indexOf(":")>0?c=b.split(":"):(c=[],5===f?(c[0]=b.substr(0,2),c[1]=b.substr(3,2)):(c[0]=b.substr(0,4===f?2:1),c[1]=b.substr(f-2,2))),d=Number.isNaN(parseInt(c[0],10))?0:parseInt(c[0],10),e=Number.isNaN(parseInt(c[1],10))?0:parseInt(c[1],10),d>23&&(d=23),e>59&&(e=59),a>0&&e<59||a<0&&e>0?e+=a:a<0&&0===e?((0===d||d>24)&&(d=24),e=59,g=!0):a>0&&e>=59&&(d>=23&&(d=0),e=0,g=!0),g)switch(!0){case a>0&&d<23:case a<0&&d>0:d+=a}return(d<10?"0":"")+d+":"+((e<10?"0":"")+e)}return b};ko.bindingHandlers.reportDateRangePicker={init:function(a,b){var c=$(a),d="MM/DD/YYYY",e=b(),f=function(a,b){var c={};c.startDate=b.startDate,c.endDate=b.endDate,c.duration=b.endDate.diff(b.startDate),c.selectedRange=b.chosenLabel,ko.isObservable(e)?e(c):e=c,a.val(c.startDate.format(d)+" - "+c.endDate.format(d)),a.attr("title",c.selectedRange)};c.attr("title",""!==e().selectedRange?e().selectedRange:"Start & End Dates"),c.val(e().startDate.format(d)+" - "+e().endDate.format(d)),c.daterangepicker({startDate:e().startDate,endDate:e().endDate,chosenLabel:e().selectedRange,alwaysShowCalendars:!0,autoApply:!1,autoUpdateInput:!1,timePicker:!1,ranges:reportDateRanges()}),c.on("apply.daterangepicker",function(a,b){f($(this),b)}),c.on("hide.daterangepicker",function(a,b){f($(this),b)})}},ko.bindingHandlers.reportDatePicker={init:function(e,f,g,h){var i=$(e),j={autoclose:!0,clearBtn:!0};i.datepicker(j).on("changeDate",function(a){var b,c=$.isFunction(f())?f():parseInt(f(),10);a.date?h.date=moment(a.date).unix():""!==c&&(h.date=c),i.datepicker("setEndDate",moment().format("MM/DD/YYYY")),i.hasClass("startDate")?(b=i.closest("tr").next().find(".endDate"),b.datepicker("setStartDate",moment.unix(h.date).format("MM/DD/YYYY"))):i.hasClass("endDate")&&(b=i.closest("tr").prev().find(".startDate"),b.datepicker("setEndDate",moment.unix(h.date).format("MM/DD/YYYY")))}),i.change(function(){moment(new Date($(e).val())).isValid()?(i.parent().removeClass("has-error"),i.parent().attr("title","")):(i.parent().addClass("has-error"),i.parent().attr("title","Error in date format"))}),"Start_Date"===h.filterName?(a=$(e),b=moment.unix(f()).format("MM/DD/YYYY")):"End_Date"===h.filterName&&(c=$(e),d=moment.unix(f()).format("MM/DD/YYYY")),c&&a&&(c.datepicker("setStartDate",b),a.datepicker("setEndDate",d))},update:function(a,b){var c=ko.utils.unwrapObservable(b());$(a).datepicker("setDate",moment.unix(c).format("MM/DD/YYYY"))}},ko.bindingHandlers.reportTimePicker={init:function(a,b){var c=$(a),d=b(),g={doneText:"Done",autoclose:!0};c.clockpicker(g),c.change(function(){ko.isObservable(d)?d($(a).val()):d=$(a).val()}),c.keyup(function(){c.val().match(/^\s*([01]?\d|2[0-3]):?([0-5]\d)\s*$/)?(c.parent().removeClass("has-error"),c.parent().attr("title",""),c.clockpicker("hide"),c.clockpicker("resetClock"),c.clockpicker("show")):(c.parent().addClass("has-error"),c.parent().attr("title","Error in time format")),ko.isObservable(d)?d($(a).val()):d=$(a).val()}),c.keydown(function(b){var d=c.val(),g=a.selectionEnd-a.selectionStart;e(b,d,g)?(38===b.keyCode?c.val(f(1,d)):40===b.keyCode?c.val(f(-1,d)):13===b.keyCode&&c.val(f(0,d)),c.clockpicker("hide"),c.clockpicker("resetClock"),c.clockpicker("show")):b.preventDefault()})},update:function(a,b){var c,d,e=$(a),f=ko.utils.unwrapObservable(b());"string"!=typeof f?(c=("00"+Math.floor(f/100)).slice(-2),d=("00"+f%100).slice(-2),e.val(c+":"+d)):e.val(f)}},ko.bindingHandlers.reportPrecisionInput={init:function(a,b,c,d){var e=$(a),f=b(),g=void 0===e.attr("max")?10:e.attr("max"),h=void 0===e.attr("min")?0:e.attr("min"),i=e.attr("viewModelField"),j=function(a,b){var c=parseInt(b+a,10);return c<=g&&c>=h?c:parseInt(b,10)},k=function(a,b){var c=a.which?a.which:a.keyCode,d=a.shiftKey,e=b.toString();return 16!==c&&17!==c&&((c>=48&&c<=57||c>=96&&c<=105)&&!d?(e=parseInt(e+String.fromCharCode(96<=c&&c<=105?c-48:c),10),e<=g&&e>=h):8===c||13===c||35===c||36===c||37===c||38===c||39===c||40===c||46===c||(c>=48&&c<=57||c>=96&&c<=150)&&!d)};e.attr("title","'"+h+"' to '"+g+"'"),e.keyup(function(){ko.isObservable(f)?(f(parseInt($(a).val(),10)),f(isNaN(f())?0:f()),i&&(d[i]=f())):(f=parseInt($(a).val(),10),f=isNaN(f)?0:f,i&&(d[i]=f))}),e.keydown(function(a){var b=parseInt(e.val(),10),c=a.which?a.which:a.keyCode;return(isNaN(b)||""===b)&&(b=0),k(a,b)?(38===c?e.val(j(1,b)):40===c?e.val(j(-1,b)):13===c&&e.val(b),!0):(a.preventDefault(),!1)})},update:function(a,b){var c=$(a),d=ko.utils.unwrapObservable(b());c.val(d)}}},reportsViewModel=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=this,L=100,M=!0,N="/api/points/getpoint",O={},P={name1:"",name2:"",name3:"",name4:"",selectedPointTypes:[]},Q={name1:"",name2:"",name3:"",name4:"",selectedPointTypes:[]},R={READ:1,CONTROL:2,ACKNOWLEDGE:4,WRITE:8},S=[],T=[],U=[],V=400,W=null,X="0000000000000000000000000000000000000000",Y=function(a,b){var c,d,e=fa(),f=function(a){U.push(a)},g=function(a){var b;return b=U.filter(function(b){return b._id===a}),b[0]};if(c=g(a)){var h=c["Point Type"].Value;d={},d.PropertyEnum=window.workspaceManager.config.Enums.Properties["Column Point"]["enum"],d.PropertyName=b,d.Value=c._id,d.AppIndex=++e,d.isDisplayable=!0,d.isReadOnly=!1,d.PointName=c.Name,d.PointType=window.workspaceManager.config.Enums["Point Types"][h]["enum"],point["Point Refs"].push(d)}else a&&ua({pointid:a},N,f),console.log("setNewPointReference() refPointUPI = "+a+" property = "+b+"  refPoint = "+c)},Z=function(a,b){var c=0,d=window.workspaceManager.user(),e=d.groups.filter(function(b){return!!~a.Security.indexOf(b._id)}),f=d["System Admin"].Value;if(f)return!0;for(var g=0,h=e.length;g<h;g++)c|=e[g]._pAccess;return!!(c&b)},aa=function(){var a,b,c=function(a){var b,c,d=!1;return"Column Point"===a.PropertyName?(b=K.listOfColumns().filter(function(b){return a.AppIndex===b.AppIndex}),d=b.length>0):"Qualifier Point"===a.PropertyName&&(c=K.listOfFilters().filter(function(b){return a.AppIndex===b.AppIndex}),d=c.length>0),d};for(a=0;a<point["Point Refs"].length;a++)b=point["Point Refs"][a],b&&("Column Point"!==b.PropertyName&&"Qualifier Point"!==b.PropertyName||c(b)||point["Point Refs"].splice(a--,1))},ba=function(a){var b,c=-1;for(b=0;b<point["Point Refs"].length;b++)if(point["Point Refs"][b].AppIndex===a){c=b;break}return c},ca=function(a,b,c){var d,e=a.upi,f=a.AppIndex;return f||e?(d=point["Point Refs"].filter(function(a){return(a.AppIndex===f||a.Value===e)&&a.PropertyName===b}),0===d.length?c?null:e?(Y(e,b),ca(a,b,!0)):null:d[0]):null},da=function(a,b){var c,d=!1;return a.AppIndex>=0&&(c=ca(a,b),c&&0===c.PointInst&&(d=!0)),d},ea=function(a,b){var c=ca(a,b);return!c||0===c.PointInst&&0===c.Value},fa=function(){var a,b=0;for(a=0;a<point["Point Refs"].length;a++)b<point["Point Refs"][a].AppIndex&&(b=point["Point Refs"][a].AppIndex);return b},ga=function(a,b,c){var d,e='<div class="bitstringReporting">';for(var f in a.bitstringEnums)a.bitstringEnums.hasOwnProperty(f)&&"All"!==f&&(d=b&a.bitstringEnums[f]["enum"],e+='<input type="checkbox" '+(d>0?"checked ":"")+(c?"disabled":"")+"><span>"+f+"</span><br>");return e+="</div>"},ha=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&"All"!==c&&b.push({name:c,checked:!1});return b},ia=function(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b},ja=function(a,b){var c,d,e=parseInt(b,10),f=Math.abs(parseFloat(a,10)),g=f.toString(),h=g.split(".")[1],i=a<0;return 0===e?g=f.toFixed(0):h&&h.length>e?(g=g.substr(0,parseInt(g.indexOf("."),10)+parseInt(e,10)+2),c=g.charAt(g.length-1),g=g.substr(0,g.length-1),c>=5&&(d=Math.pow(10,g.length-g.indexOf(".")-1),g=(+g+1/d).toFixed(e))):g=g.split(".")[0]+"."+String((h?h:"")+X).slice(0,e),(i?"-":"")+g},ka=function(a,b){var c=ja(a,void 0===b?128:b);return la(c)},la=function(a){if(null!==a&&void 0!==a){if(a.toString().indexOf(".")>0){var b=a.toString().split(".");return b[0].replace(/\B(?=(\d{3})+(?!\d))/g,",")+"."+b[1]}return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}return""},ma=function(a){var b,c=!1;if("Totalizer"===K.reportType)c=!0;else{switch(a.valueType){case"Unsigned":case"Float":case"Integer":c=!0}switch(a.pointType){case"Accumulator":case"Analog Input":case"Analog Output":case"Analog Value":case"Average":case"Binary Input":case"Binary Output":case"Binary Value":case"Math":case"Totalizer":b=window.workspaceManager.config.Templates.getTemplate(a.pointType).Value.ValueOptions,c=void 0===b}}return c},na=function(a){var b,c=!1;if(ma(a))c=!0;else switch(a.pointType){case"Accumulator":case"Analog Input":case"Analog Output":case"Analog Value":case"Average":case"Binary Input":case"Binary Output":case"Binary Selector":case"Binary Value":case"Math":case"Totalizer":b=window.workspaceManager.config.Templates.getTemplate(a.pointType).Value.ValueOptions,c=void 0!==b}return c},oa=function(a,b){b===!0?a.hide():a.show(),a.attr("disabled",b)},pa=function(){for(var a=0;a<K.listOfColumns().length;a++)if(K.listOfColumns()[a].canCalculate&&K.listOfColumns()[a].canCalculate){l.find(".multiplierColumn").html("Multiplier"),l.find(".calculateColumn").html("Calculate"),l.find(".precisionColumn").html("Precision");break}"Totalizer"===K.reportType&&l.find(".typeColumn").html("Type")},qa=function(){for(var a=!1,b=!1,c=!0,d=0;d<K.listOfColumns().length;d++)na(K.listOfColumns()[d])&&(a=!0,!b&&K.listOfColumns()[d].includeInChart&&(b=!0),d>0&&!K.listOfColumns()[d].includeInChart&&(c=!1));a&&(l.find("th .includeInChartColumn").html("Chart"),l.find("th .yaxisChartGroupColumn").html("Group")),K.chartable(b),K.allChartCheckboxChecked(c)},ra=function(a){K.listOfFilters([]),"Property"===K.reportType?K.listOfFilters(ta(a)):K.listOfFilters(a),K.designChanged(!0),K.unSavedDesignChange(!0),K.refreshData(!0)},sa=function(a){K.listOfColumns([]),K.listOfColumns(a),pa(),qa(),K.designChanged(!0),K.unSavedDesignChange(!0),K.refreshData(!0)},ta=function(a){var b,c=a,d=!1,e=function(a){var b=!1,d=a+1<c.length?c[a+1]:void 0;return(d&&"$or"===d.condition||a===c.length-1)&&(b=!0),b};for(b=0;b<c.length;b++)c[b].beginGroup=0===b,c[b].childLogic=!1,0===b?c[b].condition="$and":"$or"===c[b].condition?(d=!0,c[b].beginGroup=!0):d&&(c[b].childLogic=!0),c[b].endGroup=e(b);return c},ua=function(a,b,c){$.ajax({url:b,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(a)}).done(function(a){c&&c.call(K,a)}).fail(function(a,b,c){}).always(function(){})},va=function(a){var b=c.find(".screenMessages").find(".errorMessage");b.text(a),setTimeout(function(){b.text("")},6e3)},wa=function(a,b,c){var d,e,f=c||"/pointlookup/"+encodeURI("Report")+"/"+encodeURI("Column Point")+"?mode=select",g=a,h=$.extend(!0,[],K.listOfColumns()),i=h[a],j=function(a){U.push(a),i.upi=a._id,i.dataColumnName=i.upi,i.valueType="None",i.colName=a.Name,i.colDisplayName=a.Name.replace(/_/g," "),i.pointType=a["Point Type"].Value,i.canCalculate=ma(i),a["Engineering Units"]&&(i.units=a["Engineering Units"].Value),i.canCalculate&&(i.precision=3,i.includeInChart=!1),i.calculation="",delete i.valueOptions,"Totalizer"===K.reportType?(i.valueList=Pa(i.pointType),i.operator=i.valueList[0].text,i.dataColumnName+=" - "+i.operator.toLowerCase()):a.Value.ValueOptions?i.valueOptions=a.Value.ValueOptions:i.valueOptions=window.workspaceManager.config.Templates.getTemplate(i.pointType).Value.ValueOptions,i.canBeCharted=na(i),i.yaxisGroup="A",Ea(i),i.AppIndex&&(e=window.workspaceManager.config.Update.formatPoint({point:point,oldPoint:point,refPoint:a,property:ba(i.AppIndex)}),h[g]=i,sa(h))},k=function(a,b,c,d){a&&ua({pointid:a},N,j),Q.name1=d.filter1,Q.name2=d.filter2,Q.name3=d.filter3,Q.name4=d.filter4,Q.selectedPointTypes=d.selectedPointTypes},l=function(){d.pointLookup.MODE="select",d.pointLookup.init(k,Q)};d=window.workspaceManager.openWindowPositioned(f,"Select Point","","","Select Point Column",{callback:l,width:1e3})},xa=function(a,b,c){var d,e,f=c||"/pointlookup/"+encodeURI("Report")+"/"+encodeURI(K.listOfFilters()[a].filterName)+"?mode=select",g=a,h=K.listOfFilters(),i=h[a],j=function(a){U.push(a),i.upi=a._id,i.valueType="UniquePID",i.value=a.Name,i.pointType=a["Point Type"].Value,Fa(i),e=window.workspaceManager.config.Update.formatPoint({point:point,oldPoint:point,refPoint:a,property:ba(i.AppIndex)}),h[g]=i,ra(h)},k=function(a,b,c,d){a&&ua({pointid:a},N,j),Q.name1=d.filter1,Q.name2=d.filter2,Q.name3=d.filter3,Q.name4=d.filter4},l=function(){d.pointLookup.MODE="select",d.pointLookup.init(k,Q)};d=window.workspaceManager.openWindowPositioned(f,"Select Point","","","Select Point Filter",{callback:l,width:1e3})},ya=function(){var a="/pointLookup",b={upi:0,valueType:"",colName:"",colDisplayName:""},c=function(a,c,d,e){a&&(b.upi=a,b.valueType="String",b.colName=c,b.colDisplayName=c.replace(/_/g," "))},d=function(){if(A.pointLookup.MODE="select",A.pointLookup.init(c,P),P.selectedPointTypes.length>0&&A.window.pointLookup.checkPointTypes(P.selectedPointTypes),!K.canEdit()){var a=B.contents().find("input,button,textarea,select");B.contents().find("#pointTypes");a.prop("disabled",!0)}};A=window.workspaceManager.openWindowPositioned(a,"Select Point","","","filter",{callback:d,width:1e3})},za=function(a){return Ba(moment.unix(a.date),a.time.toString())},Aa=function(a,b){var c,d,e,f=a;return void 0!==a&&void 0!==b&&(c=parseInt(b.replace(":",""),10),d=("00"+Math.floor(c/100)).slice(-2),e=("00"+c%100).slice(-2),f=a.startOf("day"),f=f.add(d,"h"),f=f.add(e,"m")),f},Ba=function(a,b){var c=Aa(moment.unix(a),b.toString());return c.unix()},Ca=function(a,b){var c=b,d=Qa(a.name);switch(c.filterName=a.name,c.condition="$and",c.operator="EqualTo",c.childLogic=!1,c.valueType=d.valueType,c.upi=0,delete c.AppIndex,c.value=Da(c.valueType),c.valueList=Oa(a.name,a.name),c.valueType){case"Timet":case"DateTime":c.date=moment().unix(),c.time=0;break;case"HourMinSec":case"HourMin":case"MinSec":c.hours=0,c.minutes=0,c.seconds=0;break;case"Enum":c.evalue=-1;break;case"BitString":c.bitStringEnumsArray=ha(window.workspaceManager.config.Enums[c.filterName+" Bits"])}return c},Da=function(a){var b;switch(a){case"Bool":case"BitString":b=0;break;case"UniquePID":case"undecided":case"Float":case"Integer":case"Unsigned":case"null":case"MinSec":case"HourMin":case"HourMinSec":b=0;break;case"DateTime":case"Timet":b=moment().unix();break;case"Enum":case"String":case"None":b="";break;default:b=""}return b},Ea=function(a){var b=ca(a,"Column Point");b?(a.AppIndex=b.AppIndex,a.upi=b.Value,a.colName=b.PointName):console.log("ERROR - validateColumns() could not locate Point Ref for upi = "+a.colName)},Fa=function(a){var b=ca(a,"Qualifier Point");b?(a.AppIndex=b.AppIndex,a.upi=b.Value,a.value=b.PointName):console.log("ERROR - validateFilters() could not locate Point Ref for upi = "+a.value)},Ga=function(a,b){var c,d={valid:!0};return"Choose Point"===a.colName?(d.valid=!1,d.error="Missing Column point at index "+b):"Choose Property"===a.colName?(d.valid=!1,d.error="Missing Column property at index "+b):"Totalizer"!==K.reportType&&"History"!==K.reportType||"Date"!==a.colName&&a.AppIndex&&(c=ca(a,"Column Point"),void 0===c&&(d.valid=!1,d.error="No corresponding 'Point Ref' for Column point at index "+b)),d},Ha=function(a){var b,c,d,e=[],f=function(){var a;for(c=0;c<K.listOfColumns().length;c++)a=K.listOfColumns()[c],a.AppIndex&&c>0&&Ea(a)};for(f(),b=$.extend(!0,[],K.listOfColumns()),c=0;c<b.length;c++)d=Ga(b[c],c),b[c].error=d.error,e.push(b[c]),a&&d.valid&&e.length>0&&(delete e[e.length-1].valueList,delete e[e.length-1].dataColumnName,delete e[e.length-1].rawValue,delete e[e.length-1].error,delete e[e.length-1].softDeleted,delete e[e.length-1].bitstringEnums,delete e[e.length-1].upi);return a&&aa(),e},Ia=function(a,b){var c;return c=K.listOfColumns().filter(function(c){return c.operator.toLowerCase()===a.toLowerCase()&&c.upi===b}),c[0]},Ja=function(a){var b;return b=K.listOfColumns().filter(function(b){return b.upi===a}),b[0]},Ka=function(a,b){K.listOfColumns().forEach(function(c){c[a]=b}),sa(K.listOfColumns())},La=function(a){var b,c,d,e,f,g,h=[],i=function(){for(g=0;g<K.listOfFilters().length;g++)f=K.listOfFilters()[g],"UniquePID"===f.valueType&&f.AppIndex&&Fa(f)};for(i(),e=$.extend(!0,[],K.listOfFilters()),g=0;g<e.length;g++)if(""!==e[g].filterName){switch(b=!0,c=!0,f=e[g],f.valueType){case"Timet":case"DateTime":moment.unix(f.date).isValid()?delete f.error:(b=!1,f.error="Invalid Date format in Filters"),0===parseInt(f.time,10)?f.time="00:00":f.time.toString().match(/^\s*([01]?\d|2[0-3]):?([0-5]\d)\s*$/)?(f.value=za(f),delete f.error):(b=!1,f.error="Invalid Time format in Filters");break;case"HourMinSec":case"HourMin":case"MinSec":f.hours=parseInt(f.hours,10),f.minutes=parseInt(f.minutes,10),f.seconds=parseInt(f.seconds,10),f.value=parseInt(3600*f.hours,10),f.value+=parseInt(60*f.minutes,10),f.value+=parseInt(f.seconds,10);break;case"UniquePID":f.upi>0&&f.AppIndex&&(d=ca(f,"Qualifier Point"),d?f.value=d.PointName:c=!1)}c&&h.push(f),a&&b&&h.length>0&&(delete h[h.length-1].valueList,delete h[h.length-1].error,delete h[h.length-1].softDeleted,delete h[h.length-1].upi)}return a&&aa(),h},Ma=function(a){var b,c,d,e=[],f=a.length;for(b=0;b<f;b++)c=a[b],d=!0,c.AppIndex&&(Fa(c),ea(c,"Qualifier Point")?(d=!1,console.log("'"+c.name+"' has been 'Destroyed', filter "+b+" is being removed from the displayed report.")):da(c,"Qualifier Point")&&(console.log("softdeleted theFilters["+b+"].upi = "+c.upi),c.softDeleted=!0)),d&&(c.valueList=Oa(c.filterName,c.filterName),e.push(c));return e},Na=function(a){var b,c,d,e=[],f=a.length;for(b=0;b<f;b++)if(c=a[b],d=!0,c.AppIndex&&b>0&&(Ea(c),ea(c,"Column Point")?(d=!1,console.log("'"+c.colName+"' has been 'Destroyed', column "+b+" is being removed from the displayed report.")):da(c,"Column Point")&&(console.log("softdeleted theColumns["+b+"].colName = "+a[b].colName),c.softDeleted=!0)),d){switch(c.canCalculate=ma(c),K.reportType){case"Property":c.canBeCharted=na(c),"BitString"===c.valueType&&(c.bitstringEnums=window.workspaceManager.config.Enums[c.colName+" Bits"]),c.dataColumnName=c.colName;break;case"History":c.valueList="",c.canBeCharted=na(c),c.dataColumnName=0===b&&"Date"===c.colName?c.colName:"point-"+c.upi;break;case"Totalizer":c.valueList=Pa(c.pointType),c.canBeCharted=na(c),c.dataColumnName=0===b&&"Date"===c.colName?c.colName:"point-"+c.upi+" - "+c.operator.toLowerCase();break;default:console.log(" - - - DEFAULT  initColumns()")}e.push(c)}return e},Oa=function(a,b){var c,d=[],e=window.workspaceManager.config.Utility.pointTypes.getEnums(a,b),f=e&&e.length?e.length:0;for(c=0;c<f;c++)d.push({value:e[c].name,evalue:e[c].value});return d},Pa=function(a){var b=[];if(a)switch(a){case"Binary Input":case"Binary Output":case"Binary Value":b.push({text:"Starts"}),b.push({text:"Runtime"});break;default:b.push({text:"Total"})}return b},Qa=function(a){return window.workspaceManager.config.Enums.Properties[a]},Ra=function(){Sa(),Ta()},Sa=function(){var a,b,c=window.workspaceManager.config.Enums.Properties,d=[];for(b in c)c.hasOwnProperty(b)&&c[b].reportEnable===!0&&$.inArray(b,d)===-1&&(a={},a.name=b,a.valueType=c[b].valueType,S.push(a));K.listOfFilterPropertiesLength=S.length},Ta=function(){var a=["Name"];T=S.filter(function(b){return $.inArray(b.name,a)===-1}),K.listOfColumnPropertiesLength=T.length},Ua=function(a,b){for(var c in a)if(a.hasOwnProperty(c)&&a[c]===parseInt(b,10))return c},Va=function(a,b){for(var c,d=0;d<a.length;d++)if(a[d].text===b){c=a[d].value;break}return c},Wa=function(a){if(a&&(K.selectedDuration({startDate:$.isNumeric(a.startDate)?moment.unix(a.startDate):a.startDate,startTimeOffSet:a.startTimeOffSet,endDate:$.isNumeric(a.endDate)?moment.unix(a.endDate):a.endDate,endTimeOffSet:a.endTimeOffSet,selectedRange:a.selectedRange?a.selectedRange:""}),K.durationStartTimeOffSet(a.startTimeOffSet),K.durationEndTimeOffSet(a.endTimeOffSet),a.interval&&(K.interval(a.interval.text),K.intervalValue(a.interval.value))),"object"==typeof K.selectedDuration()){if(K.selectedDuration().startTimeOffSet=K.durationStartTimeOffSet(),K.selectedDuration().endTimeOffSet=K.durationEndTimeOffSet(),"Custom Range"===K.selectedDuration().selectedRange)K.startDate=Ba(K.selectedDuration().startDate.unix(),K.durationStartTimeOffSet()),K.endDate=Ba(K.selectedDuration().endDate.unix(),K.durationEndTimeOffSet());else{var b=reportDateRanges(K.selectedDuration().selectedRange);K.selectedDuration().startDate=Aa(b[0],K.durationStartTimeOffSet()),K.selectedDuration().endDate=Aa(b[1],K.durationEndTimeOffSet()),K.startDate=K.selectedDuration().startDate.unix(),K.endDate=K.selectedDuration().endDate.unix()}K.selectedDuration().duration=K.selectedDuration().endDate.diff(K.selectedDuration().startDate)}K.selectedDuration.valueHasMutated()},Xa=function(){var a,b,c,d,e,f,g,h,i=!1,j=[];if(d=Ha(),f=La(),d.length>1){for(b=0;b<d.length;b++)e=d[b],d[b].error?(va(d[b].error),i=!0,l.find("tr:nth-child("+(b+1)+")").addClass("danger")):(l.find("tr:nth-child("+(b+1)+")").removeClass("danger"),d[b].upi>0&&j.push({upi:parseInt(d[b].upi,10),op:d[b].operator.toLowerCase()}));if("Totalizer"===K.reportType||"History"===K.reportType)Wa();else if(f.length>0)for(b=0;b<f.length;b++)if(g=f[b],g.error&&(va(g.error),i=!0),"BitString"===g.valueType){var k,m=0,n=window.workspaceManager.config.Enums[g.filterName+" Bits"];for(k in n)n.hasOwnProperty(k)&&"All"!==k&&(m+=n[k]["enum"]);for(g.value=0,c=0;c<g.bitStringEnumsArray.length;c++)k=g.bitStringEnumsArray[c].name,n.hasOwnProperty(k)&&(g.bitStringEnumsArray[c].checked&&(g.value+=n[k]["enum"]),g.value===m&&(g.value=n.All["enum"]))}if(!i){switch(K.reportType){case"History":case"Totalizer":point["Report Config"].interval={text:K.interval(),value:K.intervalValue()},point["Report Config"].duration={startDate:K.selectedDuration().startDate.unix(),endDate:K.selectedDuration().endDate.unix(),startTimeOffSet:K.durationStartTimeOffSet(),endTimeOffSet:K.durationEndTimeOffSet(),duration:K.selectedDuration().endDate.diff(K.selectedDuration().startDate),selectedRange:K.selectedDuration().selectedRange};break;case"Property":P=_a(B.contents());break;default:console.log(" - - - DEFAULT  buildReportDataRequest()")}point["Report Config"].pointFilter=P,point["Report Config"].columns=d,point["Report Config"].filters=f,h=ia(),G.push(h),a={requestID:h,upis:j,range:{start:K.startDate,end:K.endDate},reportConfig:point["Report Config"],reportType:point["Report Type"].Value,sort:""}}}else va("Column list is blank. Nothing to report on.");return a},Ya=function(a){if($.isNumeric(a))switch(b.find("li").removeClass("active"),b.find("li:eq("+(a-1)+")").addClass("active"),K.currentTab(a),a){case 1:c.addClass("active"),c.show(),d.removeClass("active"),d.hide(),C.show();break;case 2:c.removeClass("active"),c.hide(),d.addClass("active"),C.hide()}},Za=function(a){H=io.connect(window.location.origin),H.on("connect",function(){console.log("SOCKETID:",H.id),a&&a()}),H.on("returnReport",function(a){null===a.err||console.log("Error while retrieving data")})},$a=function(){a=$(".direports"),b=a.find(".tabs"),c=a.find(".tabConfiguration"),d=a.find(".tabViewReport"),e=a.find(".dataTablePlaceHolder"),f=a.find(".rightPanel"),g=f.find(".spinnertext"),h=a.find(".pointName1"),i=a.find(".pointName2"),j=a.find(".pointName3"),k=a.find(".pointName4"),l=a.find(".columnsGrid"),m=a.find(".filtersGrid"),t=a.find(".columnName"),p=a.find("#filterByPoint"),z=a.find(".saveReportButton"),B=p.find(".pointLookupFrame"),q=a.find(".reporttitle").find("input"),o=a.find(".filtersGrid tbody"),n=a.find(".columnsGrid .sortablecolums"),r=a.find("#reportColumns"),s=a.find("#additionalFilters"),C=a.find(".pop.popInOutDiv"),u=a.find(".hiddenPlaceholder"),v=u.find("input.globalPrecision"),w=u.find("input.globalChartCheckbox"),x=a.find(".availableChartTypes.chartTab"),y=a.find(".reportChartDiv")},_a=function(a){var b,c={name1:"",name2:"",name3:"",name4:"",selectedPointTypes:[]},d=1;return a.find(".toolbar").find(".searchInput").each(function(){b=$(this),c["name"+d++]=b.val()}),c.selectedPointTypes=ab(A),c},ab=function(a){var b,c,d=[];return a&&a.window.pointLookup&&(b=a.window.pointLookup.getCheckedPointTypes(),c=a.window.pointLookup.POINTTYPES.length,c!==b.length&&(d=b)),d},bb=function(a,b,c){var d,e,f,g="";return $.isNumeric(a)&&(c?g=(a/3600).toFixed(b):(d=(a/3600).toFixed(0),e=~~(a%3600/60),f=a%60,g+=d>1?ka(d,b)+" hours ":"",g+=e>0?ka(e,b)+" mins ":"",g+=f>0?ka(f,b)+" secs":"")),""!==g?g:0},cb=function(a,b){var c,d,e,f="",g={};if("object"!=typeof a?e=a:"object"==typeof a&&(e=a.Value,g=a),g.rawValue=e,b){switch(b.valueType){case"MinSec":f='<div class="durationCtrl durationDisplay"><span class="min"></span><span class="timeSeg">min</span><span class="sec"></span><span class="timeSeg">sec</span></div>',d=$(f),d.find(".min").html(~~(e%3600/60)),d.find(".sec").html(e%60),g.Value=d.html();break;case"HourMin":f='<div class="durationCtrl durationDisplay"><span class="hr"></span><span class="timeSeg">hr</span><span class="min"></span><span class="timeSeg">min</span></div>',d=$(f),d.find(".hr").html(~~(e/3600)),d.find(".min").html(~~(e%3600/60)),g.Value=d.html();break;case"HourMinSec":f='<div class="durationCtrl durationDisplay"><span class="hr"></span><span class="timeSeg">hr</span><span class="min"></span><span class="timeSeg">min</span><span class="sec"></span><span class="timeSeg">sec</span></div>',d=$(f),d.find(".hr").html(~~(e/3600)),d.find(".min").html(~~(e%3600/60)),d.find(".sec").html(e%60),g.Value=d.html();break;case"Float":case"Integer":$.isNumeric(e)?g.Value=ka(b.multiplier*e,b.precision):""===e?(g.Value=0,g.rawValue=0,e=0):g.Value=e;break;case"Unsigned":""===e?(g.Value=0,g.rawValue=0,e=0):g.Value=e;break;case"String":g.Value=e;break;case"Bool":if(""!==g.Value){var h=g.Value.toString().toLowerCase();g.Value=h[0].toUpperCase()+h.substring(1)}break;case"BitString":f=ga(b,e,!0),d=$(f),g.Value=d.html();break;case"Enum":case"undecided":case"null":case"None":$.isNumeric(e)?b.multiplier?g.Value=ka(b.multiplier*e,b.precision):g.Value=ka(e,b.precision):g.Value=e;break;case"DateTime":case"Timet":$.isNumeric(e)&&e>0?g.Value=moment.unix(e).format("MM/DD/YY HH:mm"):g.Value=e;break;case"UniquePID":void 0!==a.PointInst&&(a.PointInst>0?(g.Value=a.PointName,g.rawValue=a.PointName):(g.Value="",g.rawValue=""));break;default:g.Value=e}void 0!==b.valueOptions&&(c=Ua(b.valueOptions,e),c&&(g.Value=c))}else console.log("formatDataField()  columnConfig is undefined");return g},db=function(a){var b,c,d,e,f,g,h=[],i=a.length,j=[];for(f=0;f<i;f++){for(j=a[f].HistoryResults,e={},e.Date={},e.Date.Value=moment.unix(a[f].timestamp).format("MM/DD/YY HH:mm"),e.Date.rawValue=a[f].timestamp,g=0;g<j.length;g++)c=j[g].upi,d="point-"+c,e[d]={},void 0===j[g].Value?(e[d].Value="",e[d].rawValue=""):(b=Ja(c),void 0===b&&console.log("ERROR: columnConfig is undefined for columnName = "+c),e[d]=cb(j[g],b));h.push(e)}return h},eb=function(a){var b,c,d,e,f,g,h,i,j=[],k=a.length;if(k>0&&a[0].totals)for(i=0;i<a[0].totals.length;i++){for(e={},e.Date={},e.Date.Value=moment.unix(a[0].totals[i].range.start).format("MM/DD/YY HH:mm"),e.Date.rawValue=a[0].totals[i].range.start,h=0;h<k;h++)g=a[h].op.toLowerCase(),b=Ia(g,a[h].upi),c=b.upi+" - "+g,d="point-"+c,f=a[h].totals[i].total,e[d]={},void 0===a[h].totals[i].total?(e[d].Value="",e[d].rawValue=""):("runtime"===g?e[d].Value=0===f?0:bb(b.multiplier*f,b.precision,M):e[d].Value=ka(b.multiplier*f,b.precision),e[d].rawValue=parseFloat(f));j.push(e)}return j},fb=function(a){var b,c,d,e,f,g=$.extend(!0,[],K.listOfColumns());for(c=0;c<a.length;c++)for(d=0;d<g.length;d++)b=g[d],e=void 0!==b.dataColumnName?b.dataColumnName:b.colName,f=void 0!==a[c][e],f||(a[c][e]={},a[c][e].Value="",a[c][e].rawValue=""),a[c][e]=cb(a[c][e],b);return a},gb=function(a,b,c){var d;return d=Number.parseFloat(a.toString().replace(",","")),isNaN(d)&&(d=void 0!==c?parseFloat(c):parseFloat(b),isNaN(d)&&(d=b)),d},hb=function(a){var b,c=[];for(b=0;b<a.length;b++)c.indexOf(a[b].yAxis,0)===-1&&c.push(a[b].yAxis);for(c.sort(),b=0;b<a.length;b++)a[b].yAxis=c.indexOf(a[b].yAxis);return a},ib=function(a){K.activeRequestForChart(!0),K.chartSpinnerTitle("Formatting Data for Chart");var b,c,d,e,f,g,h=$.extend(!0,[],K.listOfColumns()),i=a.length,j=[],k=h.length,l=[],m=0,n=0;for(d=1;d<k;d++)if(m=0,b={},b=h[d],e=void 0!==b.dataColumnName?b.dataColumnName:b.colName,b.includeInChart){for("Pie"!==K.selectedChartType()&&(j=[]),c=0;c<i;c++)if(f=void 0!==a[c][e])switch(g=gb(a[c][e].Value,a[c][e].rawValue,a[c][e].eValue),K.reportType){case"History":case"Totalizer":"Pie"===K.selectedChartType()?m+=parseFloat(a[c][e].rawValue):j.push({timeStamp:moment.unix(a[c].Date.rawValue).toDate(),value:g,enumText:b.valueOptions?Ua(b.valueOptions,g):""});break;case"Property":"Pie"===K.selectedChartType()?m+=$.isNumeric(a[c][e].rawValue)?parseFloat(a[c][e].rawValue):0:j.push({value:g});break;default:console.log(" - - - DEFAULT  getOnlyChartData()")}else console.log("data["+c+" ]["+e+"] not found");"Pie"===K.selectedChartType()?(j.push({name:b.colName,y:parseFloat(m)}),n+=parseFloat(m)):j.length>0&&l.push({data:j,name:b.colName,yAxis:K.yaxisGroups.indexOf(b.yaxisGroup)})}if("Pie"===K.selectedChartType()){for(c=0;c<j.length;c++)j[c].y=parseFloat(ja(j[c].y/n*100,3));l.push({name:"Total",colorByPoint:!0,data:j})}return K.activeRequestForChart(!1),hb(l)},jb=function(){var a,b,c,e,f,g=95,h=d.find(".tab-pane.active");d.css("width",window.innerWidth-83),d.css("height",window.innerHeight),d.find(".tab-content").css("width",d.width()),d.find(".tab-content").css("height",d.height()-45),"chartData"===h.attr("id")?(h.css("height",window.innerHeight-90),h.css("width",window.innerWidth-130),h.css("margin-top","-22px")):"gridData"===h.attr("id")&&(b=d.find(".dataTables_scrollHead"),c=d.find(".dataTables_scrollBody"),e=d.find(".dataTables_scrollFoot"),f=d.find(".dataTables_wrapper"),$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust().draw,tb(),a=c.height()-(f.height()+g-window.innerHeight),b.css("width",f.width()-17),c.css("height",a),c.css("width",f.width()),e.css("width",f.width()-17))},kb=function(){var a=c.find(".tab-pane.active");"additionalFilters"===a.attr("id")||"reportColumns"===a.attr("id")?a.css("height",window.innerHeight-200):"reportAttribs"===a.attr("id")&&a.css("height",window.innerHeight-350)},lb=function(){W=new Date,setTimeout(function(){new Date-W>=V&&(2===K.currentTab()?"chartData"===d.find(".tab-pane.active").attr("id")?yb():jb():kb())},V)},mb=function(){switch(point["Report Config"].columns=Ha(!0),point["Report Config"].filters=La(!0),P=_a(B.contents()),point["Report Config"].pointFilter=P,point["Report Config"].selectedPageLength=K.selectedPageLength(),point["Report Config"].selectedChartType=K.selectedChartType(),
point["Report Config"].reportTitle=K.reportDisplayTitle(),K.reportType){case"History":case"Totalizer":point["Report Config"].interval={text:K.interval(),value:K.intervalValue()},point["Report Config"].duration={startDate:K.selectedDuration().startDate.unix(),endDate:K.selectedDuration().endDate.unix(),startTimeOffSet:K.durationStartTimeOffSet(),endTimeOffSet:K.durationEndTimeOffSet(),duration:K.selectedDuration().endDate.diff(K.selectedDuration().startDate),selectedRange:K.selectedDuration().selectedRange};break;case"Property":break;default:console.log(" - - - DEFAULT  init()")}point.name1=h.val(),point.name2=i.val(),point.name3=j.val(),point.name4=k.val(),point._name1=point.name1.toLowerCase(),point._name2=point.name2.toLowerCase(),point._name3=point.name3.toLowerCase(),point._name4=point.name4.toLowerCase(),point.Name=point.name1+"_"+point.name2+"_"+point.name3+"_"+point.name4,point.Name=point.Name.replace(/_\s*$/,""),point._Name=point.Name.toLowerCase(),0!==point._pStatus?H.emit("addPoint",{point:point}):H.emit("updatePoint",JSON.stringify({newPoint:point,oldPoint:O}))},nb=function(){var b,f,g,h,i,j,k=!1,p=!1;$(window).resize(function(){lb()}),a.find(".addColumnButton").on("click",function(a){var b,c="Totalizer"===K.reportType||"History"===K.reportType?"Choose Point":"Choose Property",d={colName:c,colDisplayName:"",valueType:"String",operator:"",calculation:"",canCalculate:!1,canBeCharted:!1,includeInChart:!1,multiplier:1,precision:3,valueList:[],upi:0};a.preventDefault(),a.stopPropagation(),K.listOfColumns.indexOf(d)===-1&&(K.listOfColumns.push(d),sa(K.listOfColumns()),b=n.find("tr:last"),b.addClass("ui-sortable-handle"),b.addClass("danger"),"Property"!==K.reportType&&K.selectPointForColumn(d,K.listOfColumns().length-1)),lb(),r.stop().animate({scrollTop:r.get(0).scrollHeight},700)}),a.find(".addFilterbutton").on("click",function(a){var b={filterName:"",condition:"$and",childLogic:!1,beginGroup:!1,endGroup:!1,operator:"EqualTo",valueType:"String",value:"",valueList:""};a.preventDefault(),a.stopPropagation(),K.listOfFilters.indexOf(b)===-1&&(K.listOfFilters.push(b),ra(K.listOfFilters())),lb(),s.stop().animate({scrollTop:s.get(0).scrollHeight},700)}),z.on("click",function(){var a=c.find(".screenMessages");oa(c,!0," Saving Report..."),a.find(".errorMessage").text(""),a.find(".successMessage").text(""),mb(),$(this).blur()}),a.find(".runReportButton").on("click",function(a){$(this).focus(),a.preventDefault(),a.stopPropagation(),K.requestReportData()}),e.on("click",".pointInstance",function(){var a={upi:$(this).attr("upi"),pointType:$(this).attr("pointType"),pointName:$(this).text()};K.showPointReview(a)}),c.find(".toggleTab").on("shown.bs.tab",function(){kb()}),H.on("pointUpdated",function(a){var b;console.log(" -  -  - reportSocket() 'pointUpdated' returned"),null===a.err||void 0===a.err?(K.unSavedDesignChange(!1),b=c.find(".screenMessages").find(".successMessage"),b.text("Report Saved"),setTimeout(function(){b.text("")},3e3)):(K.unSavedDesignChange(!0),O=_.clone(newPoint,!0),K.reportDisplayTitle(O.Name.replace("_"," ")),c.find(".screenMessages").find(".errorMessage").text(a.err)),oa(c,!1)}),e.on("column-reorder.dt",function(a,b,c){var d=$.extend(!0,[],K.listOfColumns()),f=$.extend(!0,{},d[c.iFrom]);d.splice(c.iFrom,1),d.splice(c.iTo,0,f),sa(d),e.DataTable().draw("current"),console.log("moved column '"+c.from+"' to column '"+c.to+"'")}),e.on("column-resize.dt",function(a,b,c){var d=$.extend(!0,[],K.listOfColumns());d[c.resizedColumn].width=c.width,sa(d),e.DataTable().draw("current")}),e.on("length.dt",function(a,b,c){K.selectedPageLength(c),setTimeout(function(){jb()},10)}),e.on("page.dt",function(a,b){setTimeout(function(){jb()},10)}),e.on("search.dt",function(a,b){setTimeout(function(){jb()},10)}),e.on("draw.dt",function(a,b){var c,f,g,h=e.DataTable().page.info().pages;1===h&&(c=d.find(".dataTables_paginate"),f=c.find("ul.pagination"),g=f.find(".paginate_button"),g=g.not("li.active"),g.hide())}),l.find(".precisionColumn").on("mousedown",function(a){K.canEdit()&&(D=moment())}),l.find(".precisionColumn").on("click",function(a){K.canEdit()&&moment().diff(D)>L&&(k||(i=$(this).html()),"Precision"===$(this).html()&&(v.removeClass("hidden"),$(this).html(""),v.appendTo($(this)),$(this).find("input").focus()),k||(k=!0,$(this).focusout(function(a){v.appendTo(u),$(this).html(i)}),$(this).keyup(function(a){if(13===a.keyCode){var b;(isNaN($(this).find("input").val())||""===$(this).find("input").val())&&$(this).find("input").val(0),b=$(this).find("input").val(),K.globalPrecisionValue(parseInt(b,10)),Ka("precision",K.globalPrecisionValue())}})))}),l.find("th .includeInChartColumn").on("mousedown",function(a){K.canEdit()&&(D=moment())}),l.find("th .includeInChartColumn").on("click",function(a){return K.canEdit()&&moment().diff(D)>L&&(p||(j=$(this).html()),"Chart"===$(this).html()&&(w.removeClass("hidden"),$(this).html(""),w.appendTo($(this)),$(this).find("input").focus()),p||(p=!0,$(this).focusout(function(a){w.appendTo(u),$(this).html(j)}),$(this).click(function(a){if(void 0!==a.target.checked)return Ka("includeInChart",a.target.checked),!0}))),!0}),m.sortable({appendTo:o,disabled:!1,items:"tr",forceHelperSize:!0,helper:"original",stop:function(a,b){var c,d=ko.dataFor(b.item[0]),e=ko.utils.arrayIndexOf(b.item.parent().children(),b.item[0]);e>=K.listOfFilters().length&&(e=K.listOfFilters().length-1),e<0&&(e=0),b.item.remove(),K.listOfFilters.remove(d),K.listOfFilters.splice(e,0,d),c=K.listOfFilters(),ra(c)},scroll:!0,handle:".handle"}),l.sortable({appendTo:n,disabled:!1,items:"tr",forceHelperSize:!0,helper:"original",stop:function(a,b){var c,d=ko.dataFor(b.item[0]),e=ko.utils.arrayIndexOf(b.item.parent().children(),b.item[0]);e>=K.listOfColumns().length&&(e=K.listOfColumns().length-1),e<0&&(e=0),b.item.remove(),K.listOfColumns.remove(d),K.listOfColumns.splice(e,0,d),c=K.listOfColumns(),sa(c)},scroll:!0,handle:".handle"}),window.top.location.href===window.location.href&&($(".popOut").addClass("hidden"),$(".popIn").removeClass("hidden")),b=[{text:"Minute"},{text:"Hour"},{text:"Day"},{text:"Week"},{text:"Month"},{text:"Year"}],f=[{text:"Mean"},{text:"Max"},{text:"Min"},{text:"Sum"},{text:"Std Dev"}],g=[{value:"10",unit:10},{value:"15",unit:15},{value:"24",unit:24},{value:"48",unit:48},{value:"75",unit:75},{value:"100",unit:100},{value:"All",unit:-1}],h=[{text:"Line",value:"line"},{text:"Column",value:"column"},{text:"Pie",value:"pie"},{text:"Spline",value:"spline"}],K.listOfIntervals(b),K.listOfCalculations(f),K.listOfEntriesPerPage=g,K.listOfChartTypes=h,pa(),qa()},ob=function(a){var b,c=qb(a),d=[],e=0,f=0,g=0;for(b=0;b<a.length;b++)e=Math.pow(a[b]-c,2),f+=e,d.push(e);return d.length>0&&(g=f/d.length),g},pb=function(a){return Math.sqrt(ob(a))},qb=function(a){var b,c=0,d=0;for(b=0;b<a.length;b++)d+=a[b];return a.length>0&&(c=d/a.length),c},rb=function(a){var b,c=0;for(b=0;b<a.length;b++)c+=a[b];return c},sb=function(a,b){var c,d=[],f=$.extend(!0,[],K.listOfColumns()),g=function(a,b,c,d){switch(K.reportType){case"History":0===d&&"Date"===b.dataColumnName?$(a).attr("title",moment.unix(c[b.dataColumnName].rawValue).format("dddd")):b.units&&$(a).attr("title",b.units);break;case"Totalizer":0===d&&"Date"===b.dataColumnName&&$(a).attr("title",moment.unix(c[b.dataColumnName].rawValue).format("dddd"));break;case"Property":"Name"===b.colName?($(a).attr("upi",c._id),$(a).attr("columnIndex",d),c["Point Type"]&&c["Point Type"].Value&&($(a).attr("title",c["Point Type"].Value),$(a).attr("pointType",c["Point Type"].Value))):"Timet"!==b.valueType&&"DateTime"!==b.valueType||$(a).attr("title",moment.unix(c[b.dataColumnName].rawValue).format("dddd"));break;default:console.log(" - - - DEFAULT  setTdAttribs()")}if(c[b.colName]&&c[b.colName].PointInst){var e;e=window.workspaceManager.config.Utility.pointTypes.getPointTypeNameFromEnum(c[b.colName].PointType),$(a).addClass("pointInstance"),$(a).attr("upi",c[b.colName].PointInst),$(a).attr("pointType",e)}},h=function(a,b){var c="";if("Name"===a.colName)switch(K.reportType){case"History":case"Totalizer":break;case"Property":c+="pointInstance ";break;default:console.log(" - - - DEFAULT  setColumnClasses()")}switch(a.valueType){case"MinSec":case"HourMin":case"HourMinSec":c+="durationCtrl durationDisplay"}return 0===b&&(c+="firstColumn "),"DateTime"===a.valueType&&(c+="small datetime "),"BitString"===a.valueType&&(c+="small "),a.canCalculate===!0&&(c+="text-right "),void 0!==a.softDeleted&&a.softDeleted&&(c+="softDeleted"),c},i=function(a,b){var c,d=a.colDisplayName,e=!0;switch(K.reportType){case"History":break;case"Totalizer":0===b&&"Date"===a.colName?d="Period Begin":0!==b&&(d+=" - "+a.operator,"runtime"===a.operator.toLowerCase()&&(d+=" (Hours)"));break;case"Property":break;default:d="Default",console.log(" - - - DEFAULT  buildColumnObject()")}return void 0!==a.softDeleted&&a.softDeleted&&(d="[Deleted] "+d),c={title:d,data:a.dataColumnName,width:a.width?a.width:"auto",render:{_:"Value",type:"rawValue",sort:"rawValue",filter:"Value",display:"Value"},className:h(f[b],b),fnCreatedCell:function(a,b,c,d,e){g(a,f[e],c,e)},bSortable:e}},j=function(a,b,c){var d,e,f=[],g={totalCalc:0,pageCalc:0},h=a.length===b.length,i=function(a){for(var b=[],c=0;c<a.length;c++)d=a[c].rawValue,d="object"==typeof d?d.Value:d,$.isNumeric(d)?b.push(parseFloat(d)):b.push(0);return b};switch(e=i(b),h||(f=i(a)),c.calculation.toLowerCase()){case"mean":g.totalCalc=qb(e),g.pageCalc=h?g.totalCalc:qb(f);break;case"max":g.totalCalc=Math.max.apply(Math,e),g.pageCalc=h?g.totalCalc:Math.max.apply(Math,f);break;case"min":g.totalCalc=Math.min.apply(Math,e),g.pageCalc=h?g.totalCalc:Math.min.apply(Math,f);break;case"sum":g.totalCalc=rb(e),g.pageCalc=h?g.totalCalc:rb(f);break;case"std dev":g.totalCalc=pb(e),g.pageCalc=h?g.totalCalc:pb(f);break;default:console.log(" - - - DEFAULT  getCalcForColumn()")}return g};if($.fn.DataTable.isDataTable(e)){var k=[];$.each(e.DataTable().buttons()[0].inst.s.buttons,function(){k.push(this)}),$.each(k,function(){e.DataTable().buttons()[0].inst.remove(this.node)}),e.DataTable().destroy(),e.find("thead").empty(),e.find("tbody").empty()}for(b===!0&&(E={}),c=0;c<f.length;c++)d.push(i(f[c],c));d.length>0&&e.DataTable({api:!0,dom:"Blfrtip",buttons:[{extend:"collection",text:"Export",buttons:[{extend:"copyHtml5",text:'<i class="fa fa-files-o"></i> Copy',key:{altKey:!0,key:"1"}},{extend:"csvHtml5",text:'<i class="fa fa-file-o"></i> CSV',key:{altKey:!0,key:"2"}},{extend:"excelHtml5",text:'<i class="fa fa-file-excel-o"></i> Excel',key:{altKey:!0,key:"3"}},{extend:"pdfHtml5",text:'<i class="fa fa-file-pdf-o"></i> PDF',footer:!0,key:{altKey:!0,key:"4"},customize:function(a,b){}}]},{extend:"print",text:'<i class="fa fa-print"></i> Print',key:{altKey:!0,key:"5"},customize:function(a){var b,d=$(a.document.body),e=$(a.document.head),g=d.find("table"),i=window.location.protocol+"//"+window.location.host;for(e.find("link[rel=stylesheet]").remove(),e.append('<link rel="stylesheet" href="'+i+'/css/reports/reportprinting.css" type="text/css" />'),g.removeClass("table-striped dataTablePlaceHolder dataTable"),g.addClass("table").addClass("table-sm"),g.css("padding","2px"),c=0;c<f.length;c++)b=h(f[c],c),g.find("td:nth-child("+(c+1)+")").addClass(b)}}],drawCallback:function(a){tb()},headerCallback:function(a,b,c,d,e){var f,g,h=$.extend(!0,[],K.listOfColumns());for(f=0;f<h.length;f++)h[f].calculation&&""!==h[f].calculation&&$(a).find("th").eq(f).addClass("calculate"),$(a).find("th").eq(f).addClass("text-center"),$(a).find("th").eq(f).removeClass("small");switch(K.reportType){case"History":case"Totalizer":g=$(a).find("th"),g.each(function(a,b){$(b).attr("oncontextmenu","reportsVM.showPointReviewViaIndex("+a+"); return false;"),$(b).attr("title","Right mouse click to run PointInspector")});break;case"Property":g=$(a).find("th:first"),g.addClass("pointLookupColumn")}},footerCallback:function(a,b,c,d,e){var f,g,h,i,k,l,m,n,o,p,q,r,s=this.api(),t=$.extend(!0,[],K.listOfColumns()),u=s.columns(".calculate")[0],v=u.length;for(g=0;g<v;g++){switch(h=u[g],m=t[h],i=s.column(h,{page:"current"}).data(),k=s.column(h).data(),l=i.length===k.length,n=j(i,k,m),r=$(a).find("td[colindex='"+h+"']"),r.attr("title","Page Calc (Table Calc)"),K.reportType){case"History":l||(o="<span>Page "+m.calculation+": "+ka(n.pageCalc,m.precision)+(m.units?" "+m.units:"")+"</span>"),p="<span>Total "+m.calculation+": "+ka(n.totalCalc,m.precision)+(m.units?" "+m.units:"")+"</span>";break;case"Totalizer":"runtime"===m.operator.toLowerCase()?(l||(o="<span>Page "+m.calculation+": "+bb(n.pageCalc,m.precision,M)+"</span>"),p="<span>Total "+m.calculation+": "+bb(n.totalCalc,m.precision,M)+"</span>"):(l||(o="<span>Page "+m.calculation+": "+ka(n.pageCalc,m.precision)+(m.units?" "+m.units:"")+"</span>"),p="<span>Total "+m.calculation+": "+ka(n.totalCalc,m.precision)+(m.units?" "+m.units:"")+"</span>");break;case"Property":l||(o="<span>Page "+m.calculation+": "+ka(n.pageCalc,m.precision)+"</span>"),p="<span>Total "+m.calculation+": "+ka(n.totalCalc,m.precision)+"</span>";break;default:console.log(" - - - DEFAULT  footerCallback()")}q=(l?"":o+"<br>")+p,r.html(q)}v>0?(f=$(a).find("td[colindex='0']"),f.text("Calculations:"),f.removeClass("small"),f.addClass("text-right")):$(a).parent().parent().addClass("hidden")},data:E,columns:d,colReorder:{fixedColumnsLeft:1,realtime:!1},order:[[0,"asc"]],scrollY:!0,scrollX:!0,scrollCollapse:!0,lengthChange:!0,lengthMenu:[[10,15,24,48,75,100,-1],[10,15,24,48,75,100,"All"]],pageLength:parseInt(K.selectedPageLength(),10)}),K.designChanged(!1)},tb=function(){var a=d.find(".dataTables_paginate"),b=a.find(".reportDisplayFooter");b.length>0?b.text(K.currentTimeStamp):(b=$("<div class='small reportDisplayFooter'>"+K.currentTimeStamp+"</div>"),b.prependTo(a))},ub=function(){void 0!==E&&2===K.currentTab()&&(C.show(),K.reportResultViewed(2===K.currentTab()),oa(d,!1),e.DataTable().clear(),e.DataTable().rows.add(E),e.DataTable().draw("current"),$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust().draw,K.refreshData(!1),K.currentTimeStamp=moment().format("dddd MMMM DD, YYYY hh:mm:ss a"),I||d.find("a.btn.btn-default.buttons-collection").on("click",function(){I||setTimeout(function(){a.find("li.dt-button > a").on("click",function(){console.log($(this).text()+" button clicked"),$(this).parent().parent().hide()})},100),I=!0}),jb())},vb=function(a){K.activeDataRequest(!1),void 0===a.err?(E=db(a.historyData),K.truncatedData(E.truncated),ub()):console.log(" - * - * - renderHistoryReport() ERROR = ",a.err)},wb=function(a){K.activeDataRequest(!1),void 0===a.err?(E=eb(a),K.truncatedData(E.truncated),ub()):console.log(" - * - * - renderTotalizerReport() ERROR = ",a.err)},xb=function(a){K.activeDataRequest(!1),void 0===a.err?(E=fb(a),K.truncatedData(E.truncated),ub()):console.log(" - * - * - renderPropertyReport() ERROR = ",a.err)},yb=function(a){var b,c,d,e,f,g,h,i=5e4,j=K.reportDisplayTitle(),k="";if(K.activeRequestForChart(!0),f=a?"Configuring "+K.selectedChartType()+" Chart for printing....":"Rending "+K.selectedChartType()+" Chart....",K.chartSpinnerTitle(f),y.html(""),jb(),c=Va(K.listOfChartTypes,K.selectedChartType()),g=a?950:y.parent().width(),h=a?650:y.parent().height(),F=ib(E),F&&F[0])if(F[0].data.length<i){switch(K.reportType){case"History":k=K.selectedDuration().startDate.format("MM/DD/YYYY hh:mm a")+" - "+K.selectedDuration().endDate.format("MM/DD/YYYY hh:mm a"),e="Totals";break;case"Totalizer":k=K.selectedDuration().startDate.format("MM/DD/YYYY hh:mm a")+" - "+K.selectedDuration().endDate.format("MM/DD/YYYY hh:mm a"),e="Totals";break;case"Property":break;default:console.log(" - - - DEFAULT  renderChart()")}F&&"Pie"!==K.selectedChartType()&&F.sort(function(a,b){return a.timeStamp>b.timeStamp?1:-1}),setTimeout(function(){y.length>0&&("Pie"===K.selectedChartType()?y.highcharts({turboThreshold:i,chart:{width:g,height:h,plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},title:{text:j},subtitle:{text:k},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:F}):("Column"!==K.selectedChartType()&&(d={formatter:function(){return'<span style="font-size: 10px">'+moment(this.x).format("dddd, MMM Do, YYYY HH:mm")+'</span><br><span style="color:'+this.point.color+'">●</span> '+this.point.series.name+": <b>"+trendPlots.numberWithCommas(this.y)+(this.point.enumText?"-"+this.point.enumText:"")+"</b><br/>"}}),b=new TrendPlot({turboThreshold:i,width:g,height:h,target:y,title:j,subtitle:k,y:"value",x:"timeStamp",enumText:"enumText",data:F,type:c,chart:{zoomType:"x"},tooltip:d,xAxis:{allowDecimals:!1},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},yAxisTitle:e}))),K.activeRequestForChart(!1)},110)}else y.html("Too many data rows for "+K.selectedChartType()+" Chart. Max = "+i);else y.html("Chart data not available")};K.reportType="",K.selectedPageLength=ko.observable("24"),K.selectedChartType=ko.observable("Line"),K.currentTimeStamp="",K.startDate="",K.endDate="",K.yaxisGroups=["A","B","C","D","E","F","G","H","I","J"],K.reportDisplayTitle=ko.observable(""),K.canEdit=ko.observable(!0),K.interval=ko.observable("Day"),K.intervalValue=ko.observable(1),K.globalPrecisionValue=ko.observable(3),K.allChartCheckboxChecked=ko.observable(!1),K.durationError=ko.observable(!1),K.selectedDuration=ko.observable({startDate:moment(),endDate:moment().add(1,"day"),startTimeOffSet:"00:00",endTimeOffSet:"00:00",duration:moment().add(1,"day").diff(moment()),selectedRange:"Today"}),K.durationStartTimeOffSet=ko.observable(K.selectedDuration().startTimeOffSet),K.durationEndTimeOffSet=ko.observable(K.selectedDuration().endTimeOffSet),K.listOfIntervals=ko.observableArray([]),K.listOfCalculations=ko.observableArray([]),K.listOfEntriesPerPage=[],K.listOfChartTypes=[],K.listOfFilterPropertiesLength=0,K.listOfColumnPropertiesLength=0,K.filterPropertiesSearchFilter=ko.observable("-blank-"),K.columnPropertiesSearchFilter=ko.observable("-blank-"),K.chartSpinnerTitle=ko.observable(""),K.truncatedData=ko.observable(!1),K.designChanged=ko.observable(!0),K.unSavedDesignChange=ko.observable(!1),K.refreshData=ko.observable(!0),K.activeDataRequest=ko.observable(!1),K.activeRequestForChart=ko.observable(!1),K.reportResultViewed=ko.observable(!0),K.chartable=ko.observable(!1),K.currentTab=ko.observable(1),K.listOfColumns=ko.observableArray([]),K.listOfFilters=ko.observableArray([]),K.printDiv=function(){yb(!0),setTimeout(function(){y.css("overflow","visible"),y.printArea({mode:"iframe"}),y.css("overflow","auto")},1500)},K.deleteColumnRow=function(a){K.listOfColumns.remove(a),sa(K.listOfColumns())},K.deleteFilterRow=function(a){K.listOfFilters.remove(a),ra(K.listOfFilters())},K.init=function(b){var c,d;if(I=!1,G=[],$a(),initKnockout(),point){if(K.canEdit(Z(point,R.WRITE)),O=JSON.parse(JSON.stringify(point)),J=point._id,void 0===point["Report Config"]&&(point["Report Config"]={}),K.reportType=point["Report Type"].Value,d=point["Report Config"]?point["Report Config"]:void 0,c=d?d.columns:void 0,h.val(point.name1),i.val(point.name2),j.val(point.name3),k.val(point.name4),Za(),c)switch(K.reportDisplayTitle(point["Report Config"].reportTitle?point["Report Config"].reportTitle:point.Name.replace(/_/g," ")),K.listOfColumns(Na(d.columns)),K.listOfFilters(Ma(d.filters)),P=d.pointFilter?d.pointFilter:P,K.selectedPageLength(d.selectedPageLength?d.selectedPageLength:K.selectedPageLength()),K.selectedChartType(d.selectedChartType?d.selectedChartType:K.selectedChartType()),K.reportType){case"History":case"Totalizer":point["Report Config"].duration.duration&&Wa(point["Report Config"].duration),K.interval(point["Report Config"].interval.text),K.intervalValue(point["Report Config"].interval.value);break;case"Property":ya(p),Ra();break;default:console.log(" - - - DEFAULT  init()")}else switch(K.reportDisplayTitle(point.Name.replace(/_/g," ")),point["Point Refs"]=[],point["Report Config"].columns=[],point["Report Config"].filters=[],point["Report Config"].pointFilter=P,K.reportType){case"History":case"Totalizer":point["Report Config"].returnLimit=2e3,K.listOfColumns.push({colName:"Date",colDisplayName:"Date",dataColumnName:"Date",valueType:"DateTime",AppIndex:-1,operator:"",calculation:"",canCalculate:!1,canBeCharted:!1,yaxisGroup:"A",includeInChart:!1,multiplier:1,precision:0,valueList:[],upi:0}),Wa();break;case"Property":ya(p),Ra(),point["Report Config"].returnLimit=4e3,K.listOfColumns.push({colName:"Name",colDisplayName:"Name",dataColumnName:"Name",valueType:"String",AppIndex:-1,precision:0,calculation:"",canCalculate:!1,canBeCharted:!1,yaxisGroup:"A",includeInChart:!1,multiplier:1});break;default:console.log(" - - - DEFAULT  init() null columns")}a.find("#wrapper").show(),Ya(1),ra(K.listOfFilters()),setTimeout(function(){q.focus()},1500),nb(),kb(),K.filterPropertiesSearchFilter(""),K.columnPropertiesSearchFilter(""),b&&("History"!==K.reportType&&"Totalizer"!==K.reportType||Wa(b),K.requestReportData())}},K.operators=function(a){var b=[];switch(a){case"Bool":case"BitString":case"UniquePID":case"Enum":case"undecided":b.push({text:"=",value:"EqualTo"},{text:"!=",value:"NotEqualTo"});break;case"String":b.push({text:"=",value:"EqualTo"},{text:"!=",value:"NotEqualTo"},{text:"{*}",value:"Containing"},{text:"{!*}",value:"NotContaining"});break;case"Float":case"Integer":case"Unsigned":case"null":case"MinSec":case"HourMin":case"HourMinSec":case"DateTime":case"Timet":b.push({text:"=",value:"EqualTo"},{text:"!=",value:"NotEqualTo"},{text:">",value:"GreaterThan"},{text:"<",value:"LessThan"},{text:">=",value:"GreaterThanOrEqualTo"},{text:"<=",value:"LessThanOrEqualTo"});break;case"None":b.push({text:"=",value:"EqualTo"},{text:"!=",value:"NotEqualTo"},{text:"{*}",value:"Containing"},{text:"{!*}",value:"NotContaining"},{text:">",value:"GreaterThan"},{text:"<",value:"LessThan"},{text:">=",value:"GreaterThanOrEqualTo"},{text:"<=",value:"LessThanOrEqualTo"});break;default:b.push({text:"=",value:"EqualTo"},{text:"!=",value:"NotEqualTo"})}return b},K.conditions=function(){return[{text:"AND",value:"$and"},{text:"OR",value:"$or"}]},K.displayCondition=function(a){switch(a){case"$and":return"AND";case"$or":return"OR";default:return a}},K.displayOperator=function(a){switch(a){case"EqualTo":return"=";case"NotEqualTo":return"!=";case"Containing":return"{*}";case"NotContaining":return"{!*}";case"GreaterThan":return">";case"GreaterThanOrEqualTo":return">=";case"LessThan":return"<";case"LessThanOrEqualTo":return"<=";default:return a}},K.displayBool=function(a){switch(a){case!0:case"True":return"On";case!1:case"False":return"Off";default:return a}},K.selectPointForColumn=function(a,b){var c=parseInt(a.upi,10),d="function"==typeof b?b():b,e=parseInt(d,10);wa(e,c)},K.selectPointForFilter=function(a,b){var c=parseInt(a.upi,10),d=parseInt(b(),10);xa(d,c)},K.showPointReviewViaIndex=function(a){K.showPointReview(K.listOfColumns()[a])},K.showPointReview=function(a){var b=window.workspaceManager.openWindowPositioned,c=parseInt(a.upi,10),d={width:1250,height:750};c>0&&("Display"===a.pointType?b("/displays/view/"+c,"Display","Display","newwindow",c,d):b("/pointinspector/"+c,"Point","Point","newwindow",c,d))},K.reportConfiguration=function(){Ya(1)},K.requestReportData=function(){if(K.durationError())va("Invalid Date Time selection");else if(2!==K.currentTab()){var a=Xa();if(a)if(Ya(2),K.selectViewReportTabSubTab("gridData"),K.reportResultViewed())switch(C.hide(),K.activeDataRequest(!0),K.reportResultViewed(!1),sb(!0,!0),E=void 0,K.reportType){case"History":ua(a,"/report/historyDataSearch",vb);break;case"Totalizer":ua(a,"/report/totalizerReport",wb);break;case"Property":ua(a,"/report/reportSearch",xb);break;default:console.log(" - - - DEFAULT  viewReport()")}else ub()}$("html,body").stop().animate({scrollTop:0},700)},K.requestChart=function(){K.selectViewReportTabSubTab("chartData"),y.html(""),F=ib(E),yb()},K.focusGridView=function(){K.selectViewReportTabSubTab("gridData"),jb()},K.clearColumnPoint=function(a){var b=K.listOfColumns(),c=b[a];c.colName="Choose Point",c.valueType="String",c.operator="",c.upi=0,c.colDisplayName="",c.pointType="",c.units="",c.valueList="",c.dataColumnName="",c.AppIndex&&delete c.AppIndex,c.softDeleted&&delete c.softDeleted,sa(b)},K.clearColumnCalculation=function(a){var b=K.listOfColumns(),c=b[a];c.calculation="",sa(b)},K.clearFilterPoint=function(a){var b=K.listOfFilters(),c=b[a];c.value=Da(c.valueType),c.AppIndex&&delete c.AppIndex,c.softDeleted&&delete c.softDeleted,c.upi=0,ra(b)},K.selectPropertyColumn=function(a,b,c){var d=K.listOfColumns(),e=d[b],f=Qa(c.name);e.colName=c.name,e.colDisplayName=c.name,e.dataColumnName=e.colName,e.valueType=f.valueType,e.AppIndex&&delete e.AppIndex,e.calculation="",e.canCalculate=ma(e),e.canBeCharted=na(e),e.yaxisGroup="A",e.includeInChart=!1,sa(d)},K.selectPropertyFilter=function(a,b,c){var d=K.listOfFilters();$(a).parent().parent().parent().parent().parent();d[b]=Ca(c,d[b]),ra(d)},K.selectTotalizerOperator=function(a,b,c){var d=K.listOfColumns(),e=d[b];e.operator=c,e.dataColumnName=e.upi+" - "+e.operator.toLowerCase(),sa(d)},K.selectYaxisGroup=function(a,b,c){var d=K.listOfColumns(),e=d[b];e.yaxisGroup=c,sa(d)},K.selectCalculation=function(a,b,c){var d=K.listOfColumns(),e=d[b];e.calculation=c,sa(d)},K.selectNumberOfEntries=function(a,b){for(var c=0;c<K.listOfEntriesPerPage.length;c++)if(K.listOfEntriesPerPage[c].value===b){K.selectedPageLength(K.listOfEntriesPerPage[c].unit),K.designChanged(!0),K.unSavedDesignChange(!0);break}},K.selectChartType=function(a,b,c){for(var d=0;d<K.listOfChartTypes.length;d++)if(K.listOfChartTypes[d].value===b){K.selectedChartType(K.listOfChartTypes[d].text),K.designChanged(!0),K.unSavedDesignChange(!0);break}c&&yb()},K.includeInChartChanged=function(a,b){var c=K.listOfColumns(),d=c[b];return d.includeInChart=a.checked,sa(c),!0},K.selectInterval=function(a){K.interval(a)},K.setFilterConfig=function(a,b,c){var d=K.listOfFilters(),e=d[a];e[c]!=b.value&&(e[c]=b.value,ra(d))},K.selectedFilterEValue=function(a,b){var c=K.listOfFilters(),d=c[a];d.evalue!=b.evalue&&(d.value=b.value,d.evalue=b.evalue,ra(c))},K.propertySelectClick=function(a){var b=$(a).parent().find("input");window.setTimeout(function(){b.focus()},50)},K.selectConfigTabSubTab=function(a){c.find("ul.nav-tabs").find("li.active").removeClass("active"),c.find("ul.nav-tabs").find("li."+a).addClass("active"),c.find(".tab-content > .active").removeClass("active"),c.find("#"+a).addClass("active")},K.selectViewReportTabSubTab=function(a){d.find("ul.nav-tabs").find("li.active").removeClass("active"),d.find("ul.nav-tabs").find("li."+a).addClass("active"),d.find(".tab-content > .active").removeClass("active"),d.find("#"+a).addClass("active")},K.togglePop=function(){var a={width:1080,height:768};window.top.location.href===window.location.href?window.workspaceManager.openWindowPositioned(window.location.href,point.Name,"report","mainWindow",J):window.workspaceManager.openWindowPositioned(window.location.href,point.Name,"report","",J,a)},K.listOfIntervalsComputed=ko.computed(function(){var a,b,c=[],d=!0;return K.selectedDuration()&&K.selectedDuration().endDate&&(K.selectedDuration().startDate=Aa(K.selectedDuration().startDate,K.durationStartTimeOffSet()),K.selectedDuration().endDate=Aa(K.selectedDuration().endDate,K.durationEndTimeOffSet()),b=K.selectedDuration().endDate.diff(K.selectedDuration().startDate),K.durationError(b<0),K.durationError()?va("Invalid Date Time selection"):(c=K.listOfIntervals().filter(function(a){return moment.duration(1,a.text).asMilliseconds()<=b}),c.length>0&&(c.forEach(function(a){K.interval().toLowerCase()===a.text.toLowerCase()&&(d=!1)}),d?(K.interval(c[c.length-1].text),K.intervalValue(1)):(a=moment.duration(1,K.interval()).asMilliseconds(),a*K.intervalValue()>b&&K.intervalValue(1))))),c},K),K.filterFilteredProps=ko.computed(function(){var a=K.filterPropertiesSearchFilter().toLowerCase();return""===a?S:S.filter(function(b){return b.name.toLowerCase().indexOf(a)>-1})},K),K.columnFilteredProps=ko.computed(function(){var a=K.columnPropertiesSearchFilter().toLowerCase();return""===a?T:T.filter(function(b){return b.name.toLowerCase().indexOf(a)>-1})},K),K.displayMainSpinner=ko.computed(function(){return K.activeDataRequest()&&2===K.currentTab()},K),K.displayChartSpinner=ko.computed(function(){return K.activeRequestForChart()},K),K.displayTabSpinner=ko.computed(function(){return K.activeDataRequest()},K),K.displayTabCheckmark=ko.computed(function(){return!K.reportResultViewed()&&!K.activeDataRequest()},K)};$(function(){window.location.href.match("pause")||applyBindings()});