"use strict";window.pointLookup=function(a,b,c){function d(a,b){var c,d,e,f="",g="",h=b.listManager,i=h.itemIndex,j=h.itemData._id,k=b.command+" point "+h.itemData.Name;a.err?f=["An error occurred when trying to ",k,": ",a.err].join(""):a.warning?(k=k.charAt(0).toUpperCase()+k.substring(1),g=[k," completed successfully with the following warning(s): ",a.warning].join("")):"success"!=a.message&&(f=["An unknown error occurred when trying to ",k,". Please try again."].join("")),h.$contextIcon.removeClass("busy fa-spinner fa-spin").addClass("edit fa-gear"),f.length?bannerJS.showBanner({msg:f,dismissText:"Dismiss",color:"#D50000",animatePage:!1}):(g.length&&bannerJS.showBanner({msg:g,dismissText:"Dismiss",color:"#FFA500",animatePage:!1}),void 0!==(c=h.segmentNumber)?(d=w.browse["data"+c],d()[i]._id===j&&(e=W["list"+c],e.jqxListBox("beginUpdate"),d.splice(i,1),e.jqxListBox("endUpdate"))):(d=w.grid.data,d()[i]._id===j&&(v.grid.beginUpdate(),d.splice(i,1),v.grid.endUpdate()))),delete V[b.reqID]}function e(a){var b={err:"Request timed out"};a.processing=!0,d(b,a)}function f(a){var b=a.command,c=a.data,d=a.qData,f={"delete":"deletePoint",destroy:"deletePoint",restore:"restorePoint"};d.reqID=c.reqID=c.upi,d.timeout=window.setTimeout(function(){e(d)},Z),V[c.upi]=d,U.emit(f[b],JSON.stringify(c))}function g(){function d(a){return b.computed(function(){var c,d,f,g=e.browse["data"+a](),i=e.selectedPointTypes(),j=[];switch(c=i.length?i:h.call(e),a){case 1:e.browse.filter2(""),e.browse.data2([]),W.list1.jqxListBox("clearSelection");case 2:e.browse.name2(""),e.browse.filter3(""),e.browse.data3([]),W.list2.jqxListBox("clearSelection");case 3:e.browse.name3(""),e.browse.filter4(""),e.browse.data4([]),W.list3.jqxListBox("clearSelection")}for(var k=0;k<g.length;k++)d=g[k],~d["_name"+a].indexOf(e.browse["filter"+a]().toLowerCase())&&(f=b.utils.arrayFirst(d.pointType,function(a){return!!~c.indexOf(a)}),f&&j.push(d));return j}).extend({rateLimit:{timeout:10,method:"notifyWhenChangesStop"}})}var e=this;this.widgetTheme="customArctic",this.showDeleted=b.observable(!1),this.showInactive=b.observable(!1),this.systemAdmin=b.observable(S.systemAdmin),this.availablePointTypes=b.observableArray(a.POINTTYPES),this.selectedPointTypes=b.observableArray([]),this.isFocused=b.observable(!0),this.selectedPointTypes.subscribe(function(b){var d,f,g,h={},i=e.grid,j=e.showDeleted(),l=e.showInactive();if("filter"==a.MODE&&1==E.jqxTabs("selectedItem"))for(g=1;g<5;g++)d="name"+g,w.reportFilter[d]("");for(h.showDeleted=!!j,h.showInactive=!!l,f=c.trim(i.name1.filter()),h.name1=f,g=2;g<5;g++)i["name"+g].filterOn()&&(f=c.trim(i["name"+g].filter()),h["name"+g]=f);h.pointTypes=b,N&&(N.abort(),clearTimeout(P),O.hide()),N=k(h).done(t)}),this.allPointTypes=b.computed({read:function(){var a=h.call(e).length,b=e.selectedPointTypes().length;return a==b},write:function(a){Q=!0,a?i("all"):D.jqxListBox("uncheckAll"),Q=!1,e.selectedPointTypes(m())}}),this.grid={name1:{filter:b.observable("")},name2:{filter:b.observable(""),filterOn:b.observable(!0)},name3:{filter:b.observable(""),filterOn:b.observable(!0)},name4:{filter:b.observable(""),filterOn:b.observable(!0)},toggleFilter:function(a,b){var d,f,g=b||!e.grid["name"+a].filterOn();if(d=function(a,b){var d=c("#segment"+a),f=d.find("i"),g=e.grid["name"+a];g.filterOn(b),b?(d.removeClass("btn-danger").addClass("btn-success"),f.removeClass("fa-ban").addClass("fa-filter")):(g.filter(""),d.removeClass("btn-success").addClass("btn-danger"),f.removeClass("fa-filter").addClass("fa-ban"))},g)for(f=a;f>1;f--)d(f,g);else for(f=a;f<5;f++)d(f,g)},data:b.observableArray([])},this.browse={filter1:b.observable(""),filter2:b.observable(""),filter3:b.observable(""),filter4:b.observable(""),name1:b.observable(""),name2:b.observable(""),name3:b.observable(""),name4:b.observable(""),data1:b.observableArray([]),data2:b.observableArray([]),data3:b.observableArray([]),data4:b.observableArray([])},this.reportFilter={name1:b.observable(""),name2:b.observable(""),name3:b.observable(""),name4:b.observable("")},this.clearSearch=function(a,b){var d=c(b.currentTarget),e=d.data("segment"),f=d.data("tab");"grid"===f?this.grid[e].filter(""):"browse"===f&&this.browse[e]("")},this.resetNavigator=function(){this.grid.name1.filter(""),this.grid.name2.filter(""),this.grid.name3.filter(""),this.grid.name4.filter(""),this.browse.filter1(""),this.browse.filter2(""),this.browse.filter3(""),this.browse.filter4(""),this.isFocused(!0)},"filter"==a.MODE&&b.computed(function(){for(var a,b={name1:e.reportFilter.name1(),pointTypes:e.selectedPointTypes()},c=4;c>1;c--)a=e.reportFilter["name"+c](),null!=a&&(b["name"+c]=a);x(b)}),this.browse.filteredData1=d(1),this.browse.filteredData2=d(2),this.browse.filteredData3=d(3),this.browse.filteredData4=d(4),"perm"!=a.MODE&&b.computed(function(){var d,f=e.grid,g=e.selectedPointTypes.peek(),h={},i=e.showDeleted(),j=e.showInactive(),l=b.computedContext.isInitial();if(i&&j)return!1;i&&(h.showDeleted=i),j&&(h.showInactive=j),d=c.trim(f.name1.filter()),"filter"==a.MODE&&e.reportFilter.name1(d),h.name1=d;for(var m=2;m<5;m++)f["name"+m].filterOn()?(d=c.trim(f["name"+m].filter()),"filter"==a.MODE&&e.reportFilter["name"+m](d),h["name"+m]=d):"filter"==a.MODE&&e.reportFilter["name"+m](null);h.pointTypes=g,l||(N&&(N.abort(),clearTimeout(P),O.hide()),N=k(h).done(t))}).extend({rateLimit:{timeout:300,method:"notifyWhenChangesStop"}}),b.computed(function(){e.selectedPointTypes(),e.browse.data1.valueHasMutated(),e.browse.name1(""),e.browse.filter2(""),e.browse.data2([]),e.browse.name2(""),e.browse.filter3(""),e.browse.data3([]),e.browse.name3(""),e.browse.filter4(""),e.browse.data4([]),W.list1.jqxListBox("clearSelection")}).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),b.computed(function(){var a=e.selectedPointTypes();$&&(0===a.length?s([],1):s(X,1))}).extend({rateLimit:{timeout:10,method:"notifyWhenChangesStop"}}),b.computed(function(){var a={},c=e.selectedPointTypes.peek(),d=e.showDeleted(),f=e.showInactive(),g=b.computedContext.isInitial();return(!d||!f)&&(a.showDeleted=!!d,a.showInactive=!!f,a.pointTypes=c,void(g||(K&&(K.abort(),clearTimeout(M),L.hide()),K=j(a).done(function(a){s(a,1)}))))}).extend({rateLimit:{timeout:10,method:"notifyWhenChangesStop"}}),b.computed(function(){var a=e.showDeleted(),b=e.showInactive.peek();a&&b&&e.showInactive(!1)}),b.computed(function(){var a=e.showDeleted.peek(),b=e.showInactive();a&&b&&e.showDeleted(!1)})}function h(){var a=this;return a.availablePointTypes().map(function(a){return a.key})}function i(b){"all"==b?a.checkPointTypes(h.call(w)):"none"==b&&D.jqxListBox("uncheckAll")}function j(b){return b=b||{},M=setTimeout(function(){p(),L.show()},100),b.pointTypes&&0===b.pointTypes.length?{done:function(a){a([])},abort:function(){}}:(a.DEVICEID&&(b.deviceId=a.DEVICEID),a.REMOTEUNITID&&(b.remoteUnitId=a.REMOTEUNITID),a.POINTTYPE&&(b.pointType=a.POINTTYPE),c.ajax({url:"/api/points/browse",dataType:"json",type:"post",data:b}))}function k(b){return b.pointTypes&&0!==b.pointTypes.length?(b=b||{},P=setTimeout(function(){O.show()},300),a.DEVICEID&&(b.deviceId=a.DEVICEID),a.REMOTEUNITID&&(b.remoteUnitId=a.REMOTEUNITID),a.POINTTYPE&&(b.pointType=a.POINTTYPE),c.ajax({url:"/api/points/search",dataType:"json",type:"post",data:b})):{done:function(a){a([])},abort:function(){}}}function l(a,b){var d,e,f,g,h={};if("folder"==a.type){for(e=w.selectedPointTypes.peek(),g=4;g;g--)d=c.trim(w.browse["name"+g]()),d&&(h["name"+g]=d,f||(f=g+1));return h.pointTypes=e,h.nameSegment=f,h.permissions=a,K&&(K.abort(),clearTimeout(M),L.hide()),K=j(h).done(function(a){s(a,f),W["list"+(f-1)].jqxListBox("selectIndex",b)})}return c.ajax({url:"/api/points/toggleGroup",dataType:"json",type:"post",data:{permissions:a}})}function m(){return n().map(function(a){return a.originalItem.key})}function n(){return D.jqxListBox("getCheckedItems")}function o(){var a,b=n();Q=!0,D.jqxListBox("refresh");for(var c=0,d=b.length;c<d;c++)D.jqxListBox("checkItem",b[c]);Q=!1,a=w.selectedPointTypes(),a.length=0,a.push.apply(a,m()),w.isFocused(!0)}function p(){W.list1.jqxListBox({disabled:!0}),W.list2.jqxListBox({disabled:!0}),W.list3.jqxListBox({disabled:!0}),W.list4.jqxListBox({disabled:!0})}function q(){W.list1.jqxListBox({disabled:!1}),W.list2.jqxListBox({disabled:!1}),W.list3.jqxListBox({disabled:!1}),W.list4.jqxListBox({disabled:!1})}function r(){function d(a){var b=[],c="Display"===a.pointType,d=S.systemAdmin||h(a.Security,Y.WRITE);return 0==a._pStatus?(b.push({label:"Open"}),d&&b.push.apply(b,[{label:"Clone"},{label:"Delete"}])):1==a._pStatus?S.systemAdmin&&b.push({label:"Delete"}):2==a._pStatus&&(c||b.push({label:"Open"}),d&&b.push.apply(b,[{label:"Restore"},{label:"Destroy"}])),"Slide Show"==a.pointType&&b.push({label:"Edit"}),b.push({label:"Close"}),b}function e(b,c,e,f,g,h){var i=v.grid.records[b];return"nav"!=a.MODE?"":V[i._id]?'<span class="busy fa fa-spin fa-spinner"></span>':(i.menuItems=d(i),'<span class="edit fa fa-gear"></span>')}function g(b){return function(d){var e,f,g,h,i,k,m,n,o,p,q,r,t,u=d.args,v={},y=w.availablePointTypes(),A=b+1,B=w.showDeleted(),C=w.showInactive();if(u&&u.originalEvent){if(e=c(u.originalEvent.target),f=e.offset(),h=u.index,m=w.browse["filteredData"+b]()[h],i=u.item,"filter"==a.MODE){switch(b){case 1:w.reportFilter.name2("");case 2:w.reportFilter.name3("");case 3:w.reportFilter.name4("")}p=m["name"+b],w.reportFilter["name"+b](p),w.browse["name"+b](p)}if(m.isPoint){if(n=m.Name,o=m.pointType[0],q=T.config.Utility.pointTypes.getUIEndpoint(o,m._id),e.is("span.edit"))return void(m.menuItems&&(window.focus(),I.jqxMenu({source:m.menuItems}),I.jqxMenu("open",f.left-I.width()/2-10,f.top-7),I.data({listManager:{$contextIcon:e,$itemElement:c(i.element),segmentNumber:b,itemData:m,itemIndex:i.index,item:i}})));if(e.is("span.perm")){for(t=m.Security.indexOf(z),r={type:"point",action:~t?"remove":"add",groupid:z},g=1;g<b;g++)k=c.trim(w.browse["name"+g]()),r["name"+g]=k;return r["name"+b]=m["name"+b],void l(r).done(function(a){a.err||(~t?m.Security.splice(t,1):m.Security.push(z),W["list"+b].jqxListBox("invalidate"))})}switch(I.jqxMenu("close"),b){case 1:w.browse.name2(""),w.browse.filter2(""),w.browse.data2([]);case 2:w.browse.name3(""),w.browse.filter3(""),w.browse.data3([]);case 3:w.browse.name4(""),w.browse.filter4(""),w.browse.data4([])}switch(W["list"+b].jqxListBox("unselectItem",i),a.MODE){case"select":x(m._id,n),window.close();break;case"perm":case"filter":return;default:T.openWindowPositioned(q.review.url,n,o,q.review.target,m._id,{width:1250,height:750})}}else{switch(I.jqxMenu("close"),w.browse["name"+b](i.label),b){case 1:w.browse.name2(""),w.browse.filter2(""),w.browse.data3([]);case 2:w.browse.name3(""),w.browse.filter3(""),w.browse.data4([]);case 3:w.browse.name4(""),w.browse.filter4("")}if(""==c.trim(i.label))return W["list"+A].jqxListBox("clearSelection");if(e.is("span.perm"))return void(m.menuItems&&(window.focus(),I.jqxMenu({source:m.menuItems}),I.jqxMenu("open",f.left-I.width()/2-10,f.top-7),I.data({listManager:{segmentNumber:b,item:i,itemData:m}})));for(B&&(v.showDeleted=B),C&&(v.showInactive=C),g=1;g<A;g++)k=c.trim(w.browse["name"+g]()),v["name"+g]=k;v.nameSegment=A,v.pointTypes=y.map(function(a){return a.key}),K&&(K.abort(),clearTimeout(M),L.hide()),K=j(v).done(function(a){s(a,A)})}}}}function h(a,b){for(var c=0,d=S.groups.filter(function(b){return!!~a.indexOf(b._id)}),e=0,f=d.length;e<f;e++)c|=d[e]._pAccess;return!!(c&b)}"perm"==a.MODE&&c(".permTitle").html(A),v={pointType:new c.jqx.dataAdapter({localdata:w.availablePointTypes,dataType:"observablearray"}),grid:new c.jqx.dataAdapter({localdata:w.grid.data,dataType:"observablearray"})},S.systemAdmin&&c(".showInactive").css("display","inline-block"),"filter"==a.MODE&&(B.css("padding-bottom","50px"),c(".reportFilter").show()),C.jqxSplitter({height:"100%",width:"100%",panels:[{min:150,size:200},{min:700,collapsible:!1}],splitBarSize:3,theme:w.widgetTheme}),D.jqxListBox({source:v.pointType,height:"100%",width:"100%",displayMember:"key",valueMember:"enum",itemHeight:20,checkboxes:!0,equalItemsWidth:!0,theme:w.widgetTheme}),D.on("checkChange",function(a){var b=!1,c=a.args.originalEvent,d=w.selectedPointTypes();Q||(w.selectedPointTypes(m()),c&&(c.which?b=3==c.which:c.button&&(b=2==c.button),1==b&&(1==d.length&&d[0]===a.args.label?(Q=!0,i("all"),Q=!1):(D.jqxListBox("uncheckAll"),D.jqxListBox("checkItem",a.args.item)))))}),w.allPointTypes(!0),c("#pointTypeColumn").on("contextmenu",function(){return!1}),E.jqxTabs({width:"100%",height:"100%",position:"top",autoHeight:!0,theme:w.widgetTheme}),"perm"==a.MODE&&E.jqxTabs("removeAt",0),E.on("selected",function(b){var c,d,e=b.args.item;if(0==e&&(G.find("input:first").focus(),"filter"==a.MODE))for(c=1;c<5;c++)d="name"+c,w.reportFilter[d](w.grid[d].filter());if(1==e){for(var f=4;f;f--)setTimeout(function(a){W["list"+a].jqxListBox("refresh")}(f),10);if(H.find("input:first").focus(),"filter"==a.MODE)for(c=1;c<5;c++)d="name"+c,w.reportFilter[d](w.browse[d]())}}),O=c(".searchBusy"),L=c(".browseBusy"),F.jqxGrid({source:v.grid,width:"100%",height:"100%",selectionmode:"filter"==a.MODE?"none":"singlerow",scrollmode:"logical",altrows:!1,showheader:!0,columns:[{text:"Segment 1",datafield:"name1"},{text:"Segment 2",datafield:"name2"},{text:"Segment 3",datafield:"name3"},{text:"Segment 4",datafield:"name4"},{text:"Type",datafield:"pointType",width:150},{text:"",datafield:"control",width:20,cellsrenderer:e,hidden:!0}],theme:w.widgetTheme}),F.on("initialized",function(b){"nav"==a.MODE&&F.jqxGrid("setcolumnproperty","control","hidden",!1)}),F.on("rowclick",function(b){if("filter"!=a.MODE){var d=b.args,e=(d.item,v.grid.records[d.rowindex]),f=c(d.originalEvent.target),g=f.offset(),h=[e.name1,e.name2,e.name3,e.name4].filter(function(a){return a}).join("_"),i=e.pointType,j=T.config.Utility.pointTypes.getUIEndpoint(i,e._id),k="Display"===e.pointType&&2===e._pStatus;if(e.Name=h,f.is("span.edit"))return void(e.menuItems&&(window.focus(),I.jqxMenu({source:e.menuItems}),I.jqxMenu("open",g.left-I.width()/2-10,g.top-7),I.data({listManager:{$contextIcon:f,$itemElement:c("#row"+e.uid+"jqxgrid"),itemData:e,itemIndex:e.uid}}),F.jqxGrid({selectedrowindex:d.rowindex})));if(setTimeout(function(){F.jqxGrid({selectedrowindex:-1})},1),"select"==a.MODE){if(y){var l=1;F.parent().parent().find(".toolbar").find(".searchInput").each(function(){y["filter"+l++]=c(this).val()}),y.name1=e.name1,y.name2=e.name2,y.name3=e.name3,y.name4=e.name4,y.pointType=e.pointType,y.selectedPointTypes=window.pointLookup.getCheckedPointTypes()}x(e._id,h,i,y),window.close()}else k||T.openWindowPositioned(j.review.url,h,i,j.review.target,e._id,{width:1250,height:750})}}),w.browseListRender=function(b){return function(c){var e,f,g,i=w.browse["filteredData"+b]()[c];if(i)return e=i.name4||i.name3||i.name2||i.name1,f=[],g=S.systemAdmin||h(i.Security,Y.WRITE),i.menuItems=[],i.isPoint?("nav"==a.MODE&&g&&(V[i._id]?f.push('<span class="busy fa fa-spin fa-spinner"></span>'):f.push('<span class="edit fa fa-gear"></span>')),f.push.apply(f,['<img title="',i.pointType,'" src="/img/pointtypes/',i.pointType,'.png" height="16" width="16" /> ',e]),"perm"==a.MODE&&S.systemAdmin&&(~i.Security.indexOf(z)?f.push('<span class="perm fa fa-check-square"></span>'):f.push('<span class="perm fa fa-square-o"></span>')),i.menuItems=d(i)):(f.push.apply(f,['<i class="glyphicon glyphicon-folder-close"></i> ',e]),"perm"==a.MODE&&S.systemAdmin&&(f.push('<span class="perm fa fa-sort-amount-asc"></span>'),i.menuItems.push({label:"Add all"}),i.menuItems.push({label:"Remove all"}))),f.join("")}},W.list1.on("select",g(1)),W.list2.on("select",g(2)),W.list3.on("select",g(3)),W.list4.on("select",g(4)),I.jqxMenu({source:[],autoOpenPopup:!1,mode:"popup",animationShowDuration:0,animationHideDuration:0,autoCloseOnClick:!1}),I.on("closed",function(){var a=c(this).data("listManager");a&&(a.segmentNumber?W["list"+a.segmentNumber].jqxListBox("unselectItem",a.item):F.jqxGrid({selectedrowindex:-1}))}),I.on("mouseleave",function(a,b){}),I.on("itemclick",function(a){var b,d,e,g,i,j,k,m,n,o,p=c(this).data("listManager"),q=c(a.args).text(),r=q.toLowerCase();if(p){switch(b=p.itemData._id,i=p.segmentNumber,j=p.itemData,d=j.Name,e=j.pointType instanceof Array?j.pointType[0]:j.pointType,g=T.config.Utility.pointTypes.getUIEndpoint(e,j._id),n=S.systemAdmin||h(j.Security,Y.WRITE),r){case"open":T.openWindowPositioned(g.review.url,d,e,g.review.target,b,{width:1250,height:750});break;case"clone":T.openWindowPositioned("/api/points/newPoint/"+b,"New Point","","","newPoint",{width:960,height:560});break;case"edit":T.openWindowPositioned(g.edit.url,d,e,g.edit.target,b,{width:1250,height:750});break;case"delete":case"destroy":if(!n)return;if(0!==j._parentUpi){var s=T.config.Utility.pointTypes.getUIEndpoint("Sequence",j._parentUpi),t='<a href="javascript: void(0)" onclick="workspaceManager.openWindowPositioned(\''+s.review.url+"', '', 'Sequence', '"+s.review.target+"', "+j._parentUpi+', {width: 1250,height: 750});">Sequence</a>',u="<h4>This point cannot be deleted here. It must be deleted from the "+t+"</h4>";return void T.showConfirmation({message:u})}if(V[b])return void bannerJS.showBanner({msg:["This action cannot be completed at this time. A",V[b].command,"is already in progress."].join(" "),dismissText:"Dismiss",animatePage:!1});T.showConfirmation({message:"<h4>Are you sure you want to "+r+" this point?</h4>",okText:q,okClass:"btn-danger",callback:function(a){if(0!=a&&(p.$contextIcon.removeClass("edit fa-gear").addClass("busy fa-spinner fa-spin"),f({command:r,data:{upi:b,method:0===j._pStatus?"soft":"hard"},qData:{command:r,listManager:p}}),void 0!==p.segmentNumber)){var c=W["list"+p.segmentNumber];c.jqxListBox("render"),c.jqxListBox("refresh")}}});break;case"restore":if(!n)return;if(V[b])return void bannerJS.showBanner({msg:["This action cannot be completed at this time. A",V[b].command,"is already in progress."].join(" "),dismissText:"Dismiss",animatePage:!1});T.showConfirmation({message:"<h4>Are you sure you want to restore this point?</h4>",okText:"Restore",okClass:"btn-success",callback:function(a){if(0!=a&&(p.$contextIcon.removeClass("edit fa-gear").addClass("busy fa-spinner fa-spin"),f({command:r,data:{upi:b},qData:{command:r,listManager:p}}),void 0!==p.segmentNumber)){var c=W["list"+p.segmentNumber];c.jqxListBox("render"),c.jqxListBox("refresh")}}});break;case"add all":for(m={type:"folder",action:"add",groupid:z},o=1;o<i+1;o++)k=c.trim(w.browse["name"+o]()),k&&(m["name"+o]=k);l(m,p.item.index);break;case"remove all":for(m={type:"folder",action:"remove",groupid:z},o=1;o<i+1;o++)k=c.trim(w.browse["name"+o]()),k&&(m["name"+o]=k);l(m,p.item.index);case"close":I.jqxMenu("close")}I.jqxMenu("close")}}),J.on("click",function(){var a,b="",c=n();1===c.length&&(b=window.encodeURI(c[0].originalItem.key)),a=T.openWindowPositioned("/api/points/newPoint/?selectedPointType="+b,"New Point","","","newPoint",{width:960,height:560})}),b.applyBindings(w)}function s(a,b){w.browse["data"+b](a),clearTimeout(M),q(),L.hide()}function t(a){clearTimeout(P),v.grid.beginUpdate(),w.grid.data(a),v.grid.endUpdate(),O.hide()}function u(){for(var b,c=4;c;c--)b=y["name"+c],"undefined"!=typeof b?(w.grid.toggleFilter(c,!0),w.reportFilter["name"+c](b),w.grid["name"+c].filter(b)):(w.grid.toggleFilter(c,!1),w.grid["name"+c].filterOn(!1));0==y.pointTypes.length?w.allPointTypes(!0):a.checkPointTypes(y.pointTypes)}var v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T=(window.opener||window.top).workspaceManager,U=T.socket(),V={},W={},X=[],Y={CONTROL:2,ACKNOWLEDGE:4,WRITE:8},Z=1e4,$=!1;return b.bindingHandlers.tooltip={init:function(a,d){c(a).tooltip({title:b.unwrap(d())})}},U.on("pointUpdated",function(a){var b;if("string"==typeof a){if(a=JSON.parse(a),b=V[a.reqID],!b||b.processing)return;window.clearTimeout(b.timeout),d(a,b)}}),a.refreshUI=function(){o()},a.getCheckedPointTypes=function(){return m()},a.checkPointTypes=function(a){var b,c=D.jqxListBox("getItems");if(Q=!0,"all"!==a[0]){D.jqxListBox("uncheckAll");for(var d=0,e=c.length;d<e;d++){b=c[d];for(var f=0,g=a.length;f<g;f++)b.label.toLowerCase()==a[f].toLowerCase()&&D.jqxListBox("checkItem",b)}}else D.jqxListBox("checkAll");Q=!1,w.selectedPointTypes(m())},a.init=function(b,d){var e;return x=b,y=d,$&&"filter"==a.MODE?void u():(C=c("#splitter"),T||(C.hide(),alert("The Infoscan Point Navigator cannot be opened directly. You will now be redirected to the workspace."),window.location.replace("/")),R=T.user(),S={systemAdmin:R["System Admin"].Value,groups:R.groups},B=c("body"),G=c("#listSearch"),H=c("#millerBrowse"),D=c("#pointTypes"),E=c("#jqxtabs"),F=c("#jqxgrid"),O=c(".searchBusy"),L=c(".browseBusy"),W.list1=c("#browseList1"),W.list2=c("#browseList2"),W.list3=c("#browseList3"),W.list4=c("#browseList4"),I=c(".contextMenu"),J=c(".newPointBtn"),w=new g,e={pointTypes:w.availablePointTypes().map(function(a){return a.key})},K=j(e).done(function(a){X=a,s(a,1)}),"perm"==a.MODE?(H.find("input:first").focus(),z=d.groupid,A=d.groupname):G.find("input:first").focus(),r(),"filter"==a.MODE&&u(),"nav"!=a.MODE&&c(".actionGroup *:not(.resetNavBtn)").hide(),y&&(w.grid.name1.filter(y.name1),w.grid.name2.filter(y.name2),w.grid.name3.filter(y.name3),w.grid.name4.filter(y.name4),y.selectedPointTypes&&y.selectedPointTypes.length>0&&a.checkPointTypes(y.selectedPointTypes)),$=!0,void bannerJS.init())},c(function(){window.onbeforeunload=function(){window.close()}}),a}(window.pointLookup||{},ko,jQuery);