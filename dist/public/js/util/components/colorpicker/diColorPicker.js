var listOfCustomColorCodes=[];!function(){var a=function(a){listOfCustomColorCodes=a};$.getJSON("/api/system/getCustomColors",a)}();var CustomColorsPicker=function(a,b,c,d){var e,f,g,h,i,j,k=this,l="colorPickerHandlerDiv",m=function(a){function b(a){var b=a.toString(16);return 1===b.length?"0"+b:b}function c(a,c,d){return"#"+b(a)+b(c)+b(d)}var d,e,f,g,h;return"#"===a.substr(0,1)?a:(d=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(a),e=parseInt(d[2]),g=parseInt(d[3]),f=parseInt(d[4]),h=c(e,g,f),d[1]+h)},n=function(){for(var a,b,c=0,d=listOfCustomColorCodes.length,e=parseInt(d/2,10),f=listOfCustomColorCodes.slice(0,e),g=listOfCustomColorCodes.slice(e),h=[];c<f.length||c<g.length;)a=f[c]?f[c]:[],b=g[c]?g[c]:[],h.push([a,b]),c++;return h},o=function(){var a,b=n(),c=b.length,d=[];for(a=0;a<c;a++)d.push(b[a][0]?b[a][0]:""),d.push(b[a][1]?b[a][1]:"");return d},p=function(a){a.off(),a.on("colorchange",function(a){b&&($.isFunction(b)?b(a.args.color.hex):b instanceof Object&&(b[d]=a.args.color.hex)),e&&e.jqxDropDownButton("setContent",r(a.args.color))}),g&&a.on("keyup",function(a){var b=a.keyCode?a.keyCode:a.which;13===b&&e&&e.jqxDropDownButton("close")})},q=function(a,b){a.css("background-image",""),a.css("opacity","1"),a.css("background","#"+b),a.click(function(a){var b,c=$(this).parent().parent().parent(),d=$(this).css("background-color"),e=m(d);$(this).parent().parent().find("div").removeClass("selected"),$(this).addClass("selected"),b=g?c.find(".jqx-color-picker"):c,b.jqxColorPicker("setColor",e)})},r=function(a){if("transparent"===a||""===a.hex)return $("<div style='text-shadow: none; position: relative; padding-bottom: 2px; margin-top: 2px;'>transparent</div>");var b=$("<div style='text-shadow: none; position: relative; padding-bottom: 2px; margin-top: 2px;'>#"+a.hex+"</div>"),c=105,d=.299*a.r+.587*a.g+.114*a.b,e=255-d<c?"Black":"White";return b.css("color",e),b.css("background","#"+a.hex),b.addClass("jqx-rc-all"),b},s=function(a){a&&(a.jqxDropDownButton({width:130,height:22}),a.jqxDropDownButton("setContent",r(new $.jqx.color({hex:c}))))},t=function(a,b,c){var d,e,f,h,i,j=c?a.width()+100:a.width(),k=c?a.height():a.height()+90,l=b?"sm-":"",m=b?"sm-":"",n=c?o():listOfCustomColorCodes;for(a.append("<br>"),l+=c?"vertical-":"",l+="customColors",m+="colorSwatch",e=$("<ul>",{"class":l}),a.append(e),d=0;d<n.length;d++)i="customColor_"+d,f=$("\n<li>\n"),e.append(f),h=$("<div>",{"class":m,id:i}),f.append(h),h.attr("index",d),q(h,n[d]);g&&(a.width(j),a.height(k))},u=function(){var b,d,k=a.parent();a.empty(),f=a.data("insertpalette")||!1,g=a.data("usedropdown")||!1,h=a.data("sm-palette")||!1,i=a.data("vertical")||!1,b=h?180:255,d=h?160:215,j=$("<div>",{"class":l}),a.append(j),j.jqxColorPicker({colorMode:"hue",color:c,width:b,height:d}),f&&g?(e=k,t(e,h,i)):f&&!g?t(j,h,i):g&&(e=k),s(e),p(j)};c.match("#")&&(c=c.substring(1)),k.render=function(){listOfCustomColorCodes.length>0?u():setTimeout(function(){u()},100)},k.updateColor=function(a){j.jqxColorPicker("setColor","#"+a)}};"undefined"!=typeof ko&&ko.bindingHandlers&&!ko.bindingHandlers.diColorpicker&&(ko.bindingHandlers.diColorpicker={init:function(a,b,c,d,e){var f,g=b(),h=ko.unwrap(g),i=$(a);g&&h&&(f=new CustomColorsPicker(i,g,h),f.render(),g.subscribe(function(a){f.updateColor(a)}))}});