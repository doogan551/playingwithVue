"use strict";var diFileBrowser=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=this,r=!1,s=null,t=[],u=[],v=[],w=function(){h.children().remove(),h.html("Files: 0"),h.append($("<img>",{id:"spinner",src:"/css/lib/jqwidgets/images/loader.gif",style:"display: block; position: relative; top: 50%; left: 50%; padding: 2px; width: 46px; height: 46px;"}))},x=function(){b.append($("<div>",{"class":"difilemanagerheader"})),c=b.find(".difilemanagerheader"),c.append($("<div>",{"class":"difilemanagertitle",text:"Select Image"})),g=c.find(".difilemanagertitle"),c.append($("<div>",{"class":"difilecounter"})),c.append($("<div>",{"class":"difilesearch"})),n=b.find(".difilesearch"),n.append($("<input>",{type:"search","class":"ui-input-text ui-body-c",placeholder:"Find a file.."})),p=b.find("input[type=search]"),h=b.find(".difilecounter")},y=function(){d.append($("<div>",{"class":"diimagedetails"})),f=b.find(".diimagedetails"),f.append($("<div>",{"class":"filename"})),f.append($("<div>",{"class":"filedate"})),f.append($("<div>",{"class":"filesize"})),f.append($("<img>",{"class":"rightimage"}))},z=function(){d.append($("<div>",{"class":"difilelist thinScroll"})),k=b.find(".difilelist")},A=function(){k.append($("<ul>",{"class":"difiles"})),l=b.find(".difiles")},B=function(){b.append($("<img>",{"class":"offscreenimage"})),e=b.find(".offscreenimage")},C=function(){b.append($("<div>",{"class":"dinothingfound"})),m=b.find(".dinothingfound"),m.append($("<div>",{"class":"dinofiles"})),m.append($("<span>",{text:"No files found."}))},D=function(){x(),b.append($("<div>",{"class":"diimagebrowsingdata"})),d=b.find(".diimagebrowsingdata"),d.css("display","none"),y()};q.init=function(c,e,f){q.selectedFileName="",a=$("#diFileBrowserPopup"),r?(w(),d.hide(),k.hide()):a.append($("<div>",{id:"difilemanager","class":"difilemanager",style:"display: none;"})),setTimeout(function(){b=a.find(".difilemanager"),b.hide(),b.show(),r?k.children().remove():(D(),z(),B(),C(),w()),A(),i=b.find(".filebrowserok"),j=b.find(".filebrowsercancel"),s=null,o="",p.val(""),q.displayObject=c,q.displayField=e,q.typeOfImage=f,n.css("display","none"),r=!0,q.getData()},1)},q.displayNextGroup=function(a,b){var c=b+100;$(".file").each(function(){var a,b,d,e,f,g;return e=$(this),d=e.parent(),a=d.offset(),f=e.find(".smallimage"),g=e.find(".filedetail"),b=a.top,b>0&&b<c&&(e.removeClass("files"),e.addClass("filesloaded"),d.addClass("expanditem"),f.attr("src",f.attr("datasrc")),f.addClass("smallimageloaded"),f.removeClass("smallimage"),g.css("margin-top","1px"),void 0)})},q.clearImageDetail=function(){var a=f.find(".rightimage"),b=f.find(".filename"),c=f.find(".filedate"),d=f.find(".filesize");a.length>0&&(a.css("display","none"),b.css("display","none"),c.css("display","none"),d.css("display","none"))},q.renderServerImageFiles=function(a){setTimeout(function(){function c(a){var b="";d.css("display","none"),a&&a.length>0?(b=g(t,a),x(b)):(b=g(t),x(b))}function g(a,b){var c,d,e,f,g=a.files,h=!1,i=!1;return v=[],q.clearImageDetail(),g.length&&(g.forEach(function(a){c=a.file.filename.toLowerCase(),d=c.split("."),e=d[d.length-1],h=void 0===b||c.match(b),i=void 0===q.typeOfImage||("*"===q.typeOfImage||e===q.typeOfImage),h&&i&&v.push(a)}),f={folders:u,files:v,path:a.path}),f}function r(){b.find(".file").click(function(){var a=$(this),b=a.parent(),c=a.find(".smallimage"),d=a.find(".filename"),g=a.find(".filedate"),h=a.find(".filesize"),i=f.find(".rightimage"),j=f.find(".filename"),k=f.find(".filedate"),m=f.find(".filesize");l.find(".selectedFile").each(function(){$(this).removeClass("selectedFile")}),b.addClass("selectedFile"),e.attr("src",c.attr("datasrc")),e.attr("filename",d.text()),i.attr("src",c.attr("datasrc")),j.text(d.text()),k.text(g.text()),m.text(h.text()),f.css("display","block"),i.css("display","block"),j.css("display","block"),k.css("display","block"),m.css("display","block"),q.selectedFileName=d.text()})}function w(){n.css("display","block"),d.css("display","block"),l.css("display","block"),f.css("display","block"),k.css("display","block"),i.css("display","block"),i.removeClass("ui-shadow"),j.css("display","block"),j.removeClass("ui-shadow"),l.scrollTop()}function x(a){var b=a.folders,c=a.files,e=a.path;if(q.selectedFileName="",d.css("display","none"),l.empty().hide(),b.length||c.length?(m.hide(),h.show()):(m.css("display","block"),f.css("display","none"),k.css("display","none"),h.hide()),c.length){var g=[];h.html("Files: "+c.length),c.forEach(function(a){var b=encodeURI(a.file.filename),c=a.file.filesize,d=new Date(a.file.modifieddate),f="<img class='smallimage' datasrc='"+e+b+"' src=''></img>",h="<br/>",i="<div class='filename' >"+decodeURI(b)+"</div>",j="<div class='filedate' >"+d.toLocaleString()+"</div>",k="<div class='filesize' >"+y(c)+"</div>",l="<div class='filedetail'> "+i+j+k+"</div>",m="<div class='file' >"+f+h+l+"</div>",n="<li>"+m+"</li>";g.push(n)}),l.append(g.join("")),w()}r()}function y(a){var b=["Bytes","KB","MB","GB","TB"];if(0==a)return"0 Bytes";var c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return Math.round(a/Math.pow(1024,c),2)+" "+b[c]}t=a,o="",u=[],v=[],e.on("load",function(){var a=f.find(".rightimage");e.width()+20<f.width()?a.css("width",e.width()):a.css("width","95%"),e.height()+20<f.height()?a.css("height",e.height()):a.css("height","87%")}),n.click(function(a){p.show().focus()}),p.bind("input",function(a){u=[],v=[],0===p.val().trim().length?(p.parent().find("span").show(),p.blur(),c()):(null!==s&&clearTimeout(s),s=setTimeout(function(){c(p.val())},200),27===a.keyCode&&p.trigger("blur"))}),c()},1)},q.getData=function(){t&&t.files&&t.files.length>0?q.renderServerImageFiles(t):$.ajax({url:"/displays/listassets",method:"GET",contentType:"application/json",dataType:"json"}).done(function(a){q.renderServerImageFiles([a][0])})}};