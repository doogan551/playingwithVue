"use strict";function applyBindings(){var a;void 0===window.opener?window.setTimeout(applyBindings,2):(a=new slideShowViewModel,a.init(),ko.applyBindings(a))}window.workspaceManager=(window.opener||window.top).workspaceManager;var slideShowViewModel=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=this,o=window.workspaceManager,p=o.user(),q=3,r=0,s=!1,t=0,u=function(a,b){a.width("100%"),a.height("100%"),a.parent().addClass(b),a.load(function(){v(a)})},v=function(a){a.contents().find(".topBar").hide()},w=function(){var a=window.screen.height,b=window.screen.width,c=window.innerHeight,d=window.innerWidth;s=!0,n.inFullScreenMode(b===d&&a===c)},x=function(a){function b(a,b){return a.order<b.order?-1:a.order>b.order?1:0}function c(b){var c,d,e=!1,f=a["Point Refs"].length;for(c=0;c<f;c++)if(d=a["Point Refs"][c],d.Value===b){e=!0,0===d.PointInst&&(e=!1);break}return e}var d,e,f,g,h=a.Slides.length;for(j=a["Maximize Displays"].Value,k=a["Close On Complete"].Value,l=a["Repeat Count"].Value,m=a["Continuous Show"].Value,d=0;d<h;d++)f=a.Slides[d],f&&(e=f.display,c(e)?(g=o.config.Utility.pointTypes.getUIEndpoint("Display",e),f.displayURL=g.review.url,f.duration<q&&(f.duration=q)):(a.Slides.splice(d,1),d--));n.numberOfSlides=a.Slides.length,n.listOfSlides.push.apply(n.listOfSlides,a.Slides),n.listOfSlides.sort(b),j&&n.setFullScreen(),n.play()},y=function(){return window.location.hash.toString().replace("#","")},z=function(){return(h-((new Date).getTime()-i)/1e3).toFixed()},A=function(){clearTimeout(b),b=setInterval(function(){n.timeRemaining(z())},500)},B=function(){return n.slideIndex+1<n.numberOfSlides?n.slideIndex+1:0},C=function(){return n.slideIndex>0?n.slideIndex-1:n.numberOfSlides-1},D=function(){return n.slideIndex===n.slideLastIndex},E=function(){return n.slideIndex>n.slideLastIndex&&!(n.slideIndex===n.numberOfSlides-1&&0===n.slideLastIndex)||0===n.slideIndex&&n.slideLastIndex===n.numberOfSlides-1},F=function(){return n.slideIndex<n.slideLastIndex&&!(0===n.slideIndex&&n.slideLastIndex===n.numberOfSlides-1)||n.slideIndex===n.numberOfSlides-1&&0===n.slideLastIndex},G=function(a){D()||(E()?(a.parentElement.classList.add("nextframe"),a.setAttribute("src",n.nextSlide().displayURL)):F()&&(a.parentElement.classList.add("previousframe"),a.setAttribute("src",n.previousSlide().displayURL))),r=1500},H=function(a){var b=n.currentSlide().duration+a;return void 0===c.attr("src")?(r=1500,c.attr("src",n.previousSlide().displayURL),d.attr("src",n.currentSlide().displayURL),e.attr("src",n.nextSlide().displayURL)):(r=0,$("iframe").each(function(a,b){var c=b.getAttribute("src");switch(b.parentElement.classList.remove("previousframe","currentframe","nextframe"),c){case n.previousSlide().displayURL:b.parentElement.classList.add("previousframe"),s&&b.setAttribute("src",n.previousSlide().displayURL);break;case n.currentSlide().displayURL:b.parentElement.classList.add("currentframe"),s&&b.setAttribute("src",n.currentSlide().displayURL);break;case n.nextSlide().displayURL:b.parentElement.classList.add("nextframe"),s&&b.setAttribute("src",n.nextSlide().displayURL);break;default:G(b)}})),s=!1,i=(new Date).getTime(),n.timeRemaining(b),A(),setTimeout(function(){n.canSkip(!0)},r),b},I=function(){var a,b=parseInt(void 0===n.currentSlide()?3:0);return n.previousSlide(n.listOfSlides()[C()]),n.currentSlide(n.listOfSlides()[n.slideIndex]),n.nextSlide(n.listOfSlides()[B()]),a=H(b)};n.numberOfSlides=0,n.slideIndex=0,n.slideLastIndex=0,n.pageTitle=ko.observable("SlideShow"),n.inFullScreenMode=ko.observable(!1),n.listOfSlides=ko.observableArray([]),n.previousSlide=ko.observable(),n.currentSlide=ko.observable(),n.nextSlide=ko.observable(),n.isPaused=ko.observable(!1),n.timeRemaining=ko.observable(0),n.canSkip=ko.observable(!1),n.init=function(){n.getSlideShowData(),n.setNonFullScreen(),$(document.body).width("100%"),$(document.body).height("100%"),$(document.body.parentElement).height("100%"),g=$(".slideShowNavbar"),f=$(".diconfig"),c=$(".frame1"),u(c,"previousframe"),d=$(".frame2"),u(d,"currentframe"),e=$(".frame3"),u(e,"nextframe"),f.dblclick(function(){g.toggleClass("lockedopen")}),$(window).on("resize",function(){w()})},n.getSlideShowData=function(){var a,b="/api/points/"+y(),c={};c.reqID=(new Date).getTime(),c.user={},a=c.user,a["System Admin"]=p["System Admin"],a._id=p._id,a.groups=p.groups,$.ajax({url:b,type:"get",contentType:"application/json",dataType:"json",data:JSON.stringify(c),success:function(a){return x(a)}})},n.moveCarouselForward=function(){n.canSkip()&&(n.canSkip(!1),n.slideLastIndex=n.slideIndex,n.slideIndex=B(),clearTimeout(a),n.play())},n.moveCarouselBackward=function(){n.canSkip()&&(n.canSkip(!1),n.slideLastIndex=n.slideIndex,n.slideIndex=C(),clearTimeout(a),n.play())},n.play=function(){n.numberOfSlides>0&&(!m&&t>=l?k?n.close():n.pause():(n.isPaused()?(n.isPaused(!1),i=(new Date).getTime(),A()):h=I(),a=setTimeout(function(){n.slideLastIndex=n.slideIndex,n.slideIndex=B(),0!==n.slideIndex||m||t++,n.play()},1e3*h)))},n.pause=function(){h=n.timeRemaining(),clearTimeout(a),clearTimeout(b),n.isPaused(!0)},n.setFullScreen=function(){screenfull.enabled&&screenfull.request()},n.setNonFullScreen=function(){var a=.9*screen.width,b=.9*screen.height;window.moveTo(.05*screen.width,.05*screen.height),window.resizeTo(a,b),screenfull.exit()},n.close=function(){window.close()}};$(function(){applyBindings()});