function clone(a){function b(a,b,c){var d,e,f={};for(d in b)e=b[d],d in a&&(a[d]===e||d in f&&f[d]===e)||(a[d]=c?c(e):e);return a}if(!a||"object"!=typeof a||"[object Function]"===Object.prototype.toString.call(a))return a;if(a.nodeType&&"cloneNode"in a)return a.cloneNode(!0);if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return new RegExp(a);var c,d,e;if(a instanceof Array)for(c=[],d=0,e=a.length;d<e;++d)d in a&&c.push(clone(a[d]));else c=a.constructor?new a.constructor:{};return b(c,a,clone)}function isJson(a){try{JSON.parse(a)}catch(b){return!1}return!0}var myViewModel=function(){var a={},b=[],c=0,d="{}",e=!1,f=function(a){for(var c=0;c<b.length;c++)if(b[c]._id===a)return{entry:b[c],index:c};return null},g=function(a){b.push(clone(a))},h=function(a){b.splice(a,1)},i=function(b,c,d,e){var f,g,h=(new Date).toString("hh:mm:ss");for(f in d)if(g=void 0===e?f:e+"."+f,c.hasOwnProperty(f)===!1)a.diff.unshift({time:h,name:b,key:g,report:"Added to point"});else if("object"==typeof d[f]&&null!==d[f])i(b,c[f],d[f],g);else if(c[f]!==d[f]){var j="_pollTime"===g||"Last Report Time.Value"===g?new Date(1e3*parseInt(c[f],10)).toString("hh:mm:ss"):c[f],k="_pollTime"===g||"Last Report Time.Value"===g?new Date(1e3*parseInt(d[f],10)).toString("hh:mm:ss"):d[f],l="Changed from "+j+" to "+k;a.diff.unshift({time:h,name:b,key:g,report:l})}},j=function(b,c,d,e){var f,g,h=(new Date).toString("hh:mm:ss");for(f in c)g=void 0===e?f:e+"."+f,d.hasOwnProperty(f)===!1?a.diff.unshift({time:h,name:b,key:g,report:"Removed from point"}):"object"==typeof c[f]&&null!==c[f]&&j(b,c[f],d[f],g)};return a.diff=ko.observableArray(),a.pollTime=ko.observable("Never"),a.pollInterval=ko.observable(1e3),a.paused=ko.observable(!0),a.query=ko.observable("{}"),a.throttled_query=ko.computed(function(){return a.query()}).extend({throttle:100}),a.queryError=ko.observable(!1),a.enableLimit=ko.observable(!0).extend({throttle:5e3}),a.queryLimit=ko.observable(25),a.cpuTime=ko.observable(0),a.networkTime=ko.observable(0),a.clear=function(){a.diff([])},a.stopCapture=function(){a.paused(!0),e=!1,a.cpuTime(0),a.networkTime(0),a.pollTime("Paused"),window.clearInterval(c)},a.startCapture=function(){a.paused(!1),a.findDifference(),c=window.setInterval(function(){a.findDifference()},a.pollInterval())},a.findDifference=function(){var b=(new Date).getTime();a.paused()!==!0&&e!==!0&&(e=!0,$.ajax({url:"/toolbag/getPoints",data:JSON.stringify($.parseJSON(d)),dataType:"json",contentType:"application/json",type:"post"}).done(function(c){var d,k,l,m;if(a.paused()!==!0){if(a.networkTime((new Date).getTime()-b+" ms"),void 0===c.error){for(a.pollTime((new Date).toString("h:mm:ss")+":"+(new Date).getMilliseconds().toString()),m=(new Date).getTime(),d=0;d<c.length;d++)l=f(c[d]._id),null!==l?(k=a.diff().length,i(c[d].Name,l.entry,c[d]),j(c[d].Name,l.entry,c[d]),k!=a.diff().length&&(h(l.index),g(c[d]))):g(c[d]);a.cpuTime((new Date).getTime()-m+" ms")}else alert("An error occurred. The server reported: "+c.error);e=!1}}).fail(function(c,d,f){e=!1,a.paused()===!1&&a.networkTime((new Date).getTime()-b),console.log(d,": ",f)}))},a.pollInterval.subscribe(function(b){a.paused()===!1&&(a.stopCapture(),a.startCapture())}),a.query.subscribe(function(b){b=b.replace(/'/g,'"'),a.query(b)}),a.throttled_query.subscribe(function(b){isJson(b)===!1?a.queryError(!0):(a.queryError(!1),d=b)}),a.enableLimit.subscribe(function(b){$.ajax({url:"/toolbag/changeLimit",data:JSON.stringify({enableLimit:b,limit:a.queryLimit()}),contentType:"application/json",dataType:"json",type:"post"}).done(function(a){}).fail(function(a,b,c){console.log(b,": ",c)})}),a.queryLimit.subscribe(function(b){console.log(b),$.ajax({url:"/toolbag/changeLimit",data:JSON.stringify({enableLimit:a.enableLimit(),limit:b}),contentType:"application/json",dataType:"json",type:"post"}).done(function(a){}).fail(function(a,b,c){console.log(b,": ",c)})}),d=a.query(),a}();$(function(){ko.applyBindings(myViewModel),$("#diffTable").delegate("td","click",function(){$(this).closest("tr").hasClass("highlightedRow")===!0?$(this).closest("tr").removeClass("highlightedRow"):($("#diffTable").find("tr.highlightedRow").removeClass("highlightedRow"),$(this).closest("tr").addClass("highlightedRow"))})});