/*
  knockback.js 0.18.6
  Copyright (c)  2011-2014 Kevin Malakoff.
  License: MIT (http://www.opensource.org/licenses/mit-license.php)
  Source: https://github.com/kmalakoff/knockback
  Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
  Optional dependencies: Backbone.ModelRef.js and BackboneORM.
*/
(function(){var e={requires:[]};window.require&&e.requires.push(window.require),"undefined"!=typeof t&&null!==t&&e.requires.push(t),function(){"use strict";var t={},r={},n=function(e,t){return{}.hasOwnProperty.call(e,t)},i=function(e,t){var r,n,i=[];r=/^\.\.?(\/|$)/.test(t)?[e,t].join("/").split("/"):t.split("/");for(var o=0,s=r.length;s>o;o++)n=r[o],".."===n?i.pop():"."!==n&&""!==n&&i.push(n);return i.join("/")},o=function(e){return e.split("/").slice(0,-1).join("/")},s=function(t){var r=function(r){var n=o(t),s=i(n,r);return e.require(s,t)};return r.register=e.require.register,r.shim=e.require.shim,r},a=function(e,t){var n={id:e,exports:{}};return r[e]=n,t(n.exports,s(e),n),n.exports},l=function(e,o){var s=i(e,".");if(null==o&&(o="/"),n(r,s))return r[s].exports;if(n(t,s))return a(s,t[s]);var l=i(s,"./index");if(n(r,l))return r[l].exports;if(n(t,l))return a(l,t[l]);throw new Error('Cannot find module "'+e+'" from "'+o+'"')},u=function(e,r){if("object"==typeof e)for(var i in e)n(e,i)&&(t[i]=e[i]);else t[e]=r},c=Object.prototype.toString,d=function(e){return"[object Array]"===c.call(e)},p=function(t){if("undefined"!=typeof window){d(t)||(t=[t]);for(var r=function(t){var r;try{if(e.require(t.path))return}catch(n){}try{for(var i=0,o=e.requires.length;o>i&&!(r=e.requires[i](t.path));i++);}catch(n){}if(!r&&t.symbol){var s=t.symbol.split(".");r=window;for(var a=0,l=s.length;l>a&&(r=r[s[a]]);a++);}if(!r){if(t.optional)return;throw new Error("Missing dependency: "+t.path)}e.require.register(t.path,function(e,t,n){return n.exports=r}),t.alias&&e.require.register(t.alias,function(e,t,n){return n.exports=r})},n=0,i=t.length;i>n;n++)r(t[n])}};e.require=l,e.require.register=u,e.require.shim=p}.call(this);var t=e.require;t.register("collection-observable",function(e,t){var r,n,i,o,s,a,l=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};o=t("./kb"),a=t("underscore"),s=t("knockout"),i=0,r=-1,n=1,o.compare=function(e,t){return a.isString(e)?e.localeCompare(""+t):a.isString(t)?t.localeCompare(""+e):e===t?i:t>e?r:n},o.CollectionObservable=function(){function e(e,t){return o.ignore(function(r){return function(){var n,i,l;return!a.isUndefined(t)||e instanceof o.Collection?a.isArray(e)&&(e=new o.Collection(e)):(l=[new o.Collection,e],e=l[0],t=l[1]),t||(t={}),i=o.utils.wrappedObservable(r,s.observableArray([])),i.__kb_is_co=!0,r.in_edit=0,r.__kb||(r.__kb={}),r.__kb._onCollectionChange=a.bind(r._onCollectionChange,r),t=o.utils.collapseOptions(t),t.auto_compact&&(r.auto_compact=!0),r._comparator=s.observable(t.sort_attribute?r._attributeComparator(t.sort_attribute):t.comparator),r._filters=s.observableArray(t.filters?a.isArray(t.filters)?t.filters:t.filters?[t.filters]:void 0:[]),n=r.create_options={store:o.Store.useOptionsOrCreate(t,e,i)},r.path=t.path,n.factory=o.utils.wrappedFactory(i,r._shareOrCreateFactory(t)),n.path=o.utils.pathJoin(t.path,"models"),n.creator=n.factory.creatorForPath(null,n.path),n.creator&&(r.models_only=n.creator.models_only),o.publishMethods(i,r,["destroy","shareOptions","filters","comparator","sortAttribute","viewModelByModel","hasViewModels"]),r._collection=s.observable(e),i.collection=r.collection=s.dependentObservable({read:function(){return r._collection()},write:function(e){return o.ignore(function(){var t;if((t=r._collection())!==e)return t&&t.unbind("all",r.__kb._onCollectionChange),e&&e.bind("all",r.__kb._onCollectionChange),r._collection(e)})}}),e&&e.bind("all",r.__kb._onCollectionChange),r._mapper=s.dependentObservable(function(){var e,t,n,l,u,c,d,p;if(e=r._comparator(),l=r._filters())for(d=0,p=l.length;p>d;d++)n=l[d],s.utils.unwrapObservable(n);return t=r._collection(),r.in_edit?void 0:(i=o.utils.wrappedObservable(r),t&&(u=t.models),u&&0!==t.models.length?(u=a.filter(u,function(e){return!l.length||r._selectModel(e)}),c=e?a.map(u,function(e){return r._createViewModel(e)}).sort(e):r.models_only?l.length?u:u.slice():a.map(u,function(e){return r._createViewModel(e)})):c=[],r.in_edit++,i(c),r.in_edit--)}),i.subscribe(a.bind(r._onObservableArrayChange,r)),!o.statistics||o.statistics.register("CollectionObservable",r),i}}(this))}return e.extend=o.extend,e.prototype.destroy=function(){var e,t,r;return r=o.utils.wrappedObservable(this),t=this._collection(),t&&(t.unbind("all",this.__kb._onCollectionChange),e=r(),e.splice(0,e.length)),this.collection.dispose(),this._collection=r.collection=this.collection=null,this._mapper.dispose(),this._mapper=null,o.release(this._filters),this._filters=null,this._comparator(null),this._comparator=null,this.create_options=null,r.collection=null,o.utils.wrappedDestroy(this),!o.statistics||o.statistics.unregister("CollectionObservable",this)},e.prototype.shareOptions=function(){var e;return e=o.utils.wrappedObservable(this),{store:o.utils.wrappedStore(e),factory:o.utils.wrappedFactory(e)}},e.prototype.filters=function(e){return this._filters(e?a.isArray(e)?e:[e]:[])},e.prototype.comparator=function(e){return this._comparator(e)},e.prototype.sortAttribute=function(e){return this._comparator(e?this._attributeComparator(e):null)},e.prototype.viewModelByModel=function(e){var t;return this.models_only?null:(t=e.hasOwnProperty(e.idAttribute)?e.idAttribute:"cid",a.find(o.peek(o.utils.wrappedObservable(this)),function(r){var n;return(null!=r&&null!=(n=r.__kb)?n.object:void 0)?r.__kb.object[t]===e[t]:!1}))},e.prototype.hasViewModels=function(){return!this.models_only},e.prototype.compact=function(){return o.ignore(function(e){return function(){var t;return t=o.utils.wrappedObservable(e),o.utils.wrappedStoreIsOwned(t)?(o.utils.wrappedStore(t).clear(),e._collection.notifySubscribers(e._collection())):void 0}}(this))},e.prototype._shareOrCreateFactory=function(e){var t,r,n,i;if(t=o.utils.pathJoin(e.path,"models"),n=e.factories,(i=e.factory)&&(r=i.creatorForPath(null,t))&&(!n||n.models===r)){if(!n)return i;if(i.hasPathMappings(n,e.path))return i}return i=new o.Factory(e.factory),n&&i.addPathMappings(n,e.path),i.creatorForPath(null,t)||(e.hasOwnProperty("models_only")?e.models_only?i.addPathMapping(t,{models_only:!0}):i.addPathMapping(t,o.ViewModel):e.view_model?i.addPathMapping(t,e.view_model):e.create?i.addPathMapping(t,{create:e.create}):i.addPathMapping(t,o.ViewModel)),i},e.prototype._onCollectionChange=function(e,t){return o.ignore(function(r){return function(){var n,i,s,a;if(!r.in_edit)switch(e){case"reset":r.auto_compact?r.compact():r._collection.notifySubscribers(r._collection());break;case"sort":case"resort":r._collection.notifySubscribers(r._collection());break;case"new":case"add":if(!r._selectModel(t))return;if(s=o.utils.wrappedObservable(r),n=r._collection(),-1===n.indexOf(t))return;if(a=r.viewModelByModel(t))return;r.in_edit++,a=r._createViewModel(t),(i=r._comparator())?(s().push(a),s.sort(i)):s.splice(n.indexOf(t),0,a),r.in_edit--;break;case"remove":case"destroy":r._onModelRemove(t);break;case"change":r._selectModel(t)?(a=r.models_only?t:r.viewModelByModel(t),a?(i=r._comparator())&&(s=o.utils.wrappedObservable(r),r.in_edit++,s.sort(i),r.in_edit--):r._onCollectionChange("add",t)):r._onModelRemove(t)}}}(this))},e.prototype._onModelRemove=function(e){var t,r;return(r=this.models_only?e:this.viewModelByModel(e))?(t=o.utils.wrappedObservable(this),this.in_edit++,t.remove(r),this.in_edit--):void 0},e.prototype._onObservableArrayChange=function(e){return o.ignore(function(t){return function(){var r,n,i,s,l,u,c,d,p;if(!t.in_edit&&(t.models_only&&(!e.length||o.utils.hasModelSignature(e[0]))||!t.models_only&&(!e.length||a.isObject(e[0])&&!o.utils.hasModelSignature(e[0]))||o._throwUnexpected(t,"incorrect type passed"),l=o.utils.wrappedObservable(t),r=o.peek(t._collection),n=o.peek(t._filters).length,r)){if(c=e,t.models_only)s=a.filter(e,function(e){return!n||t._selectModel(e)});else for(!n||(c=[]),s=[],d=0,p=e.length;p>d;d++){if(u=e[d],i=o.utils.wrappedObject(u),n){if(!t._selectModel(i))continue;c.push(u)}t.create_options.store.findOrReplace(i,t.create_options.creator,u),s.push(i)}t.in_edit++,e.length===c.length||l(c),a.isEqual(r.models,s)||r.reset(s),t.in_edit--}}}(this))},e.prototype._attributeComparator=function(e){var t;return t=function(t,r){var n;return n=s.utils.unwrapObservable(e),o.compare(t.get(n),r.get(n))},this.models_only?t:function(e,r){return t(o.utils.wrappedModel(e),o.utils.wrappedModel(r))}},e.prototype._createViewModel=function(e){return this.models_only?e:this.create_options.store.findOrCreate(e,this.create_options)},e.prototype._selectModel=function(e){var t,r,n,i,s;for(r=o.peek(this._filters),n=0,i=r.length;i>n;n++)if(t=r[n],t=o.peek(t),a.isFunction(t)){if(!t(e))return!1}else if(a.isArray(t)){if(s=e.id,l.call(t,s)<0)return!1}else if(e.id!==t)return!1;return!0},e}(),o.collectionObservable=function(e,t){return new o.CollectionObservable(e,t)}}),t.register("event-watcher",function(e,t){var r,n,i,o=function(e,t){return function(){return e.apply(t,arguments)}},s=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};r=t("./kb"),i=t("underscore"),n=t("knockout"),r.EventWatcher=function(){function e(e,t,r){this._onModelUnloaded=o(this._onModelUnloaded,this),this._onModelLoaded=o(this._onModelLoaded,this),this.__kb||(this.__kb={}),this.__kb.callbacks={},this.__kb._onModelLoaded=i.bind(this._onModelLoaded,this),this.__kb._onModelUnloaded=i.bind(this._onModelUnloaded,this),r&&this.registerCallbacks(t,r),e?this.emitter(e):this.ee=null}return e.useOptionsOrCreate=function(e,t,n,i){return e.event_watcher?(e.event_watcher.emitter()!==t&&e.event_watcher.model_ref!==t&&r._throwUnexpected(this,"emitter not matching"),r.utils.wrappedEventWatcher(n,e.event_watcher).registerCallbacks(n,i)):(r.utils.wrappedEventWatcherIsOwned(n,!0),r.utils.wrappedEventWatcher(n,new r.EventWatcher(t)).registerCallbacks(n,i))},e.prototype.destroy=function(){return this.emitter(null),this.__kb.callbacks=null,r.utils.wrappedDestroy(this)},e.prototype.emitter=function(e){var t,n,i,o,s,a,l,u;if(0===arguments.length||this.ee===e)return this.ee;this.model_ref&&(this.model_ref.unbind("loaded",this.__kb._onModelLoaded),this.model_ref.unbind("unloaded",this.__kb._onModelUnloaded),this.model_ref.release(),this.model_ref=null),r.Backbone&&r.Backbone.ModelRef&&e instanceof r.Backbone.ModelRef?(this.model_ref=e,this.model_ref.retain(),this.model_ref.bind("loaded",this.__kb._onModelLoaded),this.model_ref.bind("unloaded",this.__kb._onModelUnloaded),e=this.model_ref.model()):delete this.model_ref,s=this.ee,this.ee=e,u=this.__kb.callbacks;for(n in u)for(t=u[n],s&&s.unbind(n,t.fn),e&&this.ee.bind(n,t.fn),o=t.list,a=0,l=o.length;l>a;a++)i=o[a],i.emitter&&i.emitter(this.ee);return e},e.prototype.registerCallbacks=function(e,t){var o,a,l,u,c,d,p,f;for(e||r._throwMissing(this,"obj"),t||r._throwMissing(this,"info"),u=t.event_selector?t.event_selector:"change",l=u.split(" "),p=0,f=l.length;f>p;p++)a=l[p],a&&(o=this.__kb.callbacks[a],o||(d=[],o={list:d,fn:function(){return function(e){var t,i,o;for(i=0,o=d.length;o>i;i++)if(t=d[i],t.update&&!t.rel_fn){if(e&&t.key&&e.hasChanged&&!e.hasChanged(n.utils.unwrapObservable(t.key)))continue;!r.statistics||r.statistics.addModelEvent({name:a,model:e,key:t.key,path:t.path}),t.update()}return null}}(this)},this.__kb.callbacks[a]=o,this.ee&&this.ee.bind(a,o.fn)),c=i.defaults({obj:e},t),o.list.push(c));this.ee&&(s.call(l,"change")>=0&&(c.unbind_fn=r.orm.bind(this.ee,c.key,c.update,c.path)),c.emitter(this.ee)&&c.emitter)},e.prototype.releaseCallbacks=function(e){var t,n,i,o,s,a;if(this.__kb.callbacks&&this.ee){s=this.__kb.callbacks;for(n in s){t=s[n],a=t.list;for(i in a)if(o=a[i],o.obj===e)return t.list.splice(i,1),o.unbind_fn&&(o.unbind_fn(),o.unbind_fn=null),void(!r.wasReleased(e)&&o.emitter&&o.emitter(null))}}},e.prototype._onModelLoaded=function(e){var t,n,i,o,s,a,l;this.ee=e,a=this.__kb.callbacks;for(n in a)for(t=a[n],e.bind(n,t.fn),l=t.list,o=0,s=l.length;s>o;o++)i=l[o],i.unbind_fn=r.orm.bind(e,i.key,i.update,i.path),i.emitter&&i.emitter(e)},e.prototype._onModelUnloaded=function(e){var t,r,n,i,o,s,a;this.ee=null,a=this.__kb.callbacks;for(r in a)for(t=a[r],e.unbind(r,t.fn),i=t.list,o=0,s=i.length;s>o;o++)n=i[o],n.unbind_fn&&(n.unbind_fn(),n.unbind_fn=null),n.emitter&&n.emitter(null)},e}(),r.emitterObservable=function(e,t){return new r.EventWatcher(e,t)}}),t.register("factory",function(e,t){var r,n;r=t("./kb"),n=t("underscore"),r.Factory=function(){function e(e){this.parent_factory=e,this.paths={}}return e.useOptionsOrCreate=function(e,t,n){var i;return e.factory&&(!e.factories||e.factories&&e.factory.hasPathMappings(e.factories,n))?r.utils.wrappedFactory(t,e.factory):(i=r.utils.wrappedFactory(t,new r.Factory(e.factory)),e.factories&&i.addPathMappings(e.factories,n),i)},e.prototype.hasPath=function(e){return this.paths.hasOwnProperty(e)||this.parent_factory&&this.parent_factory.hasPath(e)},e.prototype.addPathMapping=function(e,t){return this.paths[e]=t},e.prototype.addPathMappings=function(e,t){var n,i;for(i in e)n=e[i],this.paths[r.utils.pathJoin(t,i)]=n},e.prototype.hasPathMappings=function(e,t){var n,i,o,s;n=!0;for(s in e)i=e[s],n&=(o=this.creatorForPath(null,r.utils.pathJoin(t,s)))&&i===o;return n},e.prototype.creatorForPath=function(e,t){var r;return(r=this.paths[t])?r.view_model?r.view_model:r:this.parent_factory&&(r=this.parent_factory.creatorForPath(e,t))?r:null},e}()}),t.register("index",function(e,t,r){var n,i,o,s,a,l,u,c,d,p,f,b,_;for(this.Parse&&(this.Backbone=this.Parse,this._=this.Parse._),"undefined"!=typeof window&&null!==window&&t.shim&&t.shim([{symbol:"_",path:"lodash",alias:"underscore",optional:!0},{symbol:"_",path:"underscore"},{symbol:"Backbone",path:"backbone"},{symbol:"ko",path:"knockout"}]),r.exports=s=t("./kb"),n=this.Parse?s.Parse=this.Parse:s.Backbone=t("backbone"),s.Collection=n.Collection,s.Model=n.Object||n.Model,s.Events=n.Events,s._=t("underscore"),s.ko=t("knockout"),f=["./utils","./event-watcher","./store","./factory","./observable","./view-model","./collection-observable","./orm","./inject"],a=0,c=f.length;c>a;a++)i=f[a],t(i);for(b=["./default-observable","./formatted-observable","./localized-observable","./statistics","./triggered-observable","./validation"],l=0,d=b.length;d>l;l++){i=b[l];try{t(i)}catch(h){o=h}}for(s.modules={},_=["underscore","backbone","knockout"],u=0,p=_.length;p>u;u++)i=_[u],s.modules[i]=t(i)}),t.register("inject",function(e,t){var r,n,i,o,s;r=t("./kb"),o=t("underscore"),n=t("knockout"),r.RECUSIVE_AUTO_INJECT=!0,n.bindingHandlers.inject={init:function(e,t,i,o){return r.Inject.inject(n.utils.unwrapObservable(t()),o,e,t,i)}},r.Inject=function(){function e(){}return e.inject=function(e,t,i,s,a,l){var u,c,d;return u=function(e){var n,u,c;if(o.isFunction(e))t=new e(t,i,s,a),r.releaseOnNodeRemove(t,i);else{e.view_model&&(t=new e.view_model(t,i,s,a),r.releaseOnNodeRemove(t,i));for(n in e)c=e[n],"view_model"!==n&&("create"===n?c(t,i,s,a):o.isObject(c)&&!o.isFunction(c)?(u=l||c&&c.create?{}:t,t[n]=r.Inject.inject(c,u,i,s,a,!0)):t[n]=c)}return t},l?u(e):(c=(d=n.dependentObservable(function(){return u(e)}))(),d.dispose(),c)},e.injectViewModels=function(e){var t,n,i,s,a,l,u,c,d,p;for(c=[],l=function(e){var t,r,n,i,s;for(e.__kb_injected||e.attributes&&(t=o.find(e.attributes,function(e){return"kb-inject"===e.name}))&&(e.__kb_injected=!0,c.push({el:e,view_model:{},binding:t.value})),s=e.childNodes,n=0,i=s.length;i>n;n++)r=s[n],l(r)},e||"undefined"==typeof document||null===document||(e=document),l(e),d=0,p=c.length;p>d;d++)n=c[d],(a=n.binding)&&(a.search(/[:]/)<0||(a="{"+a+"}"),s=new Function("","return ( "+a+" )")(),s||(s={}),!s.options||(u=s.options,delete s.options),u||(u={}),n.view_model=r.Inject.inject(s,n.view_model,n.el,null,null,!0),t=n.view_model.afterBinding||u.afterBinding,i=n.view_model.beforeBinding||u.beforeBinding),i&&i(n.view_model,n.el,u),r.applyBindings(n.view_model,n.el,u),t&&t(n.view_model,n.el,u);return c},e}(),s=n.applyBindings,n.applyBindings=function(e,t){var n;return n=r.RECUSIVE_AUTO_INJECT?r.injectViewModels(t):[],n.length?void 0:s.apply(this,arguments)},r.injectViewModels=r.Inject.injectViewModels,"undefined"!=typeof document&&null!==document&&(this.$?this.$(function(){return r.injectViewModels()}):(i=function(){return"complete"!==document.readyState?setTimeout(i,0):r.injectViewModels()})())}),t.register("kb",function(e,t,r){var n,i,o,s;s=t("underscore"),o=t("knockout"),n=function(e,t){var r,n;for(r in t)n=t[r],e[r]=n;return e};var a=function(){},l=function(e,t,r){var i;return i=t&&t.hasOwnProperty("constructor")?t.constructor:function(){e.apply(this,arguments)},n(i,e),a.prototype=e.prototype,i.prototype=new a,t&&n(i.prototype,t),r&&n(i,r),i.prototype.constructor=i,i.__super__=e.prototype,i},u=function(e,t){var r=l(this,e,t);return r.extend=this.extend,r};r.exports=i=function(){function e(){}var t;return e.VERSION="0.18.6",e.TYPE_UNKNOWN=0,e.TYPE_SIMPLE=1,e.TYPE_ARRAY=2,e.TYPE_MODEL=3,e.TYPE_COLLECTION=4,e.wasReleased=function(e){return!e||e.__kb_released},e.isReleaseable=function(t,r){var n,i;if(null==r&&(r=0),!t||t!==Object(t)||t.__kb_released)return!1;if(o.isObservable(t)||t instanceof e.ViewModel)return!0;if("function"==typeof t||t instanceof e.Model||t instanceof e.Collection)return!1;if("function"==typeof t.dispose||"function"==typeof t.destroy||"function"==typeof t.release)return!0;if(1>r)for(n in t)if(i=t[n],"__kb"!==n&&e.isReleaseable(i,r+1))return!0;return!1},e.release=function(t){var r,n,i;if(e.isReleaseable(t))if(s.isArray(t))for(n in t)i=t[n],e.isReleaseable(i)&&(t[n]=null,e.release(i));else if(t.__kb_released=!0,o.isObservable(t)&&s.isArray(r=e.peek(t))){if(t.__kb_is_co||t.__kb_is_o&&t.valueType()===e.TYPE_COLLECTION)t.destroy?t.destroy():t.dispose&&t.dispose();else if(r.length)for(n in r)i=r[n],e.isReleaseable(i)&&(r[n]=null,e.release(i))}else"function"==typeof t.release?t.release():"function"==typeof t.destroy?t.destroy():"function"==typeof t.dispose?t.dispose():o.isObservable(t)||this.releaseKeys(t)},e.releaseKeys=function(t){var r,n;for(r in t)n=t[r],"__kb"!==r&&e.isReleaseable(n)&&(t[r]=null,e.release(n))},e.releaseOnNodeRemove=function(t,r){return t||e._throwUnexpected(this,"missing view model"),r||e._throwUnexpected(this,"missing node"),o.utils.domNodeDisposal.addDisposeCallback(r,function(){return e.release(t)})},e.renderTemplate=function(t,r,n){var i,s;return null==n&&(n={}),"undefined"==typeof document||null===document?"undefined"!=typeof console&&null!==console?console.log("renderTemplate: document is undefined"):void 0:(i=document.createElement("div"),s=o.renderTemplate(t,r,n,i,"replaceChildren"),1===i.children.length&&(i=i.children[0]),e.releaseOnNodeRemove(r,i),s.dispose(),r.afterRender&&!n.afterRender&&r.afterRender(i),i)},e.applyBindings=function(t,r){return o.applyBindings(t,r),e.releaseOnNodeRemove(t,r)},e.getValue=function(t,r,n){return t?s.isFunction(t[r])&&e.orm.useFunction(t,r)?t[r]():n?t.get.apply(t,s.map([r].concat(n),function(t){return e.peek(t)})):t.get(r):void 0},e.setValue=function(t,r,n){var i;if(t)return s.isFunction(t[r])&&e.orm.useFunction(t,r)?t[r](n):((i={})[r]=n,t.set(i))},e.ignore=(null!=(t=o.dependencyDetection)?t.ignore:void 0)||function(e,t,r){var n;return n=null,o.dependentObservable(function(){return n=e.apply(t,r||[])}).dispose(),n},e.extend=u,e._throwMissing=function(e,t){throw""+(s.isString(e)?e:e.constructor.name)+": "+t+" is missing"},e._throwUnexpected=function(e,t){throw""+(s.isString(e)?e:e.constructor.name)+": "+t+" is unexpected"},e.publishMethods=function(t,r,n){var i,o,s;for(o=0,s=n.length;s>o;o++)i=n[o],t[i]=e._.bind(r[i],r)},e.peek=function(t){return o.isObservable(t)?t.peek?t.peek():e.ignore(function(){return t()}):t},e}()}),t.register("observable",function(e,t){var r,n,i;r=t("./kb"),i=t("underscore"),n=t("knockout"),r.Observable=function(){function e(e,t,o){return this._vm=null!=o?o:{},r.ignore(function(o){return function(){var s,a,l;return t||r._throwMissing(o,"options"),s=o.create_options=i.isString(t)||n.isObservable(t)?{key:t}:r.utils.collapseOptions(t),o.key=s.key,delete s.key,o.key||r._throwMissing(o,"key"),!s.args||(o.args=s.args,delete s.args),!s.read||(o.read=s.read,delete s.read),!s.write||(o.write=s.write,delete s.write),a=s.event_watcher,delete s.event_watcher,o._vo=n.observable(null),o._model=n.observable(),l=r.utils.wrappedObservable(o,n.dependentObservable({read:function(){var e,t,s,a,l,u;for(l=o._model(),u=t=[o.key].concat(o.args||[]),s=0,a=u.length;a>s;s++)e=u[s],n.utils.unwrapObservable(e);return o.read?o.update(o.read.apply(o._vm,t)):i.isUndefined(l)||r.ignore(function(){return o.update(r.getValue(l,r.peek(o.key),o.args))}),n.utils.unwrapObservable(o._vo())},write:function(e){return r.ignore(function(){var t,n;return t=r.utils.unwrapModels(e),n=r.peek(o._model),o.write?(o.write.call(o._vm,t),e=r.getValue(n,r.peek(o.key),o.args)):n&&r.setValue(n,r.peek(o.key),t),o.update(e)})},owner:o._vm})),l.__kb_is_o=!0,s.store=r.utils.wrappedStore(l,s.store),s.path=r.utils.pathJoin(s.path,o.key),s.factories&&("function"==typeof s.factories||s.factories.create)?(s.factory=r.utils.wrappedFactory(l,new r.Factory(s.factory)),s.factory.addPathMapping(s.path,s.factories)):s.factory=r.Factory.useOptionsOrCreate(s,l,s.path),delete s.factories,r.publishMethods(l,o,["value","valueType","destroy"]),l.model=o.model=n.dependentObservable({read:function(){return n.utils.unwrapObservable(o._model)},write:function(e){return r.ignore(function(){var t;if(!o.__kb_released&&r.peek(o._model)!==e)return t=r.getValue(e,r.peek(o.key),o.args),o._model(e),e?i.isUndefined(t)?void 0:o.update(t):o.update(null)})}}),r.EventWatcher.useOptionsOrCreate({event_watcher:a},e,o,{emitter:o.model,update:i.bind(o.update,o),key:o.key,path:s.path}),o.__kb_value||o.update(),r.LocalizedObservable&&s.localizer&&(l=new s.localizer(l),delete s.localizer),r.DefaultObservable&&s.hasOwnProperty("default")&&(l=r.defaultObservable(l,s["default"]),delete s["default"]),l}}(this))}return e.prototype.destroy=function(){var e;return e=r.utils.wrappedObservable(this),this.__kb_released=!0,r.release(this.__kb_value),this.__kb_value=null,this.model.dispose(),this.model=e.model=null,r.utils.wrappedDestroy(this)},e.prototype.value=function(){return this.__kb_value},e.prototype.valueType=function(){var e;return e=r.getValue(r.peek(this._model),r.peek(this.key)),this.value_type||this._updateValueObservable(e),this.value_type},e.prototype.update=function(e){var t,n;if(!this.__kb_released){if(arguments.length||(e=r.getValue(r.peek(this._model),r.peek(this.key))),void 0!==e||(e=null),t=r.utils.valueType(e),(!this.__kb_value||this.__kb_value.__kb_released||this.__kb_value.__kb_null&&e)&&(this.__kb_value=void 0,this.value_type=void 0),n=this.__kb_value,i.isUndefined(this.value_type)||this.value_type!==t&&t!==r.TYPE_UNKNOWN)return this.value_type===r.TYPE_COLLECTION&&t===r.TYPE_ARRAY?n(e):this._updateValueObservable(e);if(this.value_type===r.TYPE_MODEL){if("function"==typeof n.model){if(n.model()!==e)return n.model(e)}else if(r.utils.wrappedObject(n)!==e)return this._updateValueObservable(e)}else if(this.value_type===r.TYPE_COLLECTION){if(n.collection()!==e)return n.collection(e)}else if(n()!==e)return n(e)}},e.prototype._updateValueObservable=function(e){var t,o,s,a;return t=this.create_options,t.creator=r.utils.inferCreator(e,t.factory,t.path,r.peek(this._model),this.key),this.value_type=r.TYPE_UNKNOWN,o=t.creator,s=this.__kb_value,this.__kb_value=void 0,s&&r.release(s),o?t.store?a=t.store.findOrCreate(e,t):o.models_only?(a=e,this.value_type=r.TYPE_SIMPLE):a=o.create?o.create(e,t):new o(e,t):i.isArray(e)?(this.value_type=r.TYPE_ARRAY,a=n.observableArray(e)):(this.value_type=r.TYPE_SIMPLE,a=n.observable(e)),this.value_type===r.TYPE_UNKNOWN&&(n.isObservable(a)?this.value_type=a.__kb_is_co?r.TYPE_COLLECTION:r.TYPE_SIMPLE:(this.value_type=r.TYPE_MODEL,"function"!=typeof a.model&&r.utils.wrappedObject(a,e))),this.__kb_value=a,this._vo(a)},e}(),r.observable=function(e,t,n){return new r.Observable(e,t,n)}}),t.register("orm",function(e,t){var r,n,i,o,s,a;s=t("./kb"),a=t("underscore"),r=function(){function e(){this.adapters=[]}return e.prototype.initialize=function(){return this.adapters=a.select(this.adapters,function(e){return e.isAvailable()}),this.initialized=!0},e.prototype.addAdapter=function(e){return this.adapters.push(e),this.initialized=!1},e.prototype.keys=function(){return this._call("keys",arguments)},e.prototype.bind=function(){return this._call("bind",arguments)},e.prototype.useFunction=function(){return this._call("useFunction",arguments)},e.prototype._call=function(e,t){var r,n,i,o,s;if(this.adapters.length)for(this.initialized||this.initialize(),s=this.adapters,i=0,o=s.length;o>i;i++)if(r=s[i],r[e]&&(n=r[e].apply(r,t)))return n},e}(),s.orm=new r,i=function(){function e(){}return e.prototype.isAvailable=function(){var e,r;try{(null!=(e=s.Backbone)?e.RelationalModel:void 0)||("function"==typeof t?t("backbone-relational"):void 0)}catch(n){}return!!(null!=(r=s.Backbone)?r.RelationalModel:void 0)},e.prototype.relationType=function(e,t){var r;return e instanceof s.Backbone.RelationalModel&&(r=a.find(e.getRelations(),function(e){return e.key===t}))?r.collectionType||a.isArray(r.keyContents)?s.TYPE_COLLECTION:s.TYPE_MODEL:null},e.prototype.bind=function(e,t,r,n){var i,o,a,l,u,c;if(!(l=this.relationType(e,t)))return null;if(a=function(e){return!s.statistics||s.statistics.addModelEvent({name:"update (relational)",model:e,key:t,path:n}),r()},o=Backbone.Relation.prototype.sanitizeOptions?["update","add","remove"]:["change","add","remove"],l===s.TYPE_COLLECTION)for(u=0,c=o.length;c>u;u++)i=o[u],e.bind(""+i+":"+t,a);else e.bind(""+o[0]+":"+t,a);return function(){var r,n;if(l===s.TYPE_COLLECTION)for(r=0,n=o.length;n>r;r++)i=o[r],e.unbind(""+i+":"+t,a);else e.unbind(""+o[0]+":"+t,a)}},e}(),s.orm.addAdapter(new i),n=function(){function e(){}return e.prototype.isAvailable=function(){var e,r;try{(null!=(e=s.Backbone)?e.AssociatedModel:void 0)||("function"==typeof t?t("backbone-associations"):void 0)}catch(n){}return!!(null!=(r=s.Backbone)?r.AssociatedModel:void 0)},e.prototype.keys=function(e){return e instanceof s.Backbone.AssociatedModel?a.map(e.relations,function(e){return e.key}):null},e.prototype.relationType=function(e,t){var r;return e instanceof s.Backbone.AssociatedModel&&(r=a.find(e.relations,function(e){return e.key===t}))?"Many"===r.type?s.TYPE_COLLECTION:s.TYPE_MODEL:null},e}(),s.orm.addAdapter(new n),o=function(){function e(){}return e.prototype.isAvailable=function(){try{("undefined"!=typeof window&&null!==window?window.Supermodel:void 0)||("function"==typeof t?t("supermodel"):void 0)}catch(e){}return!!("undefined"!=typeof window&&null!==window?window.Supermodel:void 0)},e.prototype.keys=function(e){return e instanceof Supermodel.Model?a.keys(e.constructor.associations()):null},e.prototype.relationType=function(e,t){var r;return e instanceof Supermodel.Model&&(r=e.constructor.associations()[t])?r.add?s.TYPE_COLLECTION:s.TYPE_MODEL:null},e.prototype.bind=function(e,t,r,n){var i,o;return(o=this.relationType(e,t))?(i=function(e,i){var o,a;return!s.statistics||s.statistics.addModelEvent({name:"update (supermodel)",model:e,key:t,path:n}),a=e.constructor.associations()[t],o=e[a.store],e[a.store]=i,r(i),e[a.store]=o},o===s.TYPE_MODEL?(e.bind("associate:"+t,i),function(){return e.unbind("associate:"+t,i)}):void 0):null},e.prototype.useFunction=function(e,t){return!!this.relationType(e,t)},e}(),s.orm.addAdapter(new o)}),t.register("store",function(e,t,r){var n,i,o;n=t("./kb"),o=t("underscore"),i=t("knockout"),r.exports=n.Store=function(){function e(){this.observable_records=[],this.replaced_observables=[]}return e.useOptionsOrCreate=function(e,t,r){return e.store?(e.store.register(t,r,e),n.utils.wrappedStore(r,e.store)):(n.utils.wrappedStoreIsOwned(r,!0),n.utils.wrappedStore(r,new n.Store))},e.prototype.destroy=function(){return this.clear()},e.prototype.clear=function(){var e,t,r,i;for(i=this.observable_records.splice(0,this.observable_records.length),t=0,r=i.length;r>t;t++)e=i[t],n.release(e.observable);n.release(this.replaced_observables)},e.prototype.compact=function(){var e,t,r,n,i;r=[],n=this.observable_records;for(e in n)t=n[e],(null!=(i=t.observable)?i.__kb_released:void 0)&&r.push(t);r.length&&(this.observable_records=o.difference(this.observable_records,r))},e.prototype.register=function(e,t,r){var o;if(t&&!i.isObservable(t)&&!t.__kb_is_co)return n.utils.wrappedObject(t,e),e||(t.__kb_null=!0),o=r.creator?r.creator:r.path&&r.factory?r.factory.creatorForPath(e,r.path):null,o||(o=t.constructor),this.observable_records.push({obj:e,observable:t,creator:o}),t},e.prototype.findIndex=function(e,t){var r,i,s,a;if(s=[],!e||e instanceof n.Model){a=this.observable_records;for(r in a)if(i=a[r],i.observable)if(i.observable.__kb_released)s.push(i);else if((e||i.observable.__kb_null)&&(!e||!i.observable.__kb_null&&i.obj===e)&&(i.creator===t||i.creator.create&&i.creator.create===t.create))return s.length?(this.observable_records=o.difference(this.observable_records,s),o.indexOf(this.observable_records,i)):r}return s.length&&(this.observable_records=o.difference(this.observable_records,s)),-1},e.prototype.find=function(e,t){var r;return(r=this.findIndex(e,t))<0?null:this.observable_records[r].observable},e.prototype.isRegistered=function(e){var t,r,n,i;for(i=this.observable_records,r=0,n=i.length;n>r;r++)if(t=i[r],t.observable===e)return!0;return!1},e.prototype.findOrCreate=function(e,t){var r,o;return t.store=this,t.creator||(t.creator=n.utils.inferCreator(e,t.factory,t.path)),!t.creator&&e instanceof n.Model&&(t.creator=n.ViewModel),(r=t.creator)?r.models_only?e:(r&&(o=this.find(e,r)),o?o:(o=n.ignore(function(){return function(){return o=r.create?r.create(e,t):new r(e,t),o||i.observable(null)}}(this)),i.isObservable(o)||this.isRegistered(o)||this.register(e,o,t),o)):n.utils.createFromDefaultCreator(e,t)},e.prototype.findOrReplace=function(e,t,r){var i,o;return e||n._throwUnexpected(this,"obj missing"),(i=this.findIndex(e,t))<0?this.register(e,r,{creator:t}):(o=this.observable_records[i],n.utils.wrappedObject(o.observable)===e||n._throwUnexpected(this,"different object"),o.observable!==r&&(o.observable.constructor===r.constructor||n._throwUnexpected(this,"replacing different type"),this.replaced_observables.push(o.observable),o.observable=r),r)},e}()}),t.register("utils",function(e,t){var r,n,i,o,s,a,l,u;r=t("./kb"),i=t("underscore"),n=t("knockout"),u=r._wrappedKey=function(e,t,n){return 2===arguments.length?e&&e.__kb&&e.__kb.hasOwnProperty(t)?e.__kb[t]:void 0:(e||r._throwUnexpected(this,"no obj for wrapping "+t),e.__kb||(e.__kb={}),e.__kb[t]=n,n)},o=function(e,t){return Array.prototype.splice.call(e,1,0,t),e},a=function(e,t,r){return e[t]||(e[t]=[]),i.isArray(r)||(r=[r]),e[t]=e[t].length?i.union(e[t],r):r,e},l=function(e,t,r){return e[t]||(e[t]={}),i.extend(e[t],r)},s=function(e){var t,r,n,i;for(r={},n=0,i=e.length;i>n;n++)t=e[n],r[t]={key:t};return r},r.utils=function(){function e(){}return e.wrappedObservable=function(){return u.apply(this,o(arguments,"observable"))},e.wrappedObject=function(){return u.apply(this,o(arguments,"object"))},e.wrappedModel=function(e,t){return 1===arguments.length?(t=u(e,"object"),i.isUndefined(t)?e:t):u(e,"object",t)},e.wrappedStore=function(){return u.apply(this,o(arguments,"store"))},e.wrappedStoreIsOwned=function(){return u.apply(this,o(arguments,"store_is_owned"))},e.wrappedFactory=function(){return u.apply(this,o(arguments,"factory"))},e.wrappedEventWatcher=function(){return u.apply(this,o(arguments,"event_watcher"))},e.wrappedEventWatcherIsOwned=function(){return u.apply(this,o(arguments,"event_watcher_is_owned"))},e.wrappedDestroy=function(e){var t;if(e.__kb)return e.__kb.event_watcher&&e.__kb.event_watcher.releaseCallbacks(e),t=e.__kb,e.__kb=null,t.observable&&(t.observable.destroy=t.observable.release=null,this.wrappedDestroy(t.observable),t.observable=null),t.factory=null,t.event_watcher_is_owned&&t.event_watcher.destroy(),t.event_watcher=null,t.store_is_owned&&t.store.destroy(),t.store=null
},e.valueType=function(e){return e?e.__kb_is_o?e.valueType():e.__kb_is_co||e instanceof r.Collection?r.TYPE_COLLECTION:e instanceof r.ViewModel||e instanceof r.Model?r.TYPE_MODEL:i.isArray(e)?r.TYPE_ARRAY:r.TYPE_SIMPLE:r.TYPE_UNKNOWN},e.pathJoin=function(e,t){return(e?"."!==e[e.length-1]?""+e+".":e:"")+t},e.optionsPathJoin=function(e,t){return i.defaults({path:this.pathJoin(e.path,t)},e)},e.inferCreator=function(e,t,n){var i;return t&&(i=t.creatorForPath(e,n)),i?i:e?e instanceof r.Model?r.ViewModel:e instanceof r.Collection?r.CollectionObservable:null:null},e.createFromDefaultCreator=function(e,t){return e instanceof r.Model?r.viewModel(e,t):e instanceof r.Collection?r.collectionObservable(e,t):i.isArray(e)?n.observableArray(e):n.observable(e)},e.hasModelSignature=function(e){return e&&e.attributes&&!e.models&&"function"==typeof e.get&&"function"==typeof e.trigger},e.hasCollectionSignature=function(e){return e&&e.models&&"function"==typeof e.get&&"function"==typeof e.trigger},e.collapseOptions=function(e){var t,r,n,o;for(r={},e={options:e};e.options;){o=e.options;for(t in o)switch(n=o[t],t){case"internals":case"requires":case"excludes":case"statics":a(r,t,n);break;case"keys":i.isObject(n)&&!i.isArray(n)||i.isObject(r[t])&&!i.isArray(r[t])?(i.isObject(n)||(n=[n]),i.isArray(n)&&(n=s(n)),i.isArray(r[t])&&(r[t]=s(r[t])),l(r,t,n)):a(r,t,n);break;case"factories":i.isFunction(n)?r[t]=n:l(r,t,n);break;case"static_defaults":l(r,t,n);break;case"options":break;default:r[t]=n}e=e.options}return r},e.unwrapModels=function(e){var t,n,o;if(!e)return e;if(e.__kb)return"object"in e.__kb?e.__kb.object:e;if(i.isArray(e))return i.map(e,function(e){return r.utils.unwrapModels(e)});if(i.isObject(e)&&e.constructor==={}.constructor){n={};for(t in e)o=e[t],n[t]=r.utils.unwrapModels(o);return n}return e},e}()}),t.register("view-model",function(e,t){var r,n,i;r=t("./kb"),i=t("underscore"),n=t("knockout"),r.ViewModel=function(){function e(e,t,o){return r.ignore(function(s){return function(){var a,l,u,c,d,p,f,b,_,h;if(!e||e instanceof r.Model||"function"==typeof e.get&&"function"==typeof e.bind||r._throwUnexpected(s,"not a model"),t||(t={}),o||(o={}),t=i.isArray(t)?{keys:t}:r.utils.collapseOptions(t),s.__kb||(s.__kb={}),s.__kb.vm_keys={},s.__kb.model_keys={},s.__kb.view_model=i.isUndefined(o)?s:o,!t.internals||(s.__kb.internals=t.internals),!t.excludes||(s.__kb.excludes=t.excludes),!t.statics||(s.__kb.statics=t.statics),!t.static_defaults||(s.__kb.static_defaults=t.static_defaults),r.Store.useOptionsOrCreate(t,e,s),s.__kb.path=t.path,r.Factory.useOptionsOrCreate(t,s,t.path),_=r._wrappedKey(s,"_mdl",n.observable()),s.model=n.dependentObservable({read:function(){return _(),r.utils.wrappedObject(s)},write:function(e){return r.ignore(function(){var t,n,o,a;if(r.utils.wrappedObject(s)!==e){if(s.__kb_null)return void(!e||r._throwUnexpected(s,"model set on shared null"));if(r.utils.wrappedObject(s,e),t=r.utils.wrappedEventWatcher(s),!t)return void _(e);t.emitter(e),!s.__kb.keys&&e&&e.attributes&&(n=i.keys(e.attributes),e&&(a=r.orm.keys(e))&&(n=i.union(n,a)),o=i.difference(n,i.keys(s.__kb.model_keys)),o&&s.createObservables(e,o)),_(e)}})}}),u=r.utils.wrappedEventWatcher(s,new r.EventWatcher(e,s,{emitter:s.model})),c=t.requires,s.__kb.internals&&(c=i.union(c||[],s.__kb.internals)),e&&(f=r.orm.keys(e))&&(c=i.union(c||[],f)),t.keys)if(i.isObject(t.keys)&&!i.isArray(t.keys)){d={},h=t.keys;for(b in h)p=h[b],d[i.isString(p)?p:p.key?p.key:b]=!0;s.__kb.keys=i.keys(d)}else s.__kb.keys=t.keys,c=c?i.union(c,s.__kb.keys):i.clone(s.__kb.keys);else l=u.emitter(),l&&l.attributes&&(a=i.keys(l.attributes),c=c?i.union(c,a):a);return c&&s.__kb.excludes&&(c=i.difference(c,s.__kb.excludes)),c&&s.__kb.statics&&(c=i.difference(c,s.__kb.statics)),i.isObject(t.keys)&&!i.isArray(t.keys)&&s.mapObservables(e,t.keys),i.isObject(t.requires)&&!i.isArray(t.requires)&&s.mapObservables(e,t.requires),!t.mappings||s.mapObservables(e,t.mappings),!c||s.createObservables(e,c),!s.__kb.statics||s.createObservables(e,s.__kb.statics,!0),!r.statistics||r.statistics.register("ViewModel",s),s}}(this))}return e.extend=r.extend,e.prototype.destroy=function(){var e;if(this.__kb.view_model!==this)for(e in this.__kb.vm_keys)this.__kb.view_model[e]=null;return this.__kb.view_model=null,r.releaseKeys(this),r.utils.wrappedDestroy(this),!r.statistics||r.statistics.unregister("ViewModel",this)},e.prototype.shareOptions=function(){return{store:r.utils.wrappedStore(this),factory:r.utils.wrappedFactory(this)}},e.prototype.createObservables=function(e,t,n){var o,s,a,l,u,c;for(n?a=this.__kb.static_defaults||{}:o={store:r.utils.wrappedStore(this),factory:r.utils.wrappedFactory(this),path:this.__kb.path,event_watcher:r.utils.wrappedEventWatcher(this)},u=0,c=t.length;c>u;u++)s=t[u],l=this.__kb.internals&&i.contains(this.__kb.internals,s)?"_"+s:s,this[l]||(this.__kb.vm_keys[l]=this.__kb.model_keys[s]=!0,n?e.has(l)?this[l]=this.__kb.view_model[l]=e.get(l):l in a&&(this[l]=this.__kb.view_model[l]=a[l]):(o.key=s,this[l]=this.__kb.view_model[l]=r.observable(e,o,this)))},e.prototype.mapObservables=function(e,t){var n,o,s;n={store:r.utils.wrappedStore(this),factory:r.utils.wrappedFactory(this),path:this.__kb.path,event_watcher:r.utils.wrappedEventWatcher(this)};for(s in t)o=t[s],this[s]||(o=i.isString(o)?{key:o}:i.clone(o),o.key||(o.key=s),this.__kb.vm_keys[s]=this.__kb.model_keys[o.key]=!0,this[s]=this.__kb.view_model[s]=r.observable(e,i.defaults(o,n),this))},e}(),r.viewModel=function(e,t,n){return new r.ViewModel(e,t,n)}}),t.register("default-observable",function(e,t,r){var n,i,o,s;try{i=t("knockback")}catch(a){n=a,i=t("./kb")}s=t("underscore"),o=t("knockout"),t("./extensions"),r.exports=i.DefaultObservable=function(){function e(e,t){var r;return this.dv=t,r=i.utils.wrappedObservable(this,o.dependentObservable({read:function(t){return function(){var r;return(r=o.utils.unwrapObservable(e()))?r:o.utils.unwrapObservable(t.dv)}}(this),write:function(t){return e(t)}})),i.publishMethods(r,this,["destroy","setToDefault"]),r}return e.prototype.destroy=function(){return i.utils.wrappedDestroy(this)},e.prototype.setToDefault=function(){return i.utils.wrappedObservable(this)(this.dv)},e}(),i.defaultObservable=function(e,t){return new i.DefaultObservable(e,t)}}),t.register("extensions",function(e,t){var r,n,i,o;try{n=t("knockback")}catch(s){r=s,n=t("./kb")}o=t("underscore"),i=t("knockout"),n.Observable.prototype.setToDefault=function(){var e;null!=(e=this.__kb_value)&&"function"==typeof e.setToDefault&&e.setToDefault()},n.ViewModel.prototype.setToDefault=function(){var e,t;for(e in this.__kb.vm_keys)null!=(t=this[e])&&"function"==typeof t.setToDefault&&t.setToDefault()},n.utils.setToDefault=function(e){var t,r;if(e){if(i.isObservable(e))"function"==typeof e.setToDefault&&e.setToDefault();else if(o.isObject(e))for(t in e)r=e[t],!r||!i.isObservable(r)&&"function"==typeof r||"_"===t[0]&&!t.search("__kb")||this.setToDefault(r);return e}}}),t.register("formatted-observable",function(e,t,r){var n,i,o,s,a;try{o=t("knockback")}catch(l){i=l,o=t("./kb")}a=t("underscore"),s=t("knockout"),n=Array.prototype.slice,o.toFormattedString=function(e){var t,r,i,o,l,u;l=e.slice(),r=n.call(arguments,1);for(i in r)for(t=r[i],u=s.utils.unwrapObservable(t),(a.isUndefined(u)||a.isNull(u))&&(u=""),o=e.indexOf("{"+i+"}");o>=0;)l=l.replace("{"+i+"}",u),o=e.indexOf("{"+i+"}",o+1);return l},o.parseFormattedString=function(e,t){var r,n,i,o,s,l,u,c,d,p,f,b,_;for(p=t.slice(),i=0,l=0,c={};p.search("\\{"+i+"\\}")>=0;){for(u=t.indexOf("{"+i+"}");u>=0;)p=p.replace("{"+i+"}","(.*)"),c[u]=i,l++,u=t.indexOf("{"+i+"}",u+1);i++}if(r=i,d=new RegExp(p),s=d.exec(e),s&&s.shift(),!s||s.length!==l){for(f=[];r-->0;)f.push("");return f}_=a.sortBy(a.keys(c),function(e){return parseInt(e,10)}),n={};for(o in _)u=_[o],i=c[u],n.hasOwnProperty(i)||(n[i]=o);for(b=[],i=0;r>i;)b.push(s[n[i]]),i++;return b},r.exports=o.FormattedObservable=function(){function e(e,t){var r,i;return a.isArray(t)?(e=e,i=t):i=n.call(arguments,1),r=o.utils.wrappedObservable(this,s.dependentObservable({read:function(){var r,n,a;for(t=[s.utils.unwrapObservable(e)],n=0,a=i.length;a>n;n++)r=i[n],t.push(s.utils.unwrapObservable(r));return o.toFormattedString.apply(null,t)},write:function(t){var r,n,a;for(n=o.parseFormattedString(t,s.utils.unwrapObservable(e)),a=Math.min(i.length,n.length),r=0;a>r;)i[r](n[r]),r++}}))}return e.prototype.destroy=function(){return o.utils.wrappedDestroy(this)},e}(),o.formattedObservable=function(e){return new o.FormattedObservable(e,n.call(arguments,1))}}),t.register("localized-observable",function(e,t,r){var n,i,o,s;try{i=t("knockback")}catch(a){n=a,i=t("./kb")}s=t("underscore"),o=t("knockout"),i.locale_manager||(i.locale_manager=void 0),r.exports=i.LocalizedObservable=function(){function e(e,t,r){var n;return this.value=e,this.vm=r,t||(t={}),this.vm||(this.vm={}),this.read||i._throwMissing(this,"read"),i.locale_manager||i._throwMissing(this,"kb.locale_manager"),this.__kb||(this.__kb={}),this.__kb._onLocaleChange=s.bind(this._onLocaleChange,this),this.__kb._onChange=t.onChange,this.value&&(e=o.utils.unwrapObservable(this.value)),this.vo=o.observable(e?this.read(e,null):null),n=i.utils.wrappedObservable(this,o.dependentObservable({read:function(e){return function(){return e.value&&o.utils.unwrapObservable(e.value),e.vo(),e.read(o.utils.unwrapObservable(e.value))}}(this),write:function(e){return function(t){return e.write||i._throwUnexpected(e,"writing to read-only"),e.write(t,o.utils.unwrapObservable(e.value)),e.vo(t),e.__kb._onChange?e.__kb._onChange(t):void 0}}(this),owner:this.vm})),i.publishMethods(n,this,["destroy","observedValue","resetToCurrent"]),i.locale_manager.bind("change",this.__kb._onLocaleChange),t.hasOwnProperty("default")&&(n=i.DefaultObservable&&o.defaultObservable(n,t["default"])),n}return e.extend=i.extend,e.prototype.destroy=function(){return i.locale_manager.unbind("change",this.__kb._onLocaleChange),this.vm=null,i.utils.wrappedDestroy(this)},e.prototype.resetToCurrent=function(){var e,t;return t=i.utils.wrappedObservable(this),e=this.value?this.read(o.utils.unwrapObservable(this.value)):null,t()!==e?t(e):void 0},e.prototype.observedValue=function(e){return 0===arguments.length?this.value:(this.value=e,void this._onLocaleChange())},e.prototype._onLocaleChange=function(){var e;return e=this.read(o.utils.unwrapObservable(this.value)),this.vo(e),this.__kb._onChange?this.__kb._onChange(e):void 0},e}(),i.localizedObservable=function(e,t,r){return new i.LocalizedObservable(e,t,r)}}),t.register("triggered-observable",function(e,t,r){var n,i,o,s;try{i=t("knockback")}catch(a){n=a,i=t("./kb")}s=t("underscore"),o=t("knockout"),r.exports=i.TriggeredObservable=function(){function e(e,t){var r;return this.event_selector=t,e||i._throwMissing(this,"emitter"),this.event_selector||i._throwMissing(this,"event_selector"),this.vo=o.observable(),r=i.utils.wrappedObservable(this,o.dependentObservable(function(e){return function(){return e.vo()}}(this))),i.publishMethods(r,this,["destroy"]),i.utils.wrappedEventWatcher(this,new i.EventWatcher(e,this,{emitter:s.bind(this.emitter,this),update:s.bind(this.update,this),event_selector:this.event_selector})),r}return e.prototype.destroy=function(){return i.utils.wrappedDestroy(this)},e.prototype.emitter=function(e){return 0===arguments.length||this.ee===e?this.ee:(this.ee=e)?this.update():void 0},e.prototype.update=function(){return this.ee?this.vo()!==this.ee?this.vo(this.ee):this.vo.valueHasMutated():void 0},e}(),i.triggeredObservable=function(e,t){return new i.TriggeredObservable(e,t)}}),t.register("validation",function(e,t,r){var n,i,o,s,a;try{o=t("knockback")}catch(l){i=l,o=t("./kb")}a=t("underscore"),s=t("knockout"),t("./validators"),n=function(e){return e=s.utils.unwrapObservable(e),"function"==typeof e?e.apply(null,Array.prototype.slice.call(arguments,1)):e},r.exports=o.Validation=function(){function e(){}return e}(),o.valueValidator=function(e,t,r){return null==r&&(r={}),r&&!("function"==typeof r)||(r={}),s.dependentObservable(function(){var i,o,l,u,c,d,p,f;p={$error_count:0},o=s.utils.unwrapObservable(e),!("disable"in r)||(l=n(r.disable)),!("enable"in r)||(l=!n(r.enable)),d=r.priorities||[],a.isArray(d)||(d=[d]),i=d.length+1;for(u in t)f=t[u],p[u]=!l&&n(f,o),p[u]&&(p.$error_count++,(c=a.indexOf(d,u)>=0)||(c=d.length),p.$active_error&&i>c?(p.$active_error=u,i=c):p.$active_error||(p.$active_error=u,i=c));return p.$enabled=!l,p.$disable=!!l,p.$valid=0===p.$error_count,p})},o.inputValidator=function(e,t,r){var n,i,s,l,u,c,d,p,f,b;if(null==r&&(r={}),r&&!("function"==typeof r)||(r={}),f=o.valid,n=$(t),(l=n.attr("name"))&&!a.isString(l)&&(l=null),!(i=n.attr("data-bind")))return null;if(u=new Function("sc","with(sc[0]) { return { "+i+" } }")([e]),!u||!u.value)return null;if(!u.validation_options||(a.defaults(u.validation_options,r),r=u.validation_options),i={},!f[d=n.attr("type")]||(i[d]=f[d]),!n.attr("required")||(i.required=f.required),u.validations){b=u.validations;for(s in b)p=b[s],i[s]=p}return c=o.valueValidator(u.value,i,r),!l&&!r.no_attach||(e["$"+l]=c),c},o.formValidator=function(e,t){var r,n,i,l,u,c,d,p,f,b,_,h,v;for(d={},b=[],r=$(t),(i=r.attr("name"))&&!a.isString(i)&&(i=null),(n=r.attr("data-bind"))&&(c=new Function("sc","with(sc[0]) { return { "+n+" } }")([e]),p=c.validation_options),p||(p={}),p.no_attach=!!i,v=r.find("input"),_=0,h=v.length;h>_;_++)l=v[_],(u=$(l).attr("name"))&&(f=o.inputValidator(e,l,p),!f||b.push(d[u]=f));return d.$error_count=s.dependentObservable(function(){var e,t,r;for(e=0,t=0,r=b.length;r>t;t++)f=b[t],e+=f().$error_count;return e}),d.$valid=s.dependentObservable(function(){return 0===d.$error_count()}),d.$enabled=s.dependentObservable(function(){var e,t,r;for(e=!0,t=0,r=b.length;r>t;t++)f=b[t],e&=f().$enabled;return e}),d.$disabled=s.dependentObservable(function(){return!d.$enabled()}),i&&(e["$"+i]=d),d}}),t.register("validators",function(e,t){var r,n,i,o,s,a,l;try{s=t("knockback")}catch(u){o=u,s=t("./kb")}l=t("underscore"),a=t("knockout"),i=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,r=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/,n=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,s.valid={required:function(e){return!e},url:function(e){return!i.test(e)},email:function(e){return!r.test(e)},number:function(e){return!n.test(e)}},s.hasChangedFn=function(e){var t,r;return r=null,t=null,function(){var n;return r!==(n=a.utils.unwrapObservable(e))?(r=n,t=r?r.toJSON():null,!1):r&&t?!l.isEqual(r.toJSON(),t):!1}},s.minLengthFn=function(e){return function(t){return!t||t.length<e}},s.uniqueValueFn=function(e,t,r){return function(n){var i,o,s;return s=a.utils.unwrapObservable(e),o=a.utils.unwrapObservable(t),i=a.utils.unwrapObservable(r),s&&o&&i?!!l.find(i.models,function(){return function(e){return e!==s&&e.get(o)===n}}(this)):!1}},s.untilTrueFn=function(e,t,r){var n;return n=!1,r&&a.isObservable(r)&&r.subscribe(function(){return n=!1}),function(r){var i,o;return(i=a.utils.unwrapObservable(t))?(n|=!!(o=i(a.utils.unwrapObservable(r))),n?o:a.utils.unwrapObservable(e)):a.utils.unwrapObservable(e)}},s.untilFalseFn=function(e,t,r){var n;return n=!1,r&&a.isObservable(r)&&r.subscribe(function(){return n=!1}),function(r){var i,o;return(i=a.utils.unwrapObservable(t))?(n|=!(o=i(a.utils.unwrapObservable(r))),n?o:a.utils.unwrapObservable(e)):a.utils.unwrapObservable(e)}}}),"function"==typeof define&&define.amd?define(["require","underscore","backbone","knockout"],function(){return t("index")}):"object"==typeof exports?module.exports=t("index"):this.kb=t("index")}).call(this);