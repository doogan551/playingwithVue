<div class="nav">
    <ul>
        <li><span>Overview</span></li>
        <!-- ko if: $root.isSystemAdmin() || (data._pStatus() === $root.utility.config.Enums["Point Statuses"].Inactive.enum)-->
        <li><span>Permissions</span></li>
        <!-- /ko -->
        <li><span>Involvement</span></li>
        <li><span>Equipment</span></li>
        <li><span>Schedule</span></li>
        <li><span>Configuration <i class="fa fa-angle-right"></i></span>
            <ul>
                <li class="header"><span>Configuration</span>
                <li><span>Hardware</span></li>
                <li><span>Value</span></li>
                <li><span>Alarms</span></li>
                <li><span>Notifications</span></li>
                <li class="back"><span><i class="fa fa-angle-left"></i> back</span></li>
            </ul>
        </li>
    </ul>
</div>

<div class="view">
    <div class="container-fluid">
        <div class="row header">
            <div class="col-xs-12">
                <h4>Overview</h4>
            </div>
        </div>
    </div>
    <div id="overview" class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col col-sm-6 col-xs-12">
                    <div class="dataField">
                        <label>Value</label>
                        <div class="valueHolder">
                            <span class="val" data-bind="text: data.Value.Value"></span>
                        </div>
                        <div class="actions">
                            <!-- ko component: { name: 'ctl-readValue', params: { rootContext: $root } } -->
                            <!-- /ko -->
                            <!-- ko if: data['Trend Samples'].Value() > 0 -->
                            <!-- ko component: { name: 'ctl-viewTrend', params: { rootContext: $root } } -->
                            <!-- /ko -->
                            <!-- /ko -->

                            <!-- ko component: { name: 'ctl-viewControls', params: { rootContext: $root } } -->
                            <!-- /ko -->
                            <!-- ko if: $root.authorize(data, $root.permissionLevels.CONTROL) -->
                            <!-- ko component: { name: 'ctl-sendControl', params: { rootContext: $root } } -->
                            <!-- /ko -->
                            <!-- /ko -->
                            <div data-bind="click: toggleModal" class="btn btn-default btn-xs btnViewControlLog"><i class="fa fa-exchange"></i> View Control Log</div>
                        </div>
                    </div>
                </div>
                <div class="col col-sm-6 col-xs-12">
                    <div class="dataField">
                        <label>Last Report Time</label>
                        <span class="lh30" data-bind="text: moment.unix(data['Last Report Time'].Value()).calendar()"></span>
                    </div>
                    <div class="dataField">
                        <label>Authorized Value</label>
                        <span class="lh30" data-bind="text: data['Authorized Value'].Value()"></span>
                    </div>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col col-sm-6 col-xs-12">
                    <div class="dataField">
                        <label>Controller</label>
                        <span class="lh30" data-bind="text: data.Controller.Value()"></span>
                    </div>
                </div>
                <div class="col col-sm-6 col-xs-12">
                    <div class="dataField">
                        <label>Control Priority</label>
                        <span class="lh30" data-bind="text: data['Control Priority'].Value()"></span>
                    </div>
                </div>
            </div>
            <hr>
            <div class="row">
                <!--  ko component: { name: 'ctl-switch', params: { propertyName: 'Out of Service', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
                <!-- /ko -->
            </div>
            <hr>
            <div class="row">
                <div data-bind="component: { name: 'ctl-description', params: { description: data.Description.Value, rootContext: $root } }"></div>
            </div>
        </div>
    </div>

    <div id="permissions" class="content">
        <div data-bind="component: { name: 'ctl-permissions', params: { isTabLoaded: tabTriggers.permissions, rootContext: $root } }"></div>
    </div>

    <div id="involvement" class="content">
        <div data-bind="component: { name: 'ctl-involvement', params: { id: data._id(), isTabLoaded: tabTriggers.involvement, rootContext: $root } }"></div>
    </div>

    <div id="schedule" class="content">
        <div data-bind="component: { name: 'ctl-scheduleEntries', params: { id: data._id(), point: data, pointType: data['Point Type'].Value(),isTabLoaded: tabTriggers.entries, rootContext: $root } }"></div>
    </div>

    <div id="alarms" class="content">
        <div class="row">
            <!-- ko component: { name: 'ctl-pointReference', params: { refType: 'Alarm Display Point', rootContext: $root } } -->
            <!-- /ko -->
        </div>
        <div class="row">
            <!--  ko component: { name: 'ctl-switch', params: { propertyName: 'Alarms Off', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-switch', params: { propertyName: 'Alarm Repeat Enable', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
            <div class="clearfix visible-xs"></div>
            <!-- ko component: { name: 'ctl-dropdown', params: { propertyName: 'Alarm Class', data: data, columnClasses: 'col col-sm-6 col-xs-12', enumSetName: 'Alarm Classes', rootContext: $root } } -->
            <!-- /ko -->
        </div>
        <div class="row">
            <!--  ko component: { name: 'ctl-duration', params: { propertyName: 'Alarm Repeat Time', data: data, columnClasses: 'col col-sm-3 col-xs-6', min: '0:0:0', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-duration', params: { propertyName: 'Alarm Delay Time', data: data, columnClasses: 'col col-sm-3 col-xs-6', min: '0:0:0', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-duration', params: { propertyName: 'Verify Delay', data: data, columnClasses: 'col col-sm-3 col-xs-6', min: '0:0:0', rootContext: $root } } -->
            <!-- /ko -->
        </div>
        <hr>
        <div class="row">
            <!-- ko component: { name: 'ctl-pointReference', params: { refType: 'Interlock Point', rootContext: $root } } -->
            <!-- /ko -->
            <!-- ko component: { name: 'ctl-dropdown', params: { propertyName: 'Interlock State', data: data, columnClasses: 'col col-sm-6 col-xs-12', rootContext: $root } } -->
            <!-- /ko -->
        </div>
    </div>

    <div id="hardware" class="content">
        <div class="row">
            <!-- ko component: { name: 'ctl-pointReference', params: { refType: 'Device Point', rootContext: $root } } -->
            <!-- /ko -->
            <!-- ko component: { name: 'ctl-pointReference', params: { refType: 'Remote Unit Point', rootContext: $root } } -->
            <!-- /ko -->
        </div>
        <div class="row">
            <!-- ko component: { name: 'ctl-dropdown', params: { propertyName: 'Poll Function', data: data, columnClasses: 'col col-sm-6 col-xs-12', enumSetName: 'Modbus Poll Functions', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-number', params: { propertyName: 'Poll Register', data: data, columnClasses: 'col col-sm-6 col-xs-12', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-dropdown', params: { propertyName: 'Poll Data Type', data: data, columnClasses: 'col col-sm-6 col-xs-12', enumSetName: 'Modbus Data Types', rootContext: $root } } -->
            <!-- /ko -->
            <!-- ko component: { name: 'ctl-dropdown', params: { propertyName: 'Modbus Order', data: data, columnClasses: 'col col-sm-4 col-xs-12', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-number', params: { propertyName: 'Instance', data: data, columnClasses: 'col col-sm-6 col-xs-12', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-dropdown', params: { propertyName: 'Channel', data: data, columnClasses: 'col col-sm-6 col-xs-12', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-dropdown', params: { propertyName: 'Polarity', data: data, columnClasses: 'col col-sm-6 col-xs-12', enumSetName: 'Polarities', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-dropdown', params: { propertyName: 'On Channel', data: data, columnClasses: 'col col-sm-6 col-xs-12', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-dropdown', params: { propertyName: 'Off Channel', data: data, columnClasses: 'col col-sm-6 col-xs-12', rootContext: $root } } -->
            <!-- /ko -->
            <!-- ko component: { name: 'ctl-dropdown', params: { propertyName: 'Output Type', data: data, columnClasses: 'col col-sm-6 col-xs-12', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-duration', params: { propertyName: 'Momentary Delay', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-dropdown', params: { propertyName: 'Open Channel', data: data, columnClasses: 'col col-sm-6 col-xs-12', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-dropdown', params: { propertyName: 'Open Polarity', data: data, columnClasses: 'col col-sm-6 col-xs-12', enumSetName: 'Polarities', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-dropdown', params: { propertyName: 'Close Channel', data: data, columnClasses: 'col col-sm-6 col-xs-12', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-dropdown', params: { propertyName: 'Close Polarity', data: data, columnClasses: 'col col-sm-6 col-xs-12', enumSetName: 'Polarities', rootContext: $root } } -->
            <!-- /ko -->
        </div>
        <hr>
        <div class="row">
            <!-- ko component: { name: 'ctl-dropdown', params: { propertyName: 'Off Control Function', data: data, columnClasses: 'col col-sm-6 col-xs-12', enumSetName: 'Modbus Control Functions', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-number', params: { propertyName: 'Off Control Register', data: data, columnClasses: 'col col-sm-6 col-xs-12', rootContext: $root } } -->
            <!-- /ko -->
            <!-- ko component: { name: 'ctl-dropdown', params: { propertyName: 'Off Control Data Type', data: data, columnClasses: 'col col-sm-6 col-xs-12', enumSetName: 'Modbus Data Types', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-number', params: { propertyName: 'Off Control Value', data: data, columnClasses: 'col col-sm-6 col-xs-12', rootContext: $root } } -->
            <!-- /ko -->
            <!-- ko component: { name: 'ctl-dropdown', params: { propertyName: 'On Control Function', data: data, columnClasses: 'col col-sm-6 col-xs-12', enumSetName: 'Modbus Control Functions', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-number', params: { propertyName: 'On Control Register', data: data, columnClasses: 'col col-sm-6 col-xs-12', rootContext: $root } } -->
            <!-- /ko -->
            <!-- ko component: { name: 'ctl-dropdown', params: { propertyName: 'On Control Data Type', data: data, columnClasses: 'col col-sm-6 col-xs-12', enumSetName: 'Modbus Data Types', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-number', params: { propertyName: 'On Control Value', data: data, columnClasses: 'col col-sm-6 col-xs-12', rootContext: $root } } -->
            <!-- /ko -->
        </div>
        <hr>
        <div class="row">
          <!-- ko component: { name: 'ctl-pointReference', params: { refType: 'Feedback Point', rootContext: $root } } -->
          <!-- /ko -->
          <!--  ko component: { name: 'ctl-dropdown', params: { propertyName: 'Feedback Channel', data: data, columnClasses: 'col col-sm-6 col-xs-12', rootContext: $root } } -->
          <!-- /ko -->
          <!--  ko component: { name: 'ctl-dropdown', params: { propertyName: 'Feedback Type', data: data, columnClasses: 'col col-sm-6 col-xs-12', rootContext: $root } } -->
          <!-- /ko -->
          <!--  ko component: { name: 'ctl-dropdown', params: { propertyName: 'Feedback Polarity', data: data, columnClasses: 'col col-sm-6 col-xs-12', enumSetName: 'Polarities', rootContext: $root } } -->
          <!-- /ko -->
          <!--  ko component: { name: 'ctl-number', params: { propertyName: 'Feedback Instance', data: data, columnClasses: 'col col-sm-6 col-xs-12', rootContext: $root } } -->
          <!-- /ko -->
        </div>
    </div>

    <div id="value" class="content">
        <div class="row">
            <!--  ko component: { name: 'ctl-switch', params: { propertyName: 'COV Enable', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-switch', params: { propertyName: 'Broadcast Enable', data: data, columnClasses: 'col col-sm-3 col-xs-4', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-duration', params: { propertyName: 'Broadcast Period', data: data, columnClasses: 'col col-sm-3 col-xs-4', min: '0:0:15', max: '0:59:59', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-switch', params: { propertyName: 'Read Only', data: data, columnClasses: 'col col-sm-3 col-xs-4', rootContext: $root } } -->
            <!-- /ko -->
        </div>
        <hr>
        <div class="row">
            <!--  ko component: { name: 'ctl-qualityCodeEnable', params: { propertyName: 'Quality Code Enable', data: data, columnClasses: 'col-xs-12', rootContext: $root } } -->
            <!-- /ko -->
        </div>
        <hr>
        <div class="row">
            <!--  ko component: { name: 'ctl-number', params: { propertyName: 'Trend Samples', data: data, columnClasses: 'col col-sm-3 col-xs-6', min: 0, max: 255, rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-duration', params: { propertyName: 'Trend Interval', data: data, columnClasses: 'col col-sm-3 col-xs-6', min: '0:0:1', max: '0:59:59', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-switch', params: { propertyName: 'Trend Enable', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
        </div>
        <hr>
        <div class="row">
            <!--  ko component: { name: 'ctl-text', params: { propertyName: 'Active Text', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-text', params: { propertyName: 'Inactive Text', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-dropdown', params: { propertyName: 'Default Value', data: data, columnClasses: 'col col-sm-6 col-xs-12', enumSetName: 'Value', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-duration', params: { propertyName: 'Minimum On Time', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-duration', params: { propertyName: 'Minimum Off Time', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-switch', params: { propertyName: 'Same State Test', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
        </div>
    </div>

    <div id="equipment" class="content">
        <div class="row">
            <!--  ko component: { name: 'ctl-number', params: { propertyName: 'Run Total', button: { text: 'Reset', action: reset }, data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-number', params: { propertyName: 'Run Total Limit', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-ROtime', params: { propertyName: 'Run Total Reset Time', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
        </div>
        <div class="row">
            <!--  ko component: { name: 'ctl-switch', params: { propertyName: 'Run Total Reset Enable', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-switch', params: { propertyName: 'Run Total Alarm Enable', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
        </div>
        <hr>
        <div class="row">
            <!--  ko component: { name: 'ctl-number', params: { propertyName: 'Number of Starts', button: { text: 'Reset', action: reset }, data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-number', params: { propertyName: 'Starts Alarm Limit', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-ROtime', params: { propertyName: 'Last Start Reset Time', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
            <!--  ko component: { name: 'ctl-ROtime', params: { propertyName: 'Last Start Time', data: data, columnClasses: 'col col-sm-3 col-xs-6', rootContext: $root } } -->
            <!-- /ko -->
        </div>
    </div>

    <div id="notifications" class="content">
        <div data-bind="component: { name: 'ctl-notifications', params: { data: data['Alarm Messages'], rootContext: $root } }"></div>
    </div>
</div>

<!-- Control Log Modal -->
<div class="modal fade bs-example-modal-sm viewControlLog" tabindex="-1" data-backdrop="static" data-bind="modal: modal.showModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">View Control Log</h4>
            </div>
            
            <div class="modal-body container-fluid">
                <div>
                    <!-- Getting -->
                    <div class="modalScene modalWait">
                        <p>Retrieving control log...</p>
                        <h1><i class="fa fa-refresh fa-spin"></i></h1>
                    </div>
                    <!-- Error -->
                    <div class="modalScene modalError">
                        <h1><i class="fa fa-exclamation-triangle text-warning"></i> Error</h1>
                        <p data-bind="text: modal.errorText"></p>
                        <p>Close this dialog or <a href="javascript://" data-bind="click: getControlLog">try again</a></p>
                    </div>
                    <!-- Controls -->
                    <div class="modalScene modalValue">
                        <!-- ko if: modal.controlLog().length == 0 -->
                        No control log data available
                        <!-- /ko -->
                        <!-- ko ifnot: modal.controlLog().length == 0 -->
                        <table class="grid table table-condensed">
                            <thead>
                            <tr>
                                <th class="cursorPointer" data-bind="click: reverseSort">Timestamp <i class="fa fa-chevron-up" style="padding-left: 5px;"></i></th>
                                <th>Value</th>
                                <th>Priority</th>
                                <th>Controller</th>
                            </tr>
                            </thead>
                            <tbody data-bind="foreach: modal.controlLogSorted">
                            <tr>
                                <td data-bind="text: prettyTime"></td>
                                <td data-bind="text: valueText"></td>
                                <td data-bind="text: priorityText"></td>
                                <td data-bind="text: controllerName"></td>
                            </tr>
                            </tbody>
                        </table>
                        <!-- /ko -->
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-link btn-sm" data-dismiss="modal">Close</button>
                <button type="button" class="btnSubmit btn btn-primary btn-sm" data-bind="click : getControlLog">Refresh</button>
            </div>
        </div>
    </div>
</div>